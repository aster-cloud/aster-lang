This module is test.healthcare.eligibility.

Define Patient with patientId: Text, age: Int, hasInsurance: Bool, insuranceType: Text, chronicConditions: Int.

Define Service with serviceCode: Text, serviceName: Text, basePrice: Int, requiresPreAuth: Bool.

Define EligibilityCheck with eligible: Bool, reason: Text, coveragePercent: Int, estimatedCost: Int, requiresPreAuth: Bool.

To determineMinorCoverage with insuranceType: Text, service: Service, produce Int:
  If =(insuranceType, "Premium"),:
    Return 90.
  If =(insuranceType, "Standard"),:
    Return 80.
  Return 70.

To determineSeniorCoverage with insuranceType: Text, service: Service, produce Int:
  If =(insuranceType, "Medicare"),:
    Return 85.
  If =(insuranceType, "Premium"),:
    Return 95.
  If =(insuranceType, "Standard"),:
    Return 75.
  Return 60.

To determineStandardCoverage with insuranceType: Text, service: Service, chronicConditions: Int, produce Int:
  If =(insuranceType, "Premium"),:
    If >(chronicConditions, 2),:
      Return 90.
    Return 85.
  If =(insuranceType, "Standard"),:
    If >(chronicConditions, 2),:
      Return 75.
    Return 70.
  If =(insuranceType, "Basic"),:
    Return 60.
  Return 50.

To calculatePatientCost with basePrice: Int, coveragePercent: Int, produce Int:
  Let coverageAmount be *(basePrice, coveragePercent).
  Let patientPercent be -(100, coveragePercent).
  Let patientCost be *(basePrice, patientPercent).
  Return patientCost.

To checkServiceEligibility with patient: Patient, service: Service, produce EligibilityCheck:
  If not(patient.hasInsurance),:
    Return EligibilityCheck with eligible = false, reason = "No insurance coverage", coveragePercent = 0, estimatedCost = service.basePrice, requiresPreAuth = false.

  If <(patient.age, 18),:
    Let coverage be determineMinorCoverage(patient.insuranceType, service).
    Return EligibilityCheck with eligible = true, reason = "Minor coverage", coveragePercent = coverage, estimatedCost = calculatePatientCost(service.basePrice, coverage), requiresPreAuth = service.requiresPreAuth.

  If >(patient.age, 65),:
    Let coverage be determineSeniorCoverage(patient.insuranceType, service).
    Return EligibilityCheck with eligible = true, reason = "Senior coverage", coveragePercent = coverage, estimatedCost = calculatePatientCost(service.basePrice, coverage), requiresPreAuth = service.requiresPreAuth.

  Let coverage be determineStandardCoverage(patient.insuranceType, service, patient.chronicConditions).
  Return EligibilityCheck with eligible = true, reason = "Standard coverage", coveragePercent = coverage, estimatedCost = calculatePatientCost(service.basePrice, coverage), requiresPreAuth = service.requiresPreAuth.

To testNoInsurance, produce EligibilityCheck:
  Let patient be Patient with patientId = "P001", age = 35, hasInsurance = false, insuranceType = "", chronicConditions = 0.
  Let service be Service with serviceCode = "S001", serviceName = "Checkup", basePrice = 100, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testMinorPremiumCoverage, produce EligibilityCheck:
  Let patient be Patient with patientId = "P002", age = 15, hasInsurance = true, insuranceType = "Premium", chronicConditions = 0.
  Let service be Service with serviceCode = "S002", serviceName = "Consultation", basePrice = 200, requiresPreAuth = true.
  Return checkServiceEligibility(patient, service).

To testMinorStandardCoverage, produce EligibilityCheck:
  Let patient be Patient with patientId = "P003", age = 10, hasInsurance = true, insuranceType = "Standard", chronicConditions = 0.
  Let service be Service with serviceCode = "S003", serviceName = "Vaccination", basePrice = 150, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testMinorBasicCoverage, produce EligibilityCheck:
  Let patient be Patient with patientId = "P004", age = 17, hasInsurance = true, insuranceType = "Basic", chronicConditions = 0.
  Let service be Service with serviceCode = "S004", serviceName = "Physical", basePrice = 180, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testSeniorMedicareCoverage, produce EligibilityCheck:
  Let patient be Patient with patientId = "P005", age = 70, hasInsurance = true, insuranceType = "Medicare", chronicConditions = 1.
  Let service be Service with serviceCode = "S005", serviceName = "Specialist", basePrice = 300, requiresPreAuth = true.
  Return checkServiceEligibility(patient, service).

To testSeniorPremiumCoverage, produce EligibilityCheck:
  Let patient be Patient with patientId = "P006", age = 75, hasInsurance = true, insuranceType = "Premium", chronicConditions = 2.
  Let service be Service with serviceCode = "S006", serviceName = "Surgery", basePrice = 5000, requiresPreAuth = true.
  Return checkServiceEligibility(patient, service).

To testSeniorStandardCoverage, produce EligibilityCheck:
  Let patient be Patient with patientId = "P007", age = 68, hasInsurance = true, insuranceType = "Standard", chronicConditions = 0.
  Let service be Service with serviceCode = "S007", serviceName = "LabWork", basePrice = 250, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testStandardPremiumHighChronic, produce EligibilityCheck:
  Let patient be Patient with patientId = "P008", age = 45, hasInsurance = true, insuranceType = "Premium", chronicConditions = 3.
  Let service be Service with serviceCode = "S008", serviceName = "Treatment", basePrice = 1000, requiresPreAuth = true.
  Return checkServiceEligibility(patient, service).

To testStandardPremiumLowChronic, produce EligibilityCheck:
  Let patient be Patient with patientId = "P009", age = 50, hasInsurance = true, insuranceType = "Premium", chronicConditions = 1.
  Let service be Service with serviceCode = "S009", serviceName = "Imaging", basePrice = 800, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testStandardStandardHighChronic, produce EligibilityCheck:
  Let patient be Patient with patientId = "P010", age = 40, hasInsurance = true, insuranceType = "Standard", chronicConditions = 4.
  Let service be Service with serviceCode = "S010", serviceName = "Therapy", basePrice = 600, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testStandardStandardLowChronic, produce EligibilityCheck:
  Let patient be Patient with patientId = "P011", age = 35, hasInsurance = true, insuranceType = "Standard", chronicConditions = 0.
  Let service be Service with serviceCode = "S011", serviceName = "Screening", basePrice = 400, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testStandardBasicCoverage, produce EligibilityCheck:
  Let patient be Patient with patientId = "P012", age = 30, hasInsurance = true, insuranceType = "Basic", chronicConditions = 1.
  Let service be Service with serviceCode = "S012", serviceName = "Emergency", basePrice = 2000, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testStandardUnknownInsurance, produce EligibilityCheck:
  Let patient be Patient with patientId = "P013", age = 28, hasInsurance = true, insuranceType = "Unknown", chronicConditions = 0.
  Let service be Service with serviceCode = "S013", serviceName = "Dental", basePrice = 300, requiresPreAuth = false.
  Return checkServiceEligibility(patient, service).

To testCalculatePatientCost, produce Int:
  Return calculatePatientCost(1000, 80).
