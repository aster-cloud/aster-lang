{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Workflow Event",
  "description": "2025-11-10 17:06 NZDT Codex：工作流事件结构定义，标准化 payload 字段，便于审计与重放。",
  "type": "object",
  "properties": {
    "eventType": {
      "type": "string",
      "enum": [
        "WORKFLOW_STARTED",
        "STEP_STARTED",
        "STEP_COMPLETED",
        "STEP_FAILED",
        "WORKFLOW_COMPLETED",
        "WORKFLOW_FAILED"
      ]
    },
    "payload": {
      "type": "object",
      "properties": {
        "stepId": {
          "type": "string",
          "description": "步骤唯一标识"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "该步骤的依赖步骤 ID 列表"
        },
        "status": {
          "type": "string",
          "enum": [
            "SCHEDULED",
            "STARTED",
            "COMPLETED",
            "FAILED"
          ],
          "description": "步骤状态"
        },
        "startedAt": {
          "type": "string",
          "format": "date-time",
          "description": "步骤开始时间"
        },
        "completedAt": {
          "type": "string",
          "format": "date-time",
          "description": "步骤完成时间"
        },
        "error": {
          "type": "string",
          "description": "失败时的错误详情"
        },
        "policyId": {
          "type": "string",
          "description": "策略 ID（模块名.函数名），用于审计追踪（Phase 3.1）"
        },
        "policyVersion": {
          "type": "integer",
          "description": "策略版本号，用于审计追踪（Phase 3.1）"
        },
        "policyVersionId": {
          "type": "integer",
          "description": "策略版本数据库 ID，关联到 policy_versions 表（Phase 3.1）"
        }
      },
      "additionalProperties": true
    }
  },
  "required": [
    "eventType",
    "payload"
  ]
}
