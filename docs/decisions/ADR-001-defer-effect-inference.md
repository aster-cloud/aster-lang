# ADR-001: å»¶è¿Ÿå®Œæ•´ Effect Inference å®ç°è‡³ Phase 1

## å…ƒæ•°æ®

- **çŠ¶æ€**: å·²æ¥å— (Accepted)
- **å†³ç­–æ—¥æœŸ**: 2025-11-08
- **å†³ç­–è€…**: Aster Language Team
- **ç›¸å…³æ–‡æ¡£**: [DESIGN.md](../../DESIGN.md), [effect-inference-algorithm.md](../reference/effect-inference-algorithm.md)
- **å½±å“èŒƒå›´**: Phase 0 (Production Build Pipeline), Phase 1 (Effect System Enhancement)

---

## æ‘˜è¦

æˆ‘ä»¬å†³å®šå°†å®Œæ•´çš„ Effect Inferenceï¼ˆæ•ˆæœæ¨æ–­ï¼‰åŠŸèƒ½å®ç°å»¶è¿Ÿè‡³ **Phase 1**ï¼Œè€Œåœ¨ Phase 0 ä»…ä¿ç•™åŸºäºå‰ç¼€åŒ¹é…çš„ç®€åŒ–æ•ˆæœç³»ç»Ÿã€‚å½“å‰ç³»ç»Ÿå·²è¶³ä»¥æ»¡è¶³ 80% çš„ä½¿ç”¨åœºæ™¯ï¼Œå®Œæ•´çš„è°ƒç”¨å›¾åˆ†æå’Œçº¦æŸæ±‚è§£éœ€è¦æ›´å¤šå·¥ç¨‹æŠ•å…¥ï¼Œåº”åœ¨æ ¸å¿ƒåŸºç¡€è®¾æ–½ç¨³å®šåå®æ–½ã€‚

---

## 1. ä¸Šä¸‹æ–‡ä¸é—®é¢˜é™ˆè¿°

### 1.1 èƒŒæ™¯

Aster è¯­è¨€é‡‡ç”¨ç¼–è¯‘æ—¶æ•ˆæœç³»ç»Ÿï¼ˆEffect Systemï¼‰æ¥è¿½è¸ªå‡½æ•°çš„å‰¯ä½œç”¨ï¼Œåˆ†ä¸ºä¸‰ç±»æ•ˆæœï¼š

- **Pureï¼ˆçº¯è®¡ç®—ï¼‰**: æ— å‰¯ä½œç”¨ï¼Œâˆ…
- **CPUï¼ˆè®¡ç®—å¯†é›†ï¼‰**: çº¯è®¡ç®—ä½†è€—æ—¶ï¼ˆå¦‚åŠ å¯†ã€å‹ç¼©ï¼‰
- **IOï¼ˆè¾“å…¥è¾“å‡ºï¼‰**: ä¸å¤–ç•Œäº¤äº’ï¼Œç»†åŒ–ä¸ºèƒ½åŠ›å­é›†ï¼ˆHttp, Sql, Time, Files, Secrets, AiModelï¼‰

æ•ˆæœæ ¼ï¼ˆLatticeï¼‰ï¼š
```
âˆ… (pure) âŠ‘ CPU âŠ‘ IO[*]
         âŠ‘ IO[Http] âŠ‘ IO[Http, Sql] âŠ‘ ...
```

### 1.2 å½“å‰å®ç°çŠ¶æ€

**å·²å®ç°**ï¼ˆPhase 0ï¼‰ï¼š
- âœ… åŸºäºå‰ç¼€åŒ¹é…çš„æ•ˆæœæ¨æ–­ï¼ˆ`src/config/effects.ts`ï¼‰
- âœ… æ‰‹åŠ¨æ•ˆæœå£°æ˜ä¸éªŒè¯ï¼ˆ`It performs IO / CPU`ï¼‰
- âœ… ç¼–è¯‘æ—¶æ•ˆæœæ£€æŸ¥ï¼ˆé˜²æ­¢çº¯å‡½æ•°è°ƒç”¨ IO å‡½æ•°ï¼‰
- âœ… å¯é…ç½®çš„èƒ½åŠ›å‰ç¼€è§„åˆ™ï¼ˆ`CAPABILITY_PREFIXES`ï¼‰

ç¤ºä¾‹ï¼š
```typescript
// src/config/effects.ts
export const IO_PREFIXES = ['fetch', 'http', 'read', 'write', 'query', 'exec'];
export const CPU_PREFIXES = ['hash', 'encrypt', 'compress', 'parse'];

export function inferCapabilityFromName(name: string): Effect {
  if (IO_PREFIXES.some(prefix => name.startsWith(prefix))) {
    return Effect.IO;
  }
  if (CPU_PREFIXES.some(prefix => name.startsWith(prefix))) {
    return Effect.CPU;
  }
  return Effect.Pure;
}
```

**æœªå®ç°**ï¼ˆè®¾è®¡é˜¶æ®µï¼‰ï¼š
- âŒ åŸºäºè°ƒç”¨å›¾çš„å…¨é‡æ•ˆæœæ¨æ–­
- âŒ çº¦æŸæ±‚è§£ç®—æ³•ï¼ˆHindley-Milner é£æ ¼ï¼‰
- âŒ æ•ˆæœå¤šæ€çš„æ³›å‹å‚æ•°åŒ–
- âŒ å¢é‡æ¨æ–­ä¸è¯Šæ–­ä¼˜åŒ–

å‚è€ƒï¼š[effect-inference-algorithm.md](../reference/effect-inference-algorithm.md)ï¼ˆè®¾è®¡æ–‡æ¡£ï¼Œdated 2025-10-06ï¼‰

### 1.3 é—®é¢˜é™ˆè¿°

åœ¨ Phase 0ï¼ˆProduction Build Pipelineï¼‰é˜¶æ®µï¼Œæˆ‘ä»¬é¢ä¸´ä»¥ä¸‹å†³ç­–ï¼š

**é€‰é¡¹ A: ç«‹å³å®ç°å®Œæ•´ Effect Inference**
- ä¼˜åŠ¿ï¼šè‡ªåŠ¨æ¨æ–­æœ€å°æ•ˆæœé›†ï¼Œå‡å°‘æ‰‹åŠ¨å£°æ˜
- åŠ£åŠ¿ï¼šéœ€è¦ 4 äººå‘¨å·¥ä½œé‡ï¼Œå¯èƒ½å»¶è¿Ÿ Phase 0 äº¤ä»˜

**é€‰é¡¹ B: å»¶è¿Ÿè‡³ Phase 1ï¼Œä¿ç•™å‰ç¼€åŒ¹é…ç³»ç»Ÿ**
- ä¼˜åŠ¿ï¼šå¿«é€Ÿäº¤ä»˜ Phase 0ï¼Œæ»¡è¶³æ ¸å¿ƒéœ€æ±‚
- åŠ£åŠ¿ï¼šå¼€å‘è€…éœ€æ‰‹åŠ¨å£°æ˜æ•ˆæœï¼ˆç»´æŠ¤è´Ÿæ‹…ï¼‰

**å†³ç­–é—®é¢˜**ï¼š
> æ˜¯å¦åº”åœ¨ Phase 0 å®ç°å®Œæ•´çš„ Effect Inferenceï¼Œè¿˜æ˜¯å»¶è¿Ÿè‡³ Phase 1ï¼Ÿ

---

## 2. å†³ç­–

**æˆ‘ä»¬é€‰æ‹©å»¶è¿Ÿå®Œæ•´ Effect Inference å®ç°è‡³ Phase 1**ï¼ˆé€‰é¡¹ Bï¼‰ã€‚

**åŸå› **ï¼š

1. **å½“å‰ç³»ç»Ÿå·²æ»¡è¶³æ ¸å¿ƒéœ€æ±‚**
   - å‰ç¼€åŒ¹é…ç³»ç»Ÿè¦†ç›– 80% çš„å¸¸è§åœºæ™¯ï¼ˆfetch*, http*, read*, write*, query*, exec*ï¼‰
   - æ‰‹åŠ¨æ•ˆæœå£°æ˜ä¸ºå¤æ‚åœºæ™¯æä¾›äº†æ˜ç¡®æ§åˆ¶
   - Phase 0 éªŒæ”¶æ ‡å‡†ï¼ˆ"æ–°å¼€å‘è€… <1 å°æ—¶éƒ¨ç½²ç­–ç•¥"ï¼‰ä¸ä¾èµ–è‡ªåŠ¨æ¨æ–­

2. **å®Œæ•´å®ç°æˆæœ¬è¿‡é«˜**
   - éœ€è¦å®ç°è°ƒç”¨å›¾æ„å»ºã€çº¦æŸæ”¶é›†ã€æœ€å°ä¸åŠ¨ç‚¹æ±‚è§£ã€è¯Šæ–­ç”Ÿæˆï¼ˆ4 äººå‘¨ï¼‰
   - æ•ˆæœå¤šæ€éœ€è¦æ³›å‹ç³»ç»Ÿæ·±åº¦é›†æˆ
   - å¢é‡æ¨æ–­éœ€è¦é‡æ„ç°æœ‰ç±»å‹æ£€æŸ¥å™¨

3. **å·¥ç¨‹ä¼˜å…ˆçº§æƒè¡¡**
   - Phase 0 é‡ç‚¹æ˜¯ Production Build Pipelineï¼ˆTruffle è§£é‡Šå™¨ã€Native Imageã€æ–‡æ¡£ï¼‰
   - Effect Inference æ˜¯å¢å¼ºç‰¹æ€§è€Œéé˜»å¡æ€§éœ€æ±‚
   - å»¶è¿Ÿå®ç°ä¸å½±å“è¯­è¨€æ ¸å¿ƒè¯­ä¹‰

4. **æŠ€æœ¯å€ºåŠ¡å¯æ§**
   - å‰ç¼€åŒ¹é…ç³»ç»Ÿç®€å•å¯ç»´æŠ¤ï¼ˆ~100 è¡Œä»£ç ï¼‰
   - æœªæ¥å®ç°å®Œæ•´æ¨æ–­æ—¶ï¼Œå¯æ¸è¿›å¼è¿ç§»
   - ç°æœ‰ä»£ç åº“ä½¿ç”¨æ‰‹åŠ¨å£°æ˜ï¼Œè¿ç§»æˆæœ¬ä½

5. **ç”¨æˆ·ä½“éªŒå¯æ¥å—**
   - æ•ˆæœå£°æ˜è¯­æ³•å·²ç»æˆç†Ÿï¼ˆ`It performs IO / CPU`ï¼‰
   - ç¼–è¯‘æ—¶æ£€æŸ¥å·²èƒ½é˜²æ­¢æ•ˆæœè¿è§„
   - å¼€å‘è€…èƒ½å¿«é€Ÿç†è§£å½“å‰ç³»ç»Ÿï¼ˆå¯¹æ¯”å¤æ‚çš„æ¨æ–­è§„åˆ™ï¼‰

---

## 3. å†³ç­–åæœ

### 3.1 æ­£é¢å½±å“

âœ… **Phase 0 æŒ‰æ—¶äº¤ä»˜**
- é¿å… 4 äººå‘¨é¢å¤–å·¥ä½œé‡
- èšç„¦æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆTruffleã€Native Imageã€æ–‡æ¡£ï¼‰

âœ… **ç³»ç»Ÿç®€å•å¯ç»´æŠ¤**
- å‰ç¼€åŒ¹é…è§„åˆ™æ¸…æ™°æ˜“æ‡‚ï¼ˆ~100 è¡Œä»£ç ï¼‰
- æ‰‹åŠ¨å£°æ˜æä¾›æ˜ç¡®æ§åˆ¶ï¼Œé€‚åˆå¤æ‚åœºæ™¯

âœ… **æŠ€æœ¯å€ºåŠ¡å¯æ§**
- å»¶è¿Ÿå®ç°ä¸å¼•å…¥æ¶æ„ç ´åæ€§å˜æ›´
- ç°æœ‰ä»£ç åº“å·²ä½¿ç”¨æ‰‹åŠ¨å£°æ˜ï¼Œæ— éœ€å¤§è§„æ¨¡é‡æ„

âœ… **éªŒè¯éœ€æ±‚ä¼˜å…ˆçº§**
- é€šè¿‡å®é™…ä½¿ç”¨éªŒè¯ Effect Inference çš„çœŸå®ä»·å€¼
- é¿å…è¿‡æ—©ä¼˜åŒ–ï¼ˆ"ç†è®ºå®Œç¾ä½†å®è·µå¤æ‚"ï¼‰

### 3.2 è´Ÿé¢å½±å“

âš ï¸ **å¼€å‘è€…ç»´æŠ¤è´Ÿæ‹…**
- éœ€è¦æ‰‹åŠ¨å£°æ˜å’Œæ›´æ–°æ•ˆæœï¼ˆå½“è°ƒç”¨é“¾å˜åŒ–æ—¶ï¼‰
- å®¹æ˜“å¿˜è®°æ·»åŠ æ•ˆæœå£°æ˜ï¼Œå¯¼è‡´ç¼–è¯‘é”™è¯¯

**ç¼“è§£æªæ–½**ï¼š
- æä¾›æ¸…æ™°çš„é”™è¯¯æç¤ºï¼ˆ"å‡½æ•° X è°ƒç”¨äº† IO å‡½æ•° Yï¼Œéœ€è¦å£°æ˜ `It performs IO`"ï¼‰
- åœ¨æ–‡æ¡£ä¸­æä¾›æ•ˆæœå£°æ˜æœ€ä½³å®è·µï¼ˆ[Getting Started Guide](../guide/getting-started.md)ï¼‰
- LSP æ”¯æŒè‡ªåŠ¨è¡¥å…¨æ•ˆæœå£°æ˜ï¼ˆQuick Fixï¼‰

âš ï¸ **å£°æ˜å†—ä½™**
- å¤§å¤šæ•° IO/CPU å‡½æ•°çš„æ•ˆæœå¯è‡ªåŠ¨æ¨æ–­ï¼Œä½†ä»éœ€æ‰‹åŠ¨å£°æ˜

**ç¼“è§£æªæ–½**ï¼š
- å‰ç¼€åŒ¹é…ç³»ç»Ÿè‡ªåŠ¨æ¨æ–­å†…ç½®å‡½æ•°ï¼ˆfetch*, http*, read*, write*ï¼‰
- å…è®¸å¼€å‘è€…æ‰©å±•å‰ç¼€è§„åˆ™ï¼ˆ`CAPABILITY_PREFIXES` é…ç½®ï¼‰
- æä¾› CLI å·¥å…·ç”Ÿæˆå»ºè®®å£°æ˜ï¼ˆ`aster infer-effects module.aster`ï¼‰

âš ï¸ **è¿ç§»æˆæœ¬**
- Phase 1 å®ç°å®Œæ•´æ¨æ–­åï¼Œéœ€è¦è¿ç§»ç°æœ‰ä»£ç åº“

**ç¼“è§£æªæ–½**ï¼š
- æ”¯æŒæ¸è¿›å¼è¿ç§»ï¼ˆä¿ç•™æ‰‹åŠ¨å£°æ˜ä½œä¸ºæ˜¾å¼æ³¨è§£ï¼‰
- æä¾›è‡ªåŠ¨è¿ç§»å·¥å…·ï¼ˆç§»é™¤å†—ä½™å£°æ˜ï¼‰
- åœ¨ Phase 1 è®¾è®¡æ—¶è€ƒè™‘å‘åå…¼å®¹æ€§

### 3.3 é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| **æ‰‹åŠ¨å£°æ˜é”™è¯¯ç‡é«˜** | ä¸­ | ä¸­ | LSP Quick Fix + æ¸…æ™°é”™è¯¯æç¤º |
| **å¤§å‹é¡¹ç›®ç»´æŠ¤è´Ÿæ‹…** | é«˜ | ä½ | CLI å·¥å…·è¾…åŠ© + å‰ç¼€åŒ¹é…è¦†ç›–å¸¸è§åœºæ™¯ |
| **ç”¨æˆ·ä¸æ»¡å»¶è¿Ÿå®ç°** | ä½ | ä½ | åœ¨è·¯çº¿å›¾ä¸­æ˜ç¡® Phase 1 è®¡åˆ’ |
| **Phase 1 å®ç°å¤æ‚åº¦è¶…é¢„æœŸ** | ä¸­ | ä¸­ | ä¿ç•™ 4 äººå‘¨é¢„ç®— + åˆ†é˜¶æ®µå®æ–½ |

---

## 4. å®æ–½è®¡åˆ’

### 4.1 Phase 0ï¼ˆå½“å‰é˜¶æ®µï¼‰

**ä¿ç•™ç°æœ‰ç³»ç»Ÿ**ï¼š
- âœ… å‰ç¼€åŒ¹é…æ•ˆæœæ¨æ–­ï¼ˆ`src/config/effects.ts`ï¼‰
- âœ… æ‰‹åŠ¨æ•ˆæœå£°æ˜ï¼ˆ`It performs IO / CPU`ï¼‰
- âœ… ç¼–è¯‘æ—¶æ•ˆæœæ£€æŸ¥

**æ–‡æ¡£å¢å¼º**ï¼š
- âœ… [Getting Started Guide](../guide/getting-started.md) - åŒ…å«æ•ˆæœå£°æ˜ç¤ºä¾‹
- âœ… [Effects & Capabilities](../reference/effects-capabilities.md) - è¯¦ç»†æ•ˆæœç³»ç»Ÿè¯´æ˜
- âœ… [Effect Inference Algorithm](../reference/effect-inference-algorithm.md) - è®¾è®¡æ–‡æ¡£ï¼ˆæ ‡æ³¨"æœªå®ç°"ï¼‰

**å·¥å…·æ”¯æŒ**ï¼š
- ğŸ”„ LSP Quick Fixï¼šè‡ªåŠ¨æ·»åŠ ç¼ºå¤±çš„æ•ˆæœå£°æ˜ï¼ˆå·²éƒ¨åˆ†å®ç°ï¼‰
- ğŸ“‹ CLI å·¥å…·ï¼š`aster infer-effects` ç”Ÿæˆå»ºè®®å£°æ˜ï¼ˆå¾…å®ç°ï¼‰

### 4.2 Phase 1ï¼ˆè§„åˆ’é˜¶æ®µï¼‰

**å®Œæ•´ Effect Inference å®ç°**ï¼ˆ4 äººå‘¨ï¼‰ï¼š

1. **çº¦æŸæ”¶é›†**ï¼ˆ1 äººå‘¨ï¼‰
   - éå†è°ƒç”¨å›¾ï¼Œä¸ºæ¯ä¸ªè°ƒç”¨ç‚¹ç”Ÿæˆæ•ˆæœçº¦æŸ
   - å¤„ç†æ¨¡å—ä¾èµ–å’Œå¾ªç¯å¼•ç”¨

2. **çº¦æŸæ±‚è§£**ï¼ˆ1.5 äººå‘¨ï¼‰
   - å®ç°æœ€å°ä¸åŠ¨ç‚¹ç®—æ³•
   - ä¼˜åŒ–æ±‚è§£æ€§èƒ½ï¼ˆå¢é‡æ¨æ–­ï¼‰

3. **æ•ˆæœå¤šæ€**ï¼ˆ1 äººå‘¨ï¼‰
   - æ”¯æŒæ³›å‹å‡½æ•°çš„æ•ˆæœå‚æ•°åŒ–ï¼ˆ`map\<E\>(f: T -> U with E)`ï¼‰
   - å®ä¾‹åŒ–æ•ˆæœå˜é‡

4. **è¯Šæ–­ä¸å·¥å…·**ï¼ˆ0.5 äººå‘¨ï¼‰
   - ç”Ÿæˆæ¸…æ™°çš„æ¨æ–­é”™è¯¯ä¿¡æ¯
   - æä¾›è¿ç§»å·¥å…·ï¼ˆç§»é™¤å†—ä½™å£°æ˜ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ¨æ–­æ•ˆæœä¸æ‰‹åŠ¨å£°æ˜ä¸€è‡´æ€§ â‰¥ 95%
- âœ… ç¼–è¯‘æ—¶é—´å¢é•¿ < 20%
- âœ… æ”¯æŒæ•ˆæœå¤šæ€æ³›å‹å‡½æ•°
- âœ… å¢é‡æ¨æ–­æ”¯æŒæ¨¡å—çº§åˆ«ä¼˜åŒ–

**å‚è€ƒèµ„æ–™**ï¼š
- [Effect Inference Algorithm Design](../reference/effect-inference-algorithm.md)
- [DESIGN.md - Phase 1 Plan](../../DESIGN.md#phase-1-effect-system-enhancement)

---

## 5. æ›¿ä»£æ–¹æ¡ˆ

### 5.1 æ–¹æ¡ˆ Aï¼šç«‹å³å®ç°å®Œæ•´ Effect Inference

**ä¼˜åŠ¿**ï¼š
- è‡ªåŠ¨æ¨æ–­æœ€å°æ•ˆæœé›†ï¼Œå‡å°‘æ‰‹åŠ¨å£°æ˜
- æä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒ

**åŠ£åŠ¿**ï¼š
- éœ€è¦ 4 äººå‘¨å·¥ä½œé‡ï¼Œå»¶è¿Ÿ Phase 0 äº¤ä»˜
- å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œå¯èƒ½å¼•å…¥æ–° bug
- æœªéªŒè¯éœ€æ±‚ä¼˜å…ˆçº§ï¼ˆå¯èƒ½è¿‡åº¦è®¾è®¡ï¼‰

**ä¸ºä½•æ‹’ç»**ï¼šPhase 0 é‡ç‚¹æ˜¯æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ŒEffect Inference æ˜¯å¢å¼ºç‰¹æ€§è€Œéé˜»å¡æ€§éœ€æ±‚ã€‚

### 5.2 æ–¹æ¡ˆ Bï¼šå®Œå…¨ç§»é™¤æ•ˆæœç³»ç»Ÿ

**ä¼˜åŠ¿**ï¼š
- ç®€åŒ–è¯­è¨€è®¾è®¡ï¼Œé™ä½å­¦ä¹ æ›²çº¿
- æ¶ˆé™¤æ‰‹åŠ¨å£°æ˜è´Ÿæ‹…

**åŠ£åŠ¿**ï¼š
- å¤±å»ç¼–è¯‘æ—¶å®‰å…¨ä¿è¯ï¼ˆæ— æ³•é˜²æ­¢çº¯å‡½æ•°è°ƒç”¨ IOï¼‰
- è¿èƒŒ Aster è¯­è¨€è®¾è®¡ç›®æ ‡ï¼ˆ"å®‰å…¨ã€å¯å®¡è®¡"ï¼‰
- å½±å“ 5 ä¸ª Killer Apps çš„æ ¸å¿ƒéœ€æ±‚ï¼ˆå¦‚åˆè§„å®¡æŸ¥ã€é£é™©è¯„ä¼°ï¼‰

**ä¸ºä½•æ‹’ç»**ï¼šæ•ˆæœç³»ç»Ÿæ˜¯ Aster çš„æ ¸å¿ƒä»·å€¼ä¸»å¼ ï¼Œä¸èƒ½ç§»é™¤ã€‚

### 5.3 æ–¹æ¡ˆ Cï¼šä»…å®ç°å±€éƒ¨æ¨æ–­ï¼ˆå‡½æ•°å†…ï¼‰

**ä¼˜åŠ¿**ï¼š
- å®ç°æˆæœ¬ä¸­ç­‰ï¼ˆ2 äººå‘¨ï¼‰
- å‡å°‘éƒ¨åˆ†æ‰‹åŠ¨å£°æ˜

**åŠ£åŠ¿**ï¼š
- æ— æ³•å¤„ç†è·¨å‡½æ•°è°ƒç”¨é“¾
- æ¨æ–­ç»“æœä¸å®Œæ•´ï¼Œä»éœ€æ‰‹åŠ¨å£°æ˜
- å¼•å…¥ä¸­é—´çŠ¶æ€ï¼Œå¢åŠ ç»´æŠ¤å¤æ‚åº¦

**ä¸ºä½•æ‹’ç»**ï¼šæ€§ä»·æ¯”ä½ï¼Œä¸å¦‚ä¿ç•™ç®€å•çš„å‰ç¼€åŒ¹é…ç³»ç»Ÿã€‚

---

## 6. ç›¸å…³å†³ç­–

- **[ADR-002: Truffle è§£é‡Šå™¨ä½œä¸ºä¸»è¦åç«¯]** (å¾…åˆ›å»º)
- **[ADR-003: Native Image PGO ä¼˜åŒ–ç­–ç•¥]** (å¾…åˆ›å»º)
- **[ROADMAP_SUMMARY.md](../../ROADMAP_SUMMARY.md)** - 24 ä¸ªæœˆäº§å“è·¯çº¿å›¾

---

## 7. å‚è€ƒèµ„æ–™

### è®¾è®¡æ–‡æ¡£
- [Effect Inference Algorithm Design](../reference/effect-inference-algorithm.md) - å®Œæ•´æ¨æ–­ç®—æ³•è®¾è®¡ï¼ˆè®¾è®¡æ–‡æ¡£ï¼Œdated 2025-10-06ï¼‰
- [Effects & Capabilities Reference](../reference/effects-capabilities.md) - æ•ˆæœç³»ç»Ÿè¯¦ç»†è¯´æ˜
- [DESIGN.md - Phase 0/1 Plan](../../DESIGN.md) - Phase 0 å’Œ Phase 1 å®æ–½è®¡åˆ’

### ä»£ç å®ç°
- [`src/config/effects.ts`](../../src/config/effects.ts) - å‰ç¼€åŒ¹é…æ•ˆæœæ¨æ–­
- [`src/config/semantic.ts`](../../src/config/semantic.ts) - æ•ˆæœç³»ç»Ÿé…ç½®

### å­¦æœ¯å‚è€ƒ
- **Hindley-Milner Type Inference**: Damas, L., & Milner, R. (1982). *Principal type-schemes for functional programs*
- **Effect Systems**: Lucassen, J. M., & Gifford, D. K. (1988). *Polymorphic effect systems*
- **Algebraic Effects**: Plotkin, G., & Pretnar, M. (2013). *Handling algebraic effects*

### ç›¸å…³å·¥å…·
- **Koka Language**: [koka-lang.github.io](https://koka-lang.github.io/) - å‚è€ƒæ•ˆæœæ¨æ–­å®ç°
- **Scala 3 Effects**: [dotty.epfl.ch](https://dotty.epfl.ch/docs/reference/experimental/cps.html) - CPS å˜æ¢æ•ˆæœç³»ç»Ÿ

---

## 8. å†³ç­–æ—¶é—´çº¿

| æ—¥æœŸ | äº‹ä»¶ | å†³ç­–è€… |
|------|------|--------|
| 2025-10-06 | Effect Inference Algorithm è®¾è®¡æ–‡æ¡£å®Œæˆ | Aster Team |
| 2025-11-08 | **å†³å®šå»¶è¿Ÿå®ç°è‡³ Phase 1** | Aster Team |
| 2025-11-08 | Phase 0 æ–‡æ¡£å®Œå–„ï¼ˆStdlib API + Runtime API + ç»Ÿä¸€ç´¢å¼•ï¼‰ | Aster Team |
| å¾…å®š | Phase 1 å¯åŠ¨ï¼ŒEffect Inference å®æ–½ | Aster Team |

---

## 9. é™„å½•ï¼šå‰ç¼€åŒ¹é…ç³»ç»Ÿè¯¦è§£

### 9.1 å½“å‰å®ç°

```typescript
// src/config/effects.ts

export const IO_PREFIXES = [
  'fetch', 'http', 'read', 'write', 'query', 'exec',
  'sql', 'db', 'api', 'request', 'response', 'socket'
];

export const CPU_PREFIXES = [
  'hash', 'encrypt', 'decrypt', 'compress', 'decompress',
  'parse', 'compile', 'sort', 'search'
];

export function inferCapabilityFromName(name: string): Effect {
  const lowerName = name.toLowerCase();

  // æ£€æŸ¥ IO å‰ç¼€
  if (IO_PREFIXES.some(prefix => lowerName.startsWith(prefix))) {
    return Effect.IO;
  }

  // æ£€æŸ¥ CPU å‰ç¼€
  if (CPU_PREFIXES.some(prefix => lowerName.startsWith(prefix))) {
    return Effect.CPU;
  }

  // é»˜è®¤ä¸ºçº¯è®¡ç®—
  return Effect.Pure;
}
```

### 9.2 è¦†ç›–åœºæ™¯

**è‡ªåŠ¨æ¨æ–­æˆåŠŸ**ï¼ˆ80% åœºæ™¯ï¼‰ï¼š
```aster
# è‡ªåŠ¨æ¨æ–­ä¸º IOï¼ˆå› ä¸º fetchUserData ä»¥ fetch å¼€å¤´ï¼‰
To fetchUserData with id: Int, produce User:
  Return http.get("/users/{id}")

# è‡ªåŠ¨æ¨æ–­ä¸º CPUï¼ˆå› ä¸º hashPassword ä»¥ hash å¼€å¤´ï¼‰
To hashPassword with password: Text, produce Text:
  Return crypto.hash(password)
```

**éœ€è¦æ‰‹åŠ¨å£°æ˜**ï¼ˆ20% åœºæ™¯ï¼‰ï¼š
```aster
# å¤æ‚é€»è¾‘ï¼Œæ— æ³•ä»å‡½æ•°åæ¨æ–­
To processOrder with order: Order, produce Result<Receipt, Error>. It performs IO:
  Define user as fetchUserData(order.userId).  # è°ƒç”¨ IO å‡½æ•°
  Define receipt as generateReceipt(user, order).
  Return Ok(receipt).
```

### 9.3 é…ç½®æ‰©å±•

ç”¨æˆ·å¯é€šè¿‡é…ç½®æ–‡ä»¶æ‰©å±•å‰ç¼€è§„åˆ™ï¼š

```json
// .aster/config.json
{
  "effects": {
    "ioPrefixes": ["fetch", "http", "custom_io_prefix"],
    "cpuPrefixes": ["hash", "encrypt", "custom_cpu_prefix"]
  }
}
```

---

**ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-11-08
**ç»´æŠ¤è€…**: Aster Language Team
**çŠ¶æ€**: å·²æ¥å— (Accepted)
