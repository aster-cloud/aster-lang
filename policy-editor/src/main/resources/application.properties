# Quarkus Configuration
quarkus.application.name=policy-editor

# HTTP Configuration
quarkus.http.port=8081
quarkus.http.host=0.0.0.0

# Vaadin 配置（不依赖扩展键，直接使用 Vaadin 标准键）
# 注意：当前构建未正确识别 vaadin-quarkus 扩展配置键，
# 为确保 Native Image 不触发 DevMode 初始化，这里显式关闭开发模式。
%dev.vaadin.devmode.enabled=true
%dev.vaadin.productionMode=false
vaadin.devmode.enabled=false
vaadin.productionMode=true

# Native profile 下再次强制，避免被其他来源覆盖
%native.vaadin.devmode.enabled=false
%native.vaadin.productionMode=true

# Native Image Configuration
%native.quarkus.native.additional-build-args=\
  --initialize-at-run-time=com.vaadin,\
  --initialize-at-run-time=io.netty,\
  --initialize-at-run-time=oshi.software.os.unix.freebsd.FreeBsdOperatingSystem,\
  --initialize-at-run-time=oshi.software.os.unix.openbsd.OpenBsdOperatingSystem,\
  --initialize-at-run-time=oshi.software.os.unix.solaris.SolarisOperatingSystem,\
  --initialize-at-run-time=oshi.software.os.unix.aix.AixOperatingSystem,\
  --initialize-at-run-time=oshi.software.os.linux.LinuxOperatingSystem,\
  --initialize-at-run-time=oshi.software.os.mac.MacOperatingSystem,\
  --initialize-at-run-time=oshi.software.os.windows.WindowsOperatingSystem,\
  --allow-incomplete-classpath,\
  -H:+ReportExceptionStackTraces,\
  -H:+AddAllCharsets,\
  -Dvaadin.devmode.enabled=false,\
  -Dvaadin.productionMode=true,\
  --initialize-at-run-time=io.quarkus.runner.ApplicationImpl

# Arc: 显式排除 DevServer 相关 Bean，避免生成 ApplicationImpl 引用该 Bean
quarkus.arc.exclude-types=com.vaadin.base.devserver.startup.DevModeStartupListener,com.vaadin.base.devserver.DevModeHandlerManagerImpl

# 在原生镜像环境下，排除 Vaadin DevMode 相关 Bean，避免 CDI 引用缺失类
# 由 CDI Portable Extension 在发现阶段剔除 DevServer 相关 Bean（见 editor.extension.DevServerPortableExtension）

# Logging
quarkus.log.level=INFO
quarkus.log.console.enable=true
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n

# CORS (允许前端访问 API)
# CORS（如需跨域访问再开启以下配置，并确保引入对应扩展）
# quarkus.http.cors=true
# quarkus.http.cors.origins=*
# quarkus.http.cors.methods=GET,POST,PUT,DELETE

# GraphQL 后端（policy API）地址
policy.api.graphql.url=http://localhost:8080/graphql

# 可选：OIDC/JWT 配置（如需启用身份认证）
# quarkus.oidc.auth-server-url=https://your-issuer/.well-known/openid-configuration
# quarkus.oidc.client-id=policy-editor
# quarkus.oidc.application-type=web-app
# quarkus.http.auth.permission.public.paths=/*
# quarkus.http.auth.permission.public.policy=permit
# quarkus.http.auth.permission.secured.paths=/api/*
# quarkus.http.auth.permission.secured.policy=authenticated

# 本地开发 OIDC（Keycloak）示例（请配合 dev/keycloak/docker-compose.yml）
%dev.quarkus.oidc.auth-server-url=http://localhost:8083/realms/aster
%dev.quarkus.oidc.client-id=policy-editor
%dev.quarkus.oidc.application-type=web-app
%dev.quarkus.http.auth.permission.public.paths=/*
%dev.quarkus.http.auth.permission.public.policy=permit
%dev.quarkus.http.auth.permission.secured.paths=/api/*
%dev.quarkus.http.auth.permission.secured.policy=authenticated
