module ops.triage

capabilities uses [AiModel["gpt-4.1", budget=5.00], Email]

record Incident { id: UUID, summary: String, severity: Int }

fn classify(i: Incident) -> Result[Int, String] uses [AiModel] {
  // The runtime enforces prompt redaction and budget limits
}

fn notify(i: Incident, to: String) -> Result[Bool, String] uses [Email] { }

workflow Triage(i: Incident) uses [AiModel, Email] {
  step analyze = retry(max=3, backoff=exp(500ms)) {
    match classify(i) {
      Ok(sev) => if sev >= 3 { notify(i, "oncall@example.com") } else { }
      Err(_)  => stop
    }
  }
}
