import{_ as i,c as a,o as n,aj as e}from"./chunks/framework.Bz2R-749.js";const c=JSON.parse('{"title":"AI 代码生成指南","description":"","frontmatter":{},"headers":[],"relativePath":"guide/ai-code-generation.md","filePath":"guide/ai-code-generation.md"}'),t={name:"guide/ai-code-generation.md"};function l(h,s,p,r,k,d){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="ai-代码生成指南" tabindex="-1">AI 代码生成指南 <a class="header-anchor" href="#ai-代码生成指南" aria-label="Permalink to “AI 代码生成指南”">​</a></h1><blockquote><p><strong>状态</strong>: 用户指南 <strong>版本</strong>: 1.0 <strong>最后更新</strong>: 2025-11-27</p></blockquote><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p>Aster 提供内置的 AI 代码生成功能，可以从自然语言描述自动生成类型安全的 CNL 代码。该功能支持 OpenAI 和 Anthropic 两种 LLM 提供商，并包含完整的代码验证、缓存和来源追踪机制。</p><h2 id="快速开始" tabindex="-1">快速开始 <a class="header-anchor" href="#快速开始" aria-label="Permalink to “快速开始”">​</a></h2><h3 id="_1-设置-api-key" tabindex="-1">1. 设置 API Key <a class="header-anchor" href="#_1-设置-api-key" aria-label="Permalink to “1. 设置 API Key”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># OpenAI（默认）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">your-openai-api-key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或 Anthropic</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">your-anthropic-api-key</span></span></code></pre></div><h3 id="_2-生成代码" tabindex="-1">2. 生成代码 <a class="header-anchor" href="#_2-生成代码" aria-label="Permalink to “2. 生成代码”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基本用法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Calculate the total price of items with tax&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定输出文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Join first and last name with space&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-policy.aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用 Anthropic</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Validate email format&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> anthropic</span></span></code></pre></div><h3 id="_3-查看结果" tabindex="-1">3. 查看结果 <a class="header-anchor" href="#_3-查看结果" aria-label="Permalink to “3. 查看结果”">​</a></h3><p>生成的代码会包含来源追踪注释：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>// ========================================</span></span>
<span class="line"><span>// Generated by: Aster AI Code Generator</span></span>
<span class="line"><span>// Model: gpt-4</span></span>
<span class="line"><span>// Provider: openai</span></span>
<span class="line"><span>// Prompt: Calculate the total price of items with tax</span></span>
<span class="line"><span>// Timestamp: 2025-11-27T10:30:00.000Z</span></span>
<span class="line"><span>// Validated: true</span></span>
<span class="line"><span>// ========================================</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Define Item with</span></span>
<span class="line"><span>  name: Text,</span></span>
<span class="line"><span>  price: Number,</span></span>
<span class="line"><span>  quantity: Number.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To calculate_total with items: List of Item, tax_rate: Number, produce Number:</span></span>
<span class="line"><span>  Let subtotal be List.reduce(items, 0, fn (acc, item) -&gt; acc + item.price * item.quantity).</span></span>
<span class="line"><span>  Return subtotal * (1 + tax_rate).</span></span></code></pre></div><h2 id="命令选项" tabindex="-1">命令选项 <a class="header-anchor" href="#命令选项" aria-label="Permalink to “命令选项”">​</a></h2><table tabindex="0"><thead><tr><th>选项</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>--provider</code></td><td>LLM 提供商 (openai/anthropic)</td><td><code>openai</code></td></tr><tr><td><code>--model</code></td><td>模型名称</td><td><code>gpt-4</code> / <code>claude-3-5-sonnet</code></td></tr><tr><td><code>--output</code></td><td>输出文件路径</td><td>控制台输出</td></tr><tr><td><code>--temperature</code></td><td>温度参数 (0.0-1.0)</td><td><code>0.7</code></td></tr><tr><td><code>--few-shot-count</code></td><td>Few-shot 示例数量</td><td><code>3</code></td></tr><tr><td><code>--no-cache</code></td><td>禁用缓存</td><td>启用缓存</td></tr></tbody></table><h2 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-label="Permalink to “使用场景”">​</a></h2><h3 id="业务规则生成" tabindex="-1">业务规则生成 <a class="header-anchor" href="#业务规则生成" aria-label="Permalink to “业务规则生成”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 贷款审批规则</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Score a loan request by checking credit score above 650, debt ratio below 40%, and assign interest rate based on risk level&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 折扣计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Calculate discount for premium members returning 10 percent off, VIP members 20 percent off&quot;</span></span></code></pre></div><h3 id="数据验证" tabindex="-1">数据验证 <a class="header-anchor" href="#数据验证" aria-label="Permalink to “数据验证”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 邮箱验证</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Validate that email contains @ symbol and domain&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 电话号码格式化</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Format phone number to include country code and dashes&quot;</span></span></code></pre></div><h3 id="工作流逻辑" tabindex="-1">工作流逻辑 <a class="header-anchor" href="#工作流逻辑" aria-label="Permalink to “工作流逻辑”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 订单处理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Process order: validate inventory, calculate shipping, apply discount, return confirmation&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 用户注册</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Register user with email verification and welcome notification&quot;</span></span></code></pre></div><h2 id="缓存机制" tabindex="-1">缓存机制 <a class="header-anchor" href="#缓存机制" aria-label="Permalink to “缓存机制”">​</a></h2><p>AI 生成结果会自动缓存到 <code>.cache/ai-generation/</code> 目录，避免重复调用 LLM API：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>.cache/</span></span>
<span class="line"><span>└── ai-generation/</span></span>
<span class="line"><span>    ├── openai-gpt-4-temp0.7-fs3-abc123.json</span></span>
<span class="line"><span>    └── anthropic-claude-temp0.7-fs3-def456.json</span></span></code></pre></div><p><strong>缓存策略</strong>：</p><ul><li>基于 provider + model + temperature + few-shot-count + description 生成唯一键</li><li>相同请求直接返回缓存结果（&lt; 1 秒）</li><li>使用 <code>--no-cache</code> 强制重新生成</li></ul><p><strong>清理缓存</strong>：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 清理 7 天前的缓存</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .cache/ai-generation</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -mtime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -delete</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 清理所有缓存</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .cache/ai-generation</span></span></code></pre></div><h2 id="来源追踪-provenance" tabindex="-1">来源追踪（Provenance） <a class="header-anchor" href="#来源追踪-provenance" aria-label="Permalink to “来源追踪（Provenance）”">​</a></h2><p>每个生成的文件都包含来源元数据，用于审计和追溯：</p><table tabindex="0"><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td><code>Model</code></td><td>使用的 LLM 模型</td></tr><tr><td><code>Provider</code></td><td>LLM 提供商</td></tr><tr><td><code>Prompt</code></td><td>用户输入的描述</td></tr><tr><td><code>Timestamp</code></td><td>生成时间 (ISO 8601)</td></tr><tr><td><code>Validated</code></td><td>是否通过类型检查</td></tr></tbody></table><p><strong>提取元数据</strong>：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ProvenanceTracker } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;aster-lang/ai/provenance&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tracker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProvenanceTracker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tracker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { model: &#39;gpt-4&#39;, provider: &#39;openai&#39;, prompt: &#39;...&#39;, timestamp: &#39;...&#39;, validated: true }</span></span></code></pre></div><h2 id="代码验证" tabindex="-1">代码验证 <a class="header-anchor" href="#代码验证" aria-label="Permalink to “代码验证”">​</a></h2><p>生成的代码会自动经过完整的编译管线验证：</p><ol><li><strong>词法分析</strong> - 检查语法结构</li><li><strong>语法分析</strong> - 构建 AST</li><li><strong>类型检查</strong> - 验证类型安全</li><li><strong>效应推断</strong> - 检查副作用标注</li></ol><p>如果验证失败，会显示诊断信息：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>⚠️ 验证失败:</span></span>
<span class="line"><span>  Line 5: Type mismatch: expected Number, got Text</span></span>
<span class="line"><span>  Line 8: Unknown function &#39;calculate&#39;</span></span></code></pre></div><h2 id="扩展-llm-提供商" tabindex="-1">扩展 LLM 提供商 <a class="header-anchor" href="#扩展-llm-提供商" aria-label="Permalink to “扩展 LLM 提供商”">​</a></h2><h3 id="添加新提供商" tabindex="-1">添加新提供商 <a class="header-anchor" href="#添加新提供商" aria-label="Permalink to “添加新提供商”">​</a></h3><ol><li>创建 provider 实现：</li></ol><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/ai/providers/my-provider.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { LLMProvider, LLMError } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../llm-provider.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LLMProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 调用 LLM API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;my-provider&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.model;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ol start="2"><li>注册到 CLI：</li></ol><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/cli/commands/ai-generate.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LLMProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;my-provider&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="few-shot-示例管理" tabindex="-1">Few-shot 示例管理 <a class="header-anchor" href="#few-shot-示例管理" aria-label="Permalink to “Few-shot 示例管理”">​</a></h2><p>Few-shot 示例存储在 <code>prompts/few-shot-examples.jsonl</code>：</p><div class="language-jsonl"><button title="Copy Code" class="copy"></button><span class="lang">jsonl</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Add two numbers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;To add with a: Number, b: Number, produce Number:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Return a + b.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Check if list is empty&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;To is_empty with items: List of Any, produce Bool:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Return List.length(items) == 0.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>添加自定义示例</strong>：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 追加新示例</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;description&quot;: &quot;My example&quot;, &quot;code&quot;: &quot;...&quot;}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prompts/few-shot-examples.jsonl</span></span></code></pre></div><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to “最佳实践”">​</a></h2><h3 id="描述编写技巧" tabindex="-1">描述编写技巧 <a class="header-anchor" href="#描述编写技巧" aria-label="Permalink to “描述编写技巧”">​</a></h3><p>✅ <strong>好的描述</strong>：</p><ul><li>具体明确：<code>Calculate total price with 8% tax rate</code></li><li>包含输入输出：<code>Take a list of items and return the sum of prices</code></li><li>指定业务规则：<code>Apply 10% discount if order exceeds $100</code></li></ul><p>❌ <strong>避免的描述</strong>：</p><ul><li>过于模糊：<code>Do something with data</code></li><li>缺少上下文：<code>Process it</code></li><li>多个不相关任务：<code>Calculate tax, send email, and update database</code></li></ul><h3 id="迭代优化" tabindex="-1">迭代优化 <a class="header-anchor" href="#迭代优化" aria-label="Permalink to “迭代优化”">​</a></h3><ol><li>先生成基础版本</li><li>检查验证结果</li><li>调整描述细节</li><li>使用 <code>--no-cache</code> 重新生成</li></ol><h3 id="安全考虑" tabindex="-1">安全考虑 <a class="header-anchor" href="#安全考虑" aria-label="Permalink to “安全考虑”">​</a></h3><ul><li>生成的代码应经过人工审查后再部署</li><li>敏感业务逻辑建议手动编写</li><li>定期检查来源追踪信息</li></ul><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to “故障排除”">​</a></h2><h3 id="api-key-错误" tabindex="-1">API Key 错误 <a class="header-anchor" href="#api-key-错误" aria-label="Permalink to “API Key 错误”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>❌ 創建 LLM Provider 失敗</span></span>
<span class="line"><span>請設置環境變量: export OPENAI_API_KEY=your-api-key</span></span></code></pre></div><p><strong>解决</strong>：确保 API Key 已正确设置且有效。</p><h3 id="rate-limit-错误" tabindex="-1">Rate Limit 错误 <a class="header-anchor" href="#rate-limit-错误" aria-label="Permalink to “Rate Limit 错误”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>❌ 429 Too Many Requests</span></span></code></pre></div><p><strong>解决</strong>：</p><ol><li>等待几分钟后重试</li><li>降低并发请求数</li><li>使用缓存减少 API 调用</li></ol><h3 id="验证失败" tabindex="-1">验证失败 <a class="header-anchor" href="#验证失败" aria-label="Permalink to “验证失败”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>⚠️ 验证失败: Type mismatch</span></span></code></pre></div><p><strong>解决</strong>：</p><ol><li>调整描述使其更具体</li><li>参考 Few-shot 示例格式</li><li>手动修复生成的代码</li></ol><h2 id="相关文档" tabindex="-1">相关文档 <a class="header-anchor" href="#相关文档" aria-label="Permalink to “相关文档”">​</a></h2><ul><li><a href="/docs/ai-generation-architecture.html">AI 代码生成架构</a></li><li><a href="/docs/guide/language-overview.html">CNL 语法参考</a></li><li><a href="/docs/guide/pii-compliance.html">PII 合规指南</a></li><li><a href="/docs/reference/types.html">类型系统参考</a></li></ul><hr><p><strong>注意</strong>：AI 生成的代码应视为初稿，建议在生产环境使用前进行人工审查和测试。</p>`,75)])])}const g=i(t,[["render",l]]);export{c as __pageData,g as default};
