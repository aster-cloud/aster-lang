import{_ as o,c as l,o as a,aj as i}from"./chunks/framework.Bz2R-749.js";const m=JSON.parse('{"title":"发布指南","description":"","frontmatter":{},"headers":[],"relativePath":"publishing-guide.md","filePath":"publishing-guide.md"}'),c={name:"publishing-guide.md"};function d(r,e,t,s,n,p){return a(),l("div",null,[...e[0]||(e[0]=[i('<h1 id="发布指南" tabindex="-1">发布指南 <a class="header-anchor" href="#发布指南" aria-label="Permalink to “发布指南”">​</a></h1><blockquote><p>更新时间：2025-11-25 09:18 NZST · 执行者：Codex</p></blockquote><p>本文档提供发布前检查、构建、打包、发布与验证的端到端流程，用于确保 CLI、包管理与文档版本保持一致。</p><h2 id="发布前检查清单" tabindex="-1">发布前检查清单 <a class="header-anchor" href="#发布前检查清单" aria-label="Permalink to “发布前检查清单”">​</a></h2><ul><li>确认 <code>main</code> 或 <code>release/x.y</code> 分支无未解决的 P0/P1 缺陷，CI 最近一次全绿。</li><li><code>CHANGELOG.md</code>、网站新闻与 <code>docs/repository-infrastructure.md</code> 均已更新对应版本信息。</li><li>所有 CLI 与语言示例在最新 <code>npm run build</code>、<code>npm run test:cli</code>、<code>npm run docs:build</code> 中通过，且 docs 站点已本地预览。</li><li>发行版本号已在 <code>package.json</code>、<code>manifest.schema.json</code>、样例 manifest 及 Release Drafter 草稿中同步。</li><li>发布所需密钥（npm token、GitHub PAT、Cloudflare API Token）均配置在 GitHub Actions Secrets，并完成一次干跑（dry-run）。</li></ul><h2 id="构建流程" tabindex="-1">构建流程 <a class="header-anchor" href="#构建流程" aria-label="Permalink to “构建流程”">​</a></h2><ol><li>清理工作树：<code>git clean -fdx</code>，确保无陈旧 dist/lockfile 干扰。</li><li>执行 <code>npm run build &amp;&amp; npm run typecheck &amp;&amp; npm run lint</code>，确认 TypeScript 与 CLI 模块可在干净环境构建。</li><li>运行 <code>npm run test</code> 与 <code>npm run test:cli:coverage</code>，记录覆盖率结果并附在发布公告中。</li><li>对 JVM 子模块执行 <code>./gradlew :quarkus-policy-api:test :aster-truffle:test</code>，确保跨栈示例依旧可运行。</li><li>运行 <code>npm run docs:build</code>，确认文档导航、示例代码与包管理教程均显示最新版本号。</li></ol><h2 id="打包规则" tabindex="-1">打包规则 <a class="header-anchor" href="#打包规则" aria-label="Permalink to “打包规则”">​</a></h2><ul><li><code>npm pack</code> 输出的 tarball 必须包含 dist、schema、manifest 与 README，禁止包含 <code>.aster/local-registry</code> 等大体积目录。</li><li>示例包通过 <code>npm run build:examples</code> 生成 <code>.aster/local-registry/&lt;pkg&gt;/&lt;version&gt;.tar.gz</code>，需与主版本保持一致。</li><li>GitHub Release 资产包括：CLI 可执行文件（压缩）、manifest schema、示例包集合 ZIP 以及 docs 构建摘要。</li><li>在 <code>scripts/release/</code> 中记录 tarball 的 SHA256，供客户现场验证。</li></ul><h2 id="发布步骤" tabindex="-1">发布步骤 <a class="header-anchor" href="#发布步骤" aria-label="Permalink to “发布步骤”">​</a></h2><ol><li>切换到 <code>release/x.y</code> 分支并确认版本号与 changelog。执行 <code>git tag -a vx.y.z -m &quot;Aster vx.y.z&quot;</code>。</li><li>使用 <code>npm publish --provenance</code> 发布 CLI 到 npm。若 CLI 依赖示例包，需先发布示例包，再发布主 CLI。</li><li>触发 <code>Release</code> GitHub Actions workflow，它会构建 docs、上传 release 资产并将文档部署在 Cloudflare Pages。</li><li>使用 <code>scripts/release/post_publish.sh</code> 更新 <code>.aster/local-registry</code>、docs 下载链接以及内部镜像（若存在）。</li><li>将 tag 合并回 <code>main</code>，并在 <code>#release</code> 频道同步发布说明与安装指引。</li></ol><h2 id="发布后验证" tabindex="-1">发布后验证 <a class="header-anchor" href="#发布后验证" aria-label="Permalink to “发布后验证”">​</a></h2><ul><li><code>npm info aster-lang version</code> 与 <code>node dist/scripts/aster.js --version</code> 输出须匹配新版本。</li><li>在干净目录执行 <code>npx aster-lang@latest init demo</code>（或安装示例包）验证 CLI 是否可从 npm 拉取并生成锁文件。</li><li>运行 <code>npm run docs:preview</code> 或访问生产站点检查导航、示例命令与下载链接。</li><li>对 <code>.aster/local-registry</code> 进行一次 <code>tar -tzf</code> 抽查，确保 tarball 未损坏。</li><li>在 <code>docs/testing.md</code> 与 <code>.claude/operations-log.md</code> 记录本次发布验证情况，便于后续审计。</li></ul>',13)])])}const h=o(c,[["render",d]]);export{m as __pageData,h as default};
