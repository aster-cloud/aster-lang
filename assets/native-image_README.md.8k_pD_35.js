import{_ as i,c as a,o as t,aj as e}from"./chunks/framework.Bz2R-749.js";const o=JSON.parse('{"title":"Aster Native Image 快速开始","description":"","frontmatter":{},"headers":[],"relativePath":"native-image/README.md","filePath":"native-image/README.md"}'),n={name:"native-image/README.md"};function l(h,s,r,p,k,d){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="aster-native-image-快速开始" tabindex="-1">Aster Native Image 快速开始 <a class="header-anchor" href="#aster-native-image-快速开始" aria-label="Permalink to “Aster Native Image 快速开始”">​</a></h1><p>Aster Native Image 是使用 GraalVM Native Image 编译的 Aster 语言独立可执行文件,提供超快启动速度和极低内存占用。</p><h2 id="特性概览" tabindex="-1">特性概览 <a class="header-anchor" href="#特性概览" aria-label="Permalink to “特性概览”">​</a></h2><ul><li><strong>超快启动</strong>: &lt; 50ms (相比 JVM 版本 5-10s,提升 100x)</li><li><strong>低内存占用</strong>: &lt; 50MB (相比 JVM 版本 300-500MB,减少 6-10x)</li><li><strong>独立部署</strong>: 无需安装 JVM,单个可执行文件</li><li><strong>完整语言支持</strong>: 支持所有 Aster 语言特性</li></ul><h2 id="环境要求" tabindex="-1">环境要求 <a class="header-anchor" href="#环境要求" aria-label="Permalink to “环境要求”">​</a></h2><ul><li><strong>GraalVM</strong>: 25.0.0 或更高版本</li><li><strong>操作系统</strong>: macOS / Linux / Windows (需要 native-image 支持)</li><li><strong>构建工具</strong>: Gradle 9.0+ (项目已包含 Gradle Wrapper)</li><li><strong>磁盘空间</strong>: 至少 500MB (用于编译缓存)</li></ul><h3 id="验证-graalvm-安装" tabindex="-1">验证 GraalVM 安装 <a class="header-anchor" href="#验证-graalvm-安装" aria-label="Permalink to “验证 GraalVM 安装”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查 Java 版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -version</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 应显示: Oracle GraalVM 25+37.1 或类似版本</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查 native-image 工具</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">native-image</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 应显示: native-image 25.0.0 或更高版本</span></span></code></pre></div><p>如果 <code>native-image</code> 不可用,需要安装:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native-image</span></span></code></pre></div><h2 id="快速编译-推荐-pgo-优化版" tabindex="-1">快速编译 (推荐 - PGO 优化版) <a class="header-anchor" href="#快速编译-推荐-pgo-优化版" aria-label="Permalink to “快速编译 (推荐 - PGO 优化版)”">​</a></h2><p><strong>Step 1: 编译带性能剖析的二进制</strong> (~1分钟)</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -PpgoMode=instrument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-configuration-cache</span></span></code></pre></div><p><strong>Step 2: 收集性能 Profile</strong> (~10秒)</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行代表性工作负载</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/fibonacci_20_core.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/list_map_1000_core.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/quicksort_core.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/factorial_20_core.json</span></span></code></pre></div><p>Profile 数据会自动保存到 <code>default.iprof</code> 文件。</p><p><strong>Step 3: 使用 Profile 重新编译</strong> (~40秒)</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -PpgoMode=/absolute/path/to/aster-lang/default.iprof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --no-configuration-cache</span></span></code></pre></div><p><strong>注意</strong>: 必须使用绝对路径,相对路径会导致编译失败。</p><p><strong>结果</strong>:</p><ul><li>二进制大小: <strong>23 MB</strong> (相比 baseline 36.88MB 减少 37.6%)</li><li>启动时间: <strong>32ms</strong> (仍远低于 50ms 目标)</li></ul><h2 id="标准编译-baseline" tabindex="-1">标准编译 (Baseline) <a class="header-anchor" href="#标准编译-baseline" aria-label="Permalink to “标准编译 (Baseline)”">​</a></h2><p>如果不需要 PGO 优化,可以直接编译:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-configuration-cache</span></span></code></pre></div><p><strong>编译时间</strong>: 约 2-5 分钟 (首次编译,后续增量编译更快)</p><p><strong>结果</strong>:</p><ul><li>二进制大小: ~37 MB</li><li>启动时间: ~20ms</li></ul><h2 id="运行-native-image" tabindex="-1">运行 Native Image <a class="header-anchor" href="#运行-native-image" aria-label="Permalink to “运行 Native Image”">​</a></h2><p>编译完成后,可执行文件位于:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>aster-truffle/build/native/nativeCompile/aster</span></span></code></pre></div><h3 id="运行示例" tabindex="-1">运行示例 <a class="header-anchor" href="#运行示例" aria-label="Permalink to “运行示例”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行 Aster 程序</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/fibonacci_20_core.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出: 6765</span></span></code></pre></div><h3 id="添加到-path-可选" tabindex="-1">添加到 PATH (可选) <a class="header-anchor" href="#添加到-path-可选" aria-label="Permalink to “添加到 PATH (可选)”">​</a></h3><p>为了方便使用,可以创建符号链接或添加到 PATH:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 方法 1: 创建符号链接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)/aster-truffle/build/native/nativeCompile/aster&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 方法 2: 添加到 PATH (添加到 ~/.bashrc 或 ~/.zshrc)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)/aster-truffle/build/native/nativeCompile:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><p>然后可以直接运行:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your-program.aster</span></span></code></pre></div><h2 id="快速验证" tabindex="-1">快速验证 <a class="header-anchor" href="#快速验证" aria-label="Permalink to “快速验证”">​</a></h2><p>验证编译是否成功:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 检查二进制存在</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -lh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aster-truffle/build/native/nativeCompile/aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 检查二进制大小 (应为 23MB 或 37MB)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">du</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aster-truffle/build/native/nativeCompile/aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 运行测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/fibonacci_20_core.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 预期输出: 6765</span></span></code></pre></div><h2 id="性能对比" tabindex="-1">性能对比 <a class="header-anchor" href="#性能对比" aria-label="Permalink to “性能对比”">​</a></h2><table tabindex="0"><thead><tr><th>指标</th><th>JVM 版本</th><th>Native Image (Baseline)</th><th>Native Image (PGO)</th><th>提升</th></tr></thead><tbody><tr><td><strong>启动时间</strong></td><td>5-10s</td><td>~20ms</td><td>~32ms</td><td><strong>100-300x</strong></td></tr><tr><td><strong>内存占用</strong></td><td>300-500MB</td><td>&lt; 50MB</td><td>&lt; 50MB</td><td><strong>6-10x</strong></td></tr><tr><td><strong>二进制大小</strong></td><td>N/A (需要 JVM)</td><td>36.88MB</td><td>23MB</td><td><strong>独立部署</strong></td></tr><tr><td><strong>峰值性能</strong></td><td>高 (JIT 优化)</td><td>中 (解释器)</td><td>中 (解释器)</td><td>待优化</td></tr></tbody></table><p><strong>注意</strong>: 当前版本运行在 Truffle fallback runtime (解释器模式),峰值性能低于 JVM 版本。未来启用 Graal JIT 后性能将显著提升。</p><h2 id="下一步" tabindex="-1">下一步 <a class="header-anchor" href="#下一步" aria-label="Permalink to “下一步”">​</a></h2><ul><li><strong>详细构建指南</strong>: 查看 <a href="./build-guide.html">build-guide.md</a> 了解高级编译选项</li><li><strong>性能对比报告</strong>: 查看 <a href="./performance-comparison.html">performance-comparison.md</a> 了解详细性能数据</li><li><strong>故障排查</strong>: 遇到问题请查看 <a href="./troubleshooting.html">troubleshooting.md</a></li><li><strong>限制说明</strong>: 查看 <a href="./limitations.html">limitations.md</a> 了解已知限制</li></ul><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to “常见问题”">​</a></h2><p><strong>Q: 编译时间太长怎么办?</strong> A: Native Image 编译时间 2-5 分钟是正常现象。可以使用 <code>-Ob</code> (quick build mode) 加速开发时的编译,但会牺牲运行时性能。</p><p><strong>Q: 为什么 PGO 版本启动时间反而慢了?</strong> A: PGO 优化热路径执行,但在 Truffle fallback runtime (解释器模式) 下收益有限。主要收益是二进制大小减少 37.6%。</p><p><strong>Q: 可以在生产环境使用吗?</strong> A: ✅ 可以。Native Image 版本功能完整,适合容器化部署、Serverless、CI/CD 脚本等场景。启动时间和内存占用都远优于 JVM 版本。</p><p><strong>Q: 如何获得更好的峰值性能?</strong> A: 当前版本运行在解释器模式,峰值性能低于 JVM。未来需要修复 Truffle runtime 配置以启用 Graal JIT 编译器。</p><h2 id="反馈与支持" tabindex="-1">反馈与支持 <a class="header-anchor" href="#反馈与支持" aria-label="Permalink to “反馈与支持”">​</a></h2><p>遇到问题或有建议,请访问项目 GitHub Issues 页面。</p>`,52)])])}const c=i(n,[["render",l]]);export{o as __pageData,c as default};
