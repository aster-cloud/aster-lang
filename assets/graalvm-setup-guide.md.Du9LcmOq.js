import{_ as s,c as i,o as l,aj as e}from"./chunks/framework.Bz2R-749.js";const o=JSON.parse('{"title":"GraalVM Setup Guide","description":"","frontmatter":{},"headers":[],"relativePath":"graalvm-setup-guide.md","filePath":"graalvm-setup-guide.md"}'),t={name:"graalvm-setup-guide.md"};function n(h,a,r,p,k,d){return l(),i("div",null,[...a[0]||(a[0]=[e(`<h1 id="graalvm-setup-guide" tabindex="-1">GraalVM Setup Guide <a class="header-anchor" href="#graalvm-setup-guide" aria-label="Permalink to “GraalVM Setup Guide”">​</a></h1><p>本文档说明如何在 Aster 项目中安装和配置 GraalVM，以获得最佳的运行时性能和 JIT 编译优化。</p><h2 id="当前状态" tabindex="-1">当前状态 <a class="header-anchor" href="#当前状态" aria-label="Permalink to “当前状态”">​</a></h2><p>项目已配置使用 <strong>Oracle GraalVM 25+37.1</strong> (Java 25 LTS)，支持：</p><ul><li>✅ Truffle 框架 AST 解释执行</li><li>✅ GraalVM JIT 编译器优化</li><li>✅ Native Image 编译（可选）</li><li>✅ 多语言互操作性</li></ul><h2 id="验证-graalvm-安装" tabindex="-1">验证 GraalVM 安装 <a class="header-anchor" href="#验证-graalvm-安装" aria-label="Permalink to “验证 GraalVM 安装”">​</a></h2><h3 id="检查-java-版本" tabindex="-1">检查 Java 版本 <a class="header-anchor" href="#检查-java-版本" aria-label="Permalink to “检查 Java 版本”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -version</span></span></code></pre></div><p><strong>预期输出</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>java version &quot;25&quot; 2025-09-16 LTS</span></span>
<span class="line"><span>Java(TM) SE Runtime Environment Oracle GraalVM 25+37.1 (build 25+37-LTS-jvmci-b01)</span></span>
<span class="line"><span>Java HotSpot(TM) 64-Bit Server VM Oracle GraalVM 25+37.1 (build 25+37-LTS-jvmci-b01, mixed mode, sharing)</span></span></code></pre></div><p>关键标识：</p><ul><li><strong>Oracle GraalVM</strong>: 确认使用 GraalVM 而非标准 JDK</li><li><strong>jvmci-b01</strong>: JVMCI (Java VM Compiler Interface) 支持，用于 JIT 编译</li><li><strong>mixed mode</strong>: 支持解释执行和 JIT 编译混合模式</li></ul><h3 id="查找-graalvm-安装路径" tabindex="-1">查找 GraalVM 安装路径 <a class="header-anchor" href="#查找-graalvm-安装路径" aria-label="Permalink to “查找 GraalVM 安装路径”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">which</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> java</span></span></code></pre></div><p><strong>示例输出</strong> (macOS):</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>/Users/&lt;username&gt;/Library/Java/JavaVirtualMachines/graalvm-jdk-25+37.1/Contents/Home/bin/java</span></span></code></pre></div><p><strong>GRAALVM_HOME</strong> 应设置为:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GRAALVM_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/Users/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">username</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/Library/Java/JavaVirtualMachines/graalvm-jdk-25+37.1/Contents/Home</span></span></code></pre></div><h2 id="安装-graalvm-如果尚未安装" tabindex="-1">安装 GraalVM（如果尚未安装） <a class="header-anchor" href="#安装-graalvm-如果尚未安装" aria-label="Permalink to “安装 GraalVM（如果尚未安装）”">​</a></h2><h3 id="方法-1-使用-sdkman-推荐" tabindex="-1">方法 1: 使用 SDKMAN (推荐) <a class="header-anchor" href="#方法-1-使用-sdkman-推荐" aria-label="Permalink to “方法 1: 使用 SDKMAN (推荐)”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装 SDKMAN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://get.sdkman.io&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.sdkman/bin/sdkman-init.sh&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装 GraalVM</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sdk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> java</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 25-graal</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置为默认 JDK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sdk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> java</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 25-graal</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证安装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -version</span></span></code></pre></div><h3 id="方法-2-手动下载" tabindex="-1">方法 2: 手动下载 <a class="header-anchor" href="#方法-2-手动下载" aria-label="Permalink to “方法 2: 手动下载”">​</a></h3><ol><li>访问 <a href="https://www.graalvm.org/downloads/" target="_blank" rel="noreferrer">GraalVM Downloads</a></li><li>下载 <strong>GraalVM for JDK 25</strong> (推荐 Java 25 LTS)</li><li>解压到合适的目录</li><li>配置环境变量:</li></ol><p><strong>macOS/Linux</strong>:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在 ~/.zshrc 或 ~/.bashrc 中添加</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GRAALVM_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/path/to/graalvm-jdk-25</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$GRAALVM_HOME/bin:$PATH</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JAVA_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$GRAALVM_HOME</span></span></code></pre></div><p><strong>Windows</strong>:</p><div class="language-powershell"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置系统环境变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">setx GRAALVM_HOME </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;C:\\path\\to\\graalvm-jdk-25&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">setx PATH </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;%GRAALVM_HOME%\\bin;%PATH%&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">setx JAVA_HOME </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;%GRAALVM_HOME%&quot;</span></span></code></pre></div><h3 id="方法-3-使用-homebrew-macos" tabindex="-1">方法 3: 使用 Homebrew (macOS) <a class="header-anchor" href="#方法-3-使用-homebrew-macos" aria-label="Permalink to “方法 3: 使用 Homebrew (macOS)”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加 GraalVM tap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cask</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> graalvm/tap/graalvm-jdk25</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置环境变量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GRAALVM_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/Library/Java/JavaVirtualMachines/graalvm-jdk-25/Contents/Home</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$GRAALVM_HOME/bin:$PATH</span></span></code></pre></div><h2 id="graalvm-组件" tabindex="-1">GraalVM 组件 <a class="header-anchor" href="#graalvm-组件" aria-label="Permalink to “GraalVM 组件”">​</a></h2><h3 id="核心组件-已包含" tabindex="-1">核心组件（已包含） <a class="header-anchor" href="#核心组件-已包含" aria-label="Permalink to “核心组件（已包含）”">​</a></h3><ul><li><strong>Java Runtime</strong>: 标准 Java SE 运行时</li><li><strong>HotSpot VM</strong>: 高性能虚拟机</li><li><strong>Graal Compiler</strong>: 先进的 JIT 编译器</li><li><strong>Truffle Framework</strong>: 语言实现框架（通过依赖自动包含）</li></ul><h3 id="可选组件" tabindex="-1">可选组件 <a class="header-anchor" href="#可选组件" aria-label="Permalink to “可选组件”">​</a></h3><h4 id="native-image-用于原生编译" tabindex="-1">Native Image（用于原生编译） <a class="header-anchor" href="#native-image-用于原生编译" aria-label="Permalink to “Native Image（用于原生编译）”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用 GraalVM 自带的 gu (GraalVM Updater)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native-image</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证安装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">native-image</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span></span></code></pre></div><p><strong>用途</strong>:</p><ul><li>将 Java 应用编译为原生可执行文件</li><li>极快的启动时间（毫秒级）</li><li>更低的内存占用</li><li>无需 JVM 即可运行</li></ul><h4 id="javascript-node-js-可选" tabindex="-1">JavaScript/Node.js（可选） <a class="header-anchor" href="#javascript-node-js-可选" aria-label="Permalink to “JavaScript/Node.js（可选）”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodejs</span></span></code></pre></div><h2 id="在-aster-项目中使用-graalvm" tabindex="-1">在 Aster 项目中使用 GraalVM <a class="header-anchor" href="#在-aster-项目中使用-graalvm" aria-label="Permalink to “在 Aster 项目中使用 GraalVM”">​</a></h2><h3 id="运行基准测试" tabindex="-1">运行基准测试 <a class="header-anchor" href="#运行基准测试" aria-label="Permalink to “运行基准测试”">​</a></h3><p>项目已配置使用 GraalVM JIT 编译器进行性能测试：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 所有基准测试（包括 GraalVM JIT）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bench:all</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 仅 GraalVM JIT 基准测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bench:jit</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或使用 Gradle 直接运行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tests</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GraalVMJitBenchmark&quot;</span></span></code></pre></div><h3 id="运行-truffle-解释器" tabindex="-1">运行 Truffle 解释器 <a class="header-anchor" href="#运行-truffle-解释器" aria-label="Permalink to “运行 Truffle 解释器”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Truffle 基准测试（使用 GraalVM 运行时）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bench:truffle</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行单个 Truffle 测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tests</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ExecutionTestSuite&quot;</span></span></code></pre></div><h3 id="配置-jit-编译选项" tabindex="-1">配置 JIT 编译选项 <a class="header-anchor" href="#配置-jit-编译选项" aria-label="Permalink to “配置 JIT 编译选项”">​</a></h3><p>在运行测试时可以传递 GraalVM 特定的 JVM 参数：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用详细的 JIT 编译日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tests</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GraalVMJitBenchmark&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -Dgraal.TraceTruffleCompilation=true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 调整编译阈值（默认值适合大多数情况）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -Dgraal.TruffleCompilationThreshold=1000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用 JIT 编译（仅解释执行，用于对比）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -Dgraal.TruffleCompileOnly=__never__</span></span></code></pre></div><h2 id="性能优化建议" tabindex="-1">性能优化建议 <a class="header-anchor" href="#性能优化建议" aria-label="Permalink to “性能优化建议”">​</a></h2><h3 id="_1-预热阶段" tabindex="-1">1. 预热阶段 <a class="header-anchor" href="#_1-预热阶段" aria-label="Permalink to “1. 预热阶段”">​</a></h3><p>GraalVM JIT 编译器需要&quot;预热&quot;才能达到最佳性能：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 基准测试中的 3 阶段策略</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Phase </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 冷启动 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 次，触发编译</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Phase </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 追加预热 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 次，等待优化稳定</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Phase </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 测量阶段（</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 次），收集性能数据</span></span></code></pre></div><p><strong>原因</strong>:</p><ul><li>第 1 阶段：触发 JIT 编译器识别热点代码</li><li>第 2 阶段：优化器应用推测性优化</li><li>第 3 阶段：稳定状态下的真实性能</li></ul><h3 id="_2-避免反优化" tabindex="-1">2. 避免反优化 <a class="header-anchor" href="#_2-避免反优化" aria-label="Permalink to “2. 避免反优化”">​</a></h3><p>某些代码模式会导致 JIT 编译器&quot;反优化&quot;（deoptimization）：</p><p><strong>避免</strong>:</p><ul><li>频繁的类型变化（如同一变量存储不同类型）</li><li>过度使用反射</li><li>未初始化的分支（dead code）</li></ul><p><strong>推荐</strong>:</p><ul><li>保持类型稳定</li><li>使用 Truffle DSL 注解（<code>@Specialization</code>）</li><li>明确的类型特化</li></ul><h3 id="_3-内存管理" tabindex="-1">3. 内存管理 <a class="header-anchor" href="#_3-内存管理" aria-label="Permalink to “3. 内存管理”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置堆大小（对长时间运行的测试有帮助）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dorg.gradle.jvmargs=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-Xms2g -Xmx4g&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用 G1GC（GraalVM 推荐的 GC）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dorg.gradle.jvmargs=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-XX:+UseG1GC&quot;</span></span></code></pre></div><h3 id="_4-诊断工具" tabindex="-1">4. 诊断工具 <a class="header-anchor" href="#_4-诊断工具" aria-label="Permalink to “4. 诊断工具”">​</a></h3><h4 id="truffle-编译跟踪" tabindex="-1">Truffle 编译跟踪 <a class="header-anchor" href="#truffle-编译跟踪" aria-label="Permalink to “Truffle 编译跟踪”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看哪些函数被编译</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-Dgraal.TraceTruffleCompilation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看编译队列状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-Dgraal.TraceTruffleCompilationDetails</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看反优化原因</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-Dgraal.TraceTruffleTransferToInterpreter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><h4 id="性能剖析" tabindex="-1">性能剖析 <a class="header-anchor" href="#性能剖析" aria-label="Permalink to “性能剖析”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用 JFR (Java Flight Recorder) 进行低开销剖析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-XX:StartFlightRecording</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=duration=60s,filename=recording.jfr</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 分析 JFR 文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jfr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> print</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> recording.jfr</span></span></code></pre></div><h2 id="性能预期" tabindex="-1">性能预期 <a class="header-anchor" href="#性能预期" aria-label="Permalink to “性能预期”">​</a></h2><p>基于 Aster 项目的实际基准测试结果：</p><h3 id="graalvm-jit-vs-truffle-解释器" tabindex="-1">GraalVM JIT vs Truffle 解释器 <a class="header-anchor" href="#graalvm-jit-vs-truffle-解释器" aria-label="Permalink to “GraalVM JIT vs Truffle 解释器”">​</a></h3><table tabindex="0"><thead><tr><th>基准测试</th><th>Truffle 解释器</th><th>GraalVM JIT</th><th>加速比</th></tr></thead><tbody><tr><td>Fibonacci(20)</td><td>~150 ms/迭代 (估算)</td><td>26.25 ms/迭代</td><td>~5.7x</td></tr><tr><td>Factorial(12)</td><td>~30 ms/迭代 (估算)</td><td>5.0 ms/迭代</td><td>~6x</td></tr><tr><td>QuickSort(100)</td><td>~500 ms/迭代 (估算)</td><td>99.37 ms/迭代</td><td>~5x</td></tr><tr><td>BinaryTree(15)</td><td>~0.5 ms/迭代 (估算)</td><td>0.074 ms/迭代</td><td>~6.8x</td></tr><tr><td>StringOps</td><td>~2 ms/迭代 (估算)</td><td>0.288 ms/迭代</td><td>~7x</td></tr></tbody></table><p><strong>结论</strong>: GraalVM JIT 通常提供 <strong>5-10x</strong> 的性能提升。</p><h3 id="graalvm-jit-vs-pure-java-字节码" tabindex="-1">GraalVM JIT vs Pure Java 字节码 <a class="header-anchor" href="#graalvm-jit-vs-pure-java-字节码" aria-label="Permalink to “GraalVM JIT vs Pure Java 字节码”">​</a></h3><p>Pure Java 字节码直接编译更快，但 GraalVM JIT 在长时间运行后接近：</p><table tabindex="0"><thead><tr><th>基准测试</th><th>Pure Java</th><th>GraalVM JIT</th><th>比率</th></tr></thead><tbody><tr><td>Fibonacci(20)</td><td>~15 ms/迭代 (估算)</td><td>26.25 ms/迭代</td><td>1.75x</td></tr><tr><td>Factorial(12)</td><td>~2 ms/迭代 (估算)</td><td>5.0 ms/迭代</td><td>2.5x</td></tr></tbody></table><p><strong>使用建议</strong>:</p><ul><li><strong>短期任务 (&lt;1 秒)</strong>: Pure Java 字节码更快</li><li><strong>长期任务 (&gt;10 秒)</strong>: GraalVM JIT 性能接近或超过</li><li><strong>开发阶段</strong>: Truffle 解释器提供最佳调试体验</li></ul><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to “常见问题”">​</a></h2><h3 id="q-为什么我的基准测试结果不稳定" tabindex="-1">Q: 为什么我的基准测试结果不稳定？ <a class="header-anchor" href="#q-为什么我的基准测试结果不稳定" aria-label="Permalink to “Q: 为什么我的基准测试结果不稳定？”">​</a></h3><p><strong>A</strong>: JIT 编译器的行为受多种因素影响：</p><ol><li><strong>预热不足</strong>: 增加预热迭代次数</li><li><strong>系统负载</strong>: 在专用环境中运行基准测试</li><li><strong>GC 干扰</strong>: 增加堆大小或调整 GC 策略</li><li><strong>编译触发</strong>: 确保代码被多次执行以触发编译</li></ol><h3 id="q-如何确认-jit-编译已启用" tabindex="-1">Q: 如何确认 JIT 编译已启用？ <a class="header-anchor" href="#q-如何确认-jit-编译已启用" aria-label="Permalink to “Q: 如何确认 JIT 编译已启用？”">​</a></h3><p><strong>A</strong>: 使用跟踪标志：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-Dgraal.TraceTruffleCompilation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>输出应包含类似：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>[truffle] opt done         fib                    |Tier 2|Time 123ms</span></span></code></pre></div><h3 id="q-为什么-native-image-编译失败" tabindex="-1">Q: 为什么 Native Image 编译失败？ <a class="header-anchor" href="#q-为什么-native-image-编译失败" aria-label="Permalink to “Q: 为什么 Native Image 编译失败？”">​</a></h3><p><strong>A</strong>: Native Image 有一些限制：</p><ol><li><strong>反射</strong>: 需要配置文件（<code>reflect-config.json</code>）</li><li><strong>动态代理</strong>: 需要 <code>proxy-config.json</code></li><li><strong>JNI</strong>: 需要 <code>jni-config.json</code></li></ol><p>使用 <code>native-image-agent</code> 自动生成配置：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -agentlib:native-image-agent=config-output-dir=META-INF/native-image</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your-app.jar</span></span></code></pre></div><h3 id="q-graalvm-的内存占用比标准-jdk-高吗" tabindex="-1">Q: GraalVM 的内存占用比标准 JDK 高吗？ <a class="header-anchor" href="#q-graalvm-的内存占用比标准-jdk-高吗" aria-label="Permalink to “Q: GraalVM 的内存占用比标准 JDK 高吗？”">​</a></h3><p><strong>A</strong>:</p><ul><li><strong>运行时</strong>: 相似或略高（因为 JIT 编译器缓存）</li><li><strong>Native Image</strong>: 显著更低（无需 JVM）</li></ul><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to “参考资料”">​</a></h2><h3 id="官方文档" tabindex="-1">官方文档 <a class="header-anchor" href="#官方文档" aria-label="Permalink to “官方文档”">​</a></h3><ul><li><a href="https://www.graalvm.org/" target="_blank" rel="noreferrer">GraalVM Official Website</a></li><li><a href="https://www.graalvm.org/latest/docs/" target="_blank" rel="noreferrer">GraalVM Documentation</a></li><li><a href="https://www.graalvm.org/latest/graalvm-as-a-platform/language-implementation-framework/" target="_blank" rel="noreferrer">Truffle Language Implementation Framework</a></li><li><a href="https://www.graalvm.org/latest/reference-manual/native-image/" target="_blank" rel="noreferrer">Native Image</a></li></ul><h3 id="aster-项目文档" tabindex="-1">Aster 项目文档 <a class="header-anchor" href="#aster-项目文档" aria-label="Permalink to “Aster 项目文档”">​</a></h3><ul><li><a href="./performance-regression-monitoring.html">Performance Regression Monitoring</a></li><li><a href="./truffle-performance-comparison.html">Truffle Performance Comparison</a></li><li><a href="./cross-backend-benchmark-results.html">Cross-Backend Benchmark Results</a></li></ul><h3 id="社区资源" tabindex="-1">社区资源 <a class="header-anchor" href="#社区资源" aria-label="Permalink to “社区资源”">​</a></h3><ul><li><a href="https://github.com/oracle/graal" target="_blank" rel="noreferrer">GraalVM GitHub</a></li><li><a href="https://github.com/oracle/graal/tree/master/truffle" target="_blank" rel="noreferrer">Truffle GitHub</a></li><li><a href="https://www.graalvm.org/community/" target="_blank" rel="noreferrer">GraalVM Slack Community</a></li></ul><h2 id="版本历史" tabindex="-1">版本历史 <a class="header-anchor" href="#版本历史" aria-label="Permalink to “版本历史”">​</a></h2><ul><li><strong>v1.0</strong> (2025-11-03): 初始版本，基于 Oracle GraalVM 25+37.1</li><li>项目依赖: Truffle API 25.0.0, Truffle Runtime 25.0.0</li></ul>`,103)])])}const c=s(t,[["render",n]]);export{o as __pageData,c as default};
