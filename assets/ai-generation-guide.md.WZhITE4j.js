import{_ as i,c as a,o as t,aj as e}from"./chunks/framework.Bz2R-749.js";const c=JSON.parse('{"title":"AI 代码生成用户指南","description":"","frontmatter":{},"headers":[],"relativePath":"ai-generation-guide.md","filePath":"ai-generation-guide.md"}'),n={name:"ai-generation-guide.md"};function d(l,s,h,r,o,p){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="ai-代码生成用户指南" tabindex="-1">AI 代码生成用户指南 <a class="header-anchor" href="#ai-代码生成用户指南" aria-label="Permalink to “AI 代码生成用户指南”">​</a></h1><p>更新日期：2025-11-25 21:41 NZST · 执行者：Codex</p><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p>AI 代码生成流程由 <code>./dist/scripts/aster.js ai-generate</code> 命令驱动，通过 Prompt Manager + Few-shot 示例构建出完整提示，再调用 <code>AIGenerator</code> 协调 LLM Provider、验证器与 Provenance 追踪器。Phase 3.4 已实测达到 81.3% 准确率基线（13/16，用例集来源 <code>test/ai-generation/dev.jsonl</code>），并通过磁盘缓存与并发执行将批量生成耗时降至 ❤️ 分钟。</p><h2 id="快速开始" tabindex="-1">快速开始 <a class="header-anchor" href="#快速开始" aria-label="Permalink to “快速开始”">​</a></h2><ol><li><strong>安装依赖</strong><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span></code></pre></div></li><li><strong>配置 API 密钥</strong>（根据 provider 选择）<div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-ant-...&quot;</span></span></code></pre></div></li><li><strong>运行生成命令</strong><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Send tagged PII data over HTTP and redact fields&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openai</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gpt-4-turbo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --few-shot-count</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span></code></pre></div></li><li><strong>查看输出</strong>：若未指定 <code>--output</code>，生成的 CNL 代码将直接打印到终端，并附带验证结果、Token 统计与缓存命中信息。</li></ol><blockquote><p>完成一次生成后，可运行 <code>npm run ai:evaluate</code> 结合 <code>/tmp/phase3.4-systematic-test-results.json</code> 生成 <code>.claude/evaluation-report.md</code>，对比当前准确率与 Phase 3.4 指标。</p></blockquote><h2 id="命令选项" tabindex="-1">命令选项 <a class="header-anchor" href="#命令选项" aria-label="Permalink to “命令选项”">​</a></h2><table tabindex="0"><thead><tr><th>选项</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>\`--provider &lt;openai</td><td>anthropic&gt;\`</td><td>指定底层 LLM Provider，默认为 OpenAI。</td></tr><tr><td><code>--model &lt;name&gt;</code></td><td>选择具体模型，影响提示长度与费用。</td><td><code>--model claude-3-5-sonnet-20241022</code></td></tr><tr><td><code>--temperature &lt;0-1&gt;</code></td><td>控制生成多样性。0.7 为默认，较低温度更稳定。</td><td><code>--temperature 0.4</code></td></tr><tr><td><code>--few-shot-count &lt;n&gt;</code></td><td>选择 Few-shot 示例数量，默认 5。</td><td><code>--few-shot-count 3</code></td></tr><tr><td><code>--output &lt;file&gt;</code></td><td>将结果写入文件而非控制台。</td><td><code>--output /tmp/dev-001.aster</code></td></tr><tr><td><code>--no-cache</code></td><td>禁用磁盘缓存，确保每次都调 LLM。</td><td><code>--no-cache</code></td></tr></tbody></table><p><strong>提示</strong>：缓存命中键格式为 <code>\${provider}-\${model}-temp\${temperature}-fs\${fewShotCount}-\${hash(description)}</code>，文件位于 <code>.cache/ai-generation/</code>。</p><h2 id="使用示例" tabindex="-1">使用示例 <a class="header-anchor" href="#使用示例" aria-label="Permalink to “使用示例”">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成代码并保存到文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Join first and last name with a single space&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openai</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gpt-4-turbo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tmp/full-name.aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在禁用缓存的情况下获取最新响应</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Declare both HTTP and SQL capabilities&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openai</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gpt-4-turbo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --no-cache</span></span></code></pre></div><h2 id="提示词最佳实践" tabindex="-1">提示词最佳实践 <a class="header-anchor" href="#提示词最佳实践" aria-label="Permalink to “提示词最佳实践”">​</a></h2><ul><li><strong>描述情境与输入输出</strong>：写清楚输入来源（HTTP/SQL/PII 字段）与期望输出结构。</li><li><strong>列出约束</strong>：如需声明 capability、处理 PII、或遵循特定错误处理方式，请直白写出。</li><li><strong>拆分步骤</strong>：采用“分析 → 生成 → 验证”语句，帮助模型理解完整流程。</li><li><strong>控制长度</strong>：避免堆砌上下文；简洁且信息密度高的描述更容易命中缓存。</li><li><strong>示例</strong>： <ul><li>✅ <code>&quot;Score a loan request by checking credit score &gt;= 720, debt ratio &lt;= 0.35, then assign risk: LOW/MED/HIGH&quot;</code></li><li>❌ <code>&quot;Handle loan scoring&quot;</code></li></ul></li></ul><h2 id="faq" tabindex="-1">FAQ <a class="header-anchor" href="#faq" aria-label="Permalink to “FAQ”">​</a></h2><ul><li><strong>问：命令提示缺少 API Key？</strong> 答：根据 provider 设置 <code>OPENAI_API_KEY</code> 或 <code>ANTHROPIC_API_KEY</code> 环境变量，重新运行命令即可。</li><li><strong>问：如何验证准确率？</strong> 答：运行 <code>/tmp/run-systematic-tests.mjs</code> 生成结果，再执行 <code>npm run ai:evaluate</code>，即可在 <code>.claude/evaluation-report.md</code> 查看准确率（Phase 3.4 结果：80.0%，受 6 个 rate limit 错误影响）。</li><li><strong>问：何时需要 <code>--no-cache</code>？</strong> 答：在 Few-shot 模板或描述频繁调整且需要最新响应时使用。默认启用缓存可节省 96% 再次运行时间。</li><li><strong>问：是否支持多 provider？</strong> 答：目前提供 OpenAI、Anthropic 两种实现，新增 provider 需实现 <code>LLMProvider</code> 接口，详见架构文档。</li></ul><h2 id="故障排查" tabindex="-1">故障排查 <a class="header-anchor" href="#故障排查" aria-label="Permalink to “故障排查”">​</a></h2><table tabindex="0"><thead><tr><th>问题</th><th>现象</th><th>排查步骤</th><th>解决方法</th></tr></thead><tbody><tr><td>Rate limit (429)</td><td>CLI 输出 <code>Rate limit reached for gpt-4-turbo-preview</code></td><td>查看并发数（默认 3）、检查 token 使用量</td><td>等待限流重置、降低并发、切换模型、或拆分批次。</td></tr><tr><td>缓存未命中</td><td>每次都调用 LLM，日志 <code>⚡ 緩存狀態: 未命中</code></td><td>确认描述完全一致、检查 <code>.cache/ai-generation/</code> 是否存在</td><td>复制描述文本，确保未启用 <code>--no-cache</code>，必要时重建缓存目录。</td></tr><tr><td>验证未通过</td><td>CLI 显示警告/错误列表</td><td>检查 <code>result.validation.diagnostics</code> 输出</td><td>按提示修改描述或手动编辑生成代码后再验证。</td></tr><tr><td>输出乱码</td><td>终端语系导致 provenance 头出现字符异常</td><td>检查终端编码</td><td>使用 UTF-8 终端或将结果写入文件查看。</td></tr></tbody></table><h2 id="相关资源" tabindex="-1">相关资源 <a class="header-anchor" href="#相关资源" aria-label="Permalink to “相关资源”">​</a></h2><ul><li>Phase 3.4 实施总结：<code>.claude/phase3.4-completion-summary.md</code></li><li>最新评估报告：<code>.claude/evaluation-report.md</code></li><li>缓存实现：<code>src/ai/generation-cache.ts</code></li><li>评估脚本：<code>scripts/evaluate-ai-generation.mjs</code></li></ul>`,20)])])}const g=i(n,[["render",d]]);export{c as __pageData,g as default};
