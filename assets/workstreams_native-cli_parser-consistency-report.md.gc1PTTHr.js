import{_ as i,c as a,o as n,aj as t}from"./chunks/framework.Bz2R-749.js";const g=JSON.parse('{"title":"Parser Consistency Report: TypeScript vs Java","description":"","frontmatter":{},"headers":[],"relativePath":"workstreams/native-cli/parser-consistency-report.md","filePath":"workstreams/native-cli/parser-consistency-report.md"}'),l={name:"workstreams/native-cli/parser-consistency-report.md"};function e(h,s,p,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="parser-consistency-report-typescript-vs-java" tabindex="-1">Parser Consistency Report: TypeScript vs Java <a class="header-anchor" href="#parser-consistency-report-typescript-vs-java" aria-label="Permalink to â€œParser Consistency Report: TypeScript vs Javaâ€">â€‹</a></h1><h2 id="æ‘˜è¦" tabindex="-1">æ‘˜è¦ <a class="header-anchor" href="#æ‘˜è¦" aria-label="Permalink to â€œæ‘˜è¦â€">â€‹</a></h2><p>å¯¹ Aster Lang çš„ TypeScript å’Œ Java è§£æå™¨è¿›è¡Œäº†è¯¦ç»†å¯¹æ¯”åˆ†æ,å‘ç°ä¸¤è€…è¾“å‡º<strong>å¹¶éå®Œå…¨ä¸€è‡´</strong>,å­˜åœ¨ä»¥ä¸‹å…³é”®å·®å¼‚:</p><ol><li><strong>ä¸¥é‡Bug</strong>: TypeScript è§£æå™¨çš„ <code>nameSpan</code> å­—æ®µè®¡ç®—é”™è¯¯</li><li><strong>è¯­ä¹‰å·®å¼‚</strong>: <code>annotations</code> å­—æ®µå¤„ç†ä¸ä¸€è‡´</li><li><strong>ç²¾åº¦å·®å¼‚</strong>: span ä½ç½®è®¡ç®—å­˜åœ¨å¾®å°åç§»</li></ol><h2 id="æµ‹è¯•è¦†ç›–" tabindex="-1">æµ‹è¯•è¦†ç›– <a class="header-anchor" href="#æµ‹è¯•è¦†ç›–" aria-label="Permalink to â€œæµ‹è¯•è¦†ç›–â€">â€‹</a></h2><p>å·²æ·»åŠ  <code>MainIntegrationTest.parserConsistencyBetweenTypeScriptAndJava()</code> æµ‹è¯•,éªŒè¯ä¸¤ä¸ªè§£æå™¨çš„è¾“å‡ºä¸€è‡´æ€§ã€‚</p><p>æµ‹è¯•æ–‡ä»¶:</p><ul><li><code>test/cnl/programs/parser-tests/simple_function.aster</code> - ç®€å•å‡½æ•°</li><li><code>test/cnl/programs/basics/test_second_func.aster</code> - å¸¦æ¡ä»¶è¯­å¥çš„å‡½æ•°</li><li><code>test/cnl/programs/generics/id_generic.aster</code> - æ³›å‹å‡½æ•°</li><li><code>test/cnl/programs/basics/test_return_with.aster</code> - å¸¦è¿”å›å€¼çš„å‡½æ•°</li></ul><h2 id="å‘ç°çš„å·®å¼‚" tabindex="-1">å‘ç°çš„å·®å¼‚ <a class="header-anchor" href="#å‘ç°çš„å·®å¼‚" aria-label="Permalink to â€œå‘ç°çš„å·®å¼‚â€">â€‹</a></h2><h3 id="_1-ğŸ›-typescript-namespan-bug-ä¸¥é‡" tabindex="-1">1. ğŸ› TypeScript nameSpan Bug (ä¸¥é‡) <a class="header-anchor" href="#_1-ğŸ›-typescript-namespan-bug-ä¸¥é‡" aria-label="Permalink to â€œ1. ğŸ› TypeScript nameSpan Bug (ä¸¥é‡)â€">â€‹</a></h3><p><strong>é—®é¢˜æè¿°</strong>: TypeScript è§£æå™¨çš„ <code>nameSpan.end</code> æŒ‡å‘å‡½æ•°<strong>ç»“æŸä½ç½®</strong>è€Œéå‡½æ•°<strong>åç§°ç»“æŸä½ç½®</strong></p><p><strong>æµ‹è¯•ç”¨ä¾‹</strong> (<code>simple_function.aster</code>):</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>This module is simple.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To main, produce Int:</span></span>
<span class="line"><span>  Return 42.</span></span></code></pre></div><p><strong>TypeScript è¾“å‡º</strong>:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nameSpan&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;col&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;col&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ é”™è¯¯!æŒ‡å‘å‡½æ•°ç»“æŸä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Java è¾“å‡º</strong>:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nameSpan&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;col&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;col&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… æ­£ç¡®!æŒ‡å‘&quot;main&quot;ç»“æŸä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>å½±å“</strong>:</p><ul><li>LSP åŠŸèƒ½(å¦‚ rename, go-to-definition)å¯èƒ½å·¥ä½œä¸æ­£å¸¸</li><li>ä»£ç å¯¼èˆªå·¥å…·å¯èƒ½å®šä½é”™è¯¯</li></ul><p><strong>çŠ¶æ€</strong>: âœ… <strong>å·²ä¿®å¤</strong> (2025-10-25)</p><h3 id="_2-âœ…-annotations-å­—æ®µå·²ç»Ÿä¸€" tabindex="-1">2. âœ… annotations å­—æ®µå·²ç»Ÿä¸€ <a class="header-anchor" href="#_2-âœ…-annotations-å­—æ®µå·²ç»Ÿä¸€" aria-label="Permalink to â€œ2. âœ… annotations å­—æ®µå·²ç»Ÿä¸€â€">â€‹</a></h3><p><strong>ä¿®å¤å‰å·®å¼‚</strong>:</p><ul><li><strong>Java</strong>: <code>retType</code> åŒ…å« <code>annotations</code> å­—æ®µ(ç©ºæ•°ç»„)</li><li><strong>TypeScript</strong>: <code>retType</code> ä¸åŒ…å« <code>annotations</code> å­—æ®µ</li></ul><p><strong>ä¿®å¤å</strong>:</p><ul><li><strong>Java</strong>: <code>retType</code> åŒ…å« <code>annotations: []</code></li><li><strong>TypeScript</strong>: <code>retType</code> åŒ…å« <code>annotations: []</code></li></ul><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç»Ÿä¸€åçš„è¾“å‡ºæ ¼å¼ï¼ˆTypeScript å’Œ Javaï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;retType&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;kind&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TypeName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Int&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;annotations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸¤è€…éƒ½åŒ…å«æ­¤å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;span&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>ä¿®å¤è¯´æ˜</strong>:</p><ol><li>åœ¨ <code>src/types.ts</code> ä¸­ä¸º TypeName æ¥å£æ·»åŠ  <code>annotations</code> å­—æ®µ</li><li>åœ¨ <code>src/ast.ts</code> ä¸­æ›´æ–° TypeName æ„é€ å™¨ï¼ŒåŒ…å«ç©ºæ•°ç»„</li><li>æ›´æ–°æµ‹è¯•æ–‡ä»¶ä»¥åŒ¹é…æ–°çš„ç±»å‹å®šä¹‰</li><li>åœ¨ <code>MainIntegrationTest.java</code> ä¸­æ·»åŠ  annotations å­—æ®µéªŒè¯</li></ol><p><strong>å½±å“</strong>:</p><ul><li>JSON åºåˆ—åŒ–/ååºåˆ—åŒ–ç°åœ¨å®Œå…¨ä¸€è‡´</li><li>æé«˜äº†ä¸¤ä¸ªè§£æå™¨çš„äº’æ“ä½œæ€§</li></ul><p><strong>çŠ¶æ€</strong>: âœ… <strong>å·²ä¿®å¤</strong> (2025-10-25)</p><h3 id="_3-ğŸ“-span-ä½ç½®è®¡ç®—å¾®å°å·®å¼‚" tabindex="-1">3. ğŸ“ span ä½ç½®è®¡ç®—å¾®å°å·®å¼‚ <a class="header-anchor" href="#_3-ğŸ“-span-ä½ç½®è®¡ç®—å¾®å°å·®å¼‚" aria-label="Permalink to â€œ3. ğŸ“ span ä½ç½®è®¡ç®—å¾®å°å·®å¼‚â€">â€‹</a></h3><p>ä¸åŒèŠ‚ç‚¹çš„ span end ä½ç½®æœ‰ 1-2 åˆ—çš„åç§»å·®å¼‚ã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><ul><li>Module span.end: TypeScript (line 5, col 1) vs Java (line 5, col 6)</li><li>Func span.end: TypeScript (line 5, col 1) vs Java (line 5, col 9)</li></ul><p><strong>å½±å“</strong>:</p><ul><li>è¯­æ³•é«˜äº®å¯èƒ½ç•¥æœ‰å·®å¼‚</li><li>ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½</li></ul><p><strong>çŠ¶æ€</strong>: ğŸ“ <strong>éœ€è¦è¿›ä¸€æ­¥å®¡æŸ¥è§„èŒƒ</strong></p><h2 id="æµ‹è¯•å®ç°" tabindex="-1">æµ‹è¯•å®ç° <a class="header-anchor" href="#æµ‹è¯•å®ç°" aria-label="Permalink to â€œæµ‹è¯•å®ç°â€">â€‹</a></h2><h3 id="æµ‹è¯•ä½ç½®" tabindex="-1">æµ‹è¯•ä½ç½® <a class="header-anchor" href="#æµ‹è¯•ä½ç½®" aria-label="Permalink to â€œæµ‹è¯•ä½ç½®â€">â€‹</a></h3><p><code>aster-lang-cli/src/test/java/aster/cli/MainIntegrationTest.java:300</code></p><h3 id="æµ‹è¯•ç­–ç•¥" tabindex="-1">æµ‹è¯•ç­–ç•¥ <a class="header-anchor" href="#æµ‹è¯•ç­–ç•¥" aria-label="Permalink to â€œæµ‹è¯•ç­–ç•¥â€">â€‹</a></h3><ol><li>è§£æåŒä¸€æ–‡ä»¶,è·å– TypeScript å’Œ Java è¾“å‡º</li><li>éªŒè¯æ ¸å¿ƒç»“æ„ä¸€è‡´(kind, name, decls å­˜åœ¨)</li><li>éªŒè¯ Java nameSpan æ­£ç¡®æ€§</li><li>è®°å½• TypeScript nameSpan Bug(ä¸ fail æµ‹è¯•,å› ä¸ºè¿™æ˜¯å·²çŸ¥é—®é¢˜)</li><li>å…è®¸ annotations ç­‰æ— å®³å­—æ®µå·®å¼‚</li></ol><h3 id="æµ‹è¯•è¾“å‡º" tabindex="-1">æµ‹è¯•è¾“å‡º <a class="header-anchor" href="#æµ‹è¯•è¾“å‡º" aria-label="Permalink to â€œæµ‹è¯•è¾“å‡ºâ€">â€‹</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>è§£æå™¨ä¸€è‡´æ€§æ£€æŸ¥å®Œæˆ: test/cnl/programs/parser-tests/simple_function.aster</span></span>
<span class="line"><span>å·²çŸ¥å·®å¼‚: TypeScript nameSpan BUGï¼ˆæŒ‡å‘å‡½æ•°ç»“æŸè€Œéåç§°ç»“æŸï¼‰</span></span>
<span class="line"><span>å·²çŸ¥å·®å¼‚: Java åŒ…å« annotations å­—æ®µï¼ŒTypeScript ä¸åŒ…å«</span></span></code></pre></div><h2 id="ä¿®å¤è®°å½•" tabindex="-1">ä¿®å¤è®°å½• <a class="header-anchor" href="#ä¿®å¤è®°å½•" aria-label="Permalink to â€œä¿®å¤è®°å½•â€">â€‹</a></h2><h3 id="âœ…-namespan-bug-ä¿®å¤-2025-10-25" tabindex="-1">âœ… nameSpan Bug ä¿®å¤ (2025-10-25) <a class="header-anchor" href="#âœ…-namespan-bug-ä¿®å¤-2025-10-25" aria-label="Permalink to â€œâœ… nameSpan Bug ä¿®å¤ (2025-10-25)â€">â€‹</a></h3><p><strong>ä¿®æ”¹æ–‡ä»¶</strong>: <code>src/parser/decl-parser.ts</code></p><p><strong>é—®é¢˜</strong>: nameSpan.end åœ¨å‡½æ•°è§£æå®Œæˆåæ‰è®¡ç®—,å¯¼è‡´æŒ‡å‘å‡½æ•°ç»“æŸä½ç½®</p><p><strong>ä¿®å¤å‰</strong>:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nameTok</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">peek</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parseIdent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ... è§£æå‡½æ•°å…¶ä»–éƒ¨åˆ†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nameSpanEndTok</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.tokens[ctx.index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ æŒ‡å‘å‡½æ•°ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).nameSpan </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> spanFromSources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nameTok, nameSpanEndTok);</span></span></code></pre></div><p><strong>ä¿®å¤å</strong>:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nameTok</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">peek</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parseIdent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nameEndTok</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.tokens[ctx.index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… ç«‹å³ä¿å­˜åç§°ç»“æŸä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ... è§£æå‡½æ•°å…¶ä»–éƒ¨åˆ†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).nameSpan </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> spanFromSources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nameTok, nameEndTok);</span></span></code></pre></div><p><strong>éªŒè¯</strong>: æ‰€æœ‰è§£æå™¨ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡,TypeScript å’Œ Java è¾“å‡ºå®Œå…¨ä¸€è‡´</p><h3 id="âœ…-annotations-å­—æ®µç»Ÿä¸€-2025-10-25" tabindex="-1">âœ… annotations å­—æ®µç»Ÿä¸€ (2025-10-25) <a class="header-anchor" href="#âœ…-annotations-å­—æ®µç»Ÿä¸€-2025-10-25" aria-label="Permalink to â€œâœ… annotations å­—æ®µç»Ÿä¸€ (2025-10-25)â€">â€‹</a></h3><p><strong>ä¿®æ”¹æ–‡ä»¶</strong>:</p><ul><li><code>src/types.ts</code> - TypeName æ¥å£æ·»åŠ  annotations å­—æ®µ</li><li><code>src/ast.ts</code> - TypeName æ„é€ å™¨æ·»åŠ ç©ºæ•°ç»„</li><li><code>test/integration/lsp/lsp-annotation-format.test.ts</code> - æµ‹è¯•è¾…åŠ©å‡½æ•°æ›´æ–°</li></ul><p><strong>é—®é¢˜</strong>: Java åŒ…å« <code>annotations: []</code> å­—æ®µ,TypeScript ä¸åŒ…å«</p><p><strong>ä¿®å¤å‰</strong>:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TypeScript TypeName æ¥å£ (src/types.ts:353-356)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TypeName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseTypeName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TypeScript TypeName æ„é€ å™¨ (src/ast.ts:144)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypeName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypeName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ kind: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TypeName&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, name, span: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createEmptySpan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }),</span></span></code></pre></div><p><strong>ä¿®å¤å</strong>:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TypeScript TypeName æ¥å£ (src/types.ts:353-356)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TypeName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseTypeName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> annotations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> readonly</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Annotation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TypeScript TypeName æ„é€ å™¨ (src/ast.ts:144)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypeName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypeName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ kind: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TypeName&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, name, annotations: [], span: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createEmptySpan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }),</span></span></code></pre></div><p><strong>æµ‹è¯•éªŒè¯</strong>:</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// MainIntegrationTest.java æ·»åŠ  annotations å­—æ®µéªŒè¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (tsJson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contains</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">retType</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  assertTrue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tsJson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contains</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">annotations</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;TypeScript åº”åŒ…å« annotations å­—æ®µ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (javaJson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contains</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">retType</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  assertTrue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(javaJson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contains</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">annotations</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Java åº”åŒ…å« annotations å­—æ®µ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>éªŒè¯ç»“æœ</strong>: æ‰€æœ‰è§£æå™¨ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡,TypeScript å’Œ Java éƒ½è¾“å‡º <code>annotations: []</code></p><h2 id="å»ºè®®ä¸åç»­æ­¥éª¤" tabindex="-1">å»ºè®®ä¸åç»­æ­¥éª¤ <a class="header-anchor" href="#å»ºè®®ä¸åç»­æ­¥éª¤" aria-label="Permalink to â€œå»ºè®®ä¸åç»­æ­¥éª¤â€">â€‹</a></h2><h3 id="å·²å®Œæˆ-âœ…" tabindex="-1">å·²å®Œæˆ âœ… <a class="header-anchor" href="#å·²å®Œæˆ-âœ…" aria-label="Permalink to â€œå·²å®Œæˆ âœ…â€">â€‹</a></h3><ol><li><strong>ä¿®å¤ TypeScript çš„ nameSpan Bug</strong> - å·²å®Œæˆ (2025-10-25)</li><li><strong>ç»Ÿä¸€ annotations å­—æ®µå¤„ç†</strong> - å·²å®Œæˆ (2025-10-25) <ul><li>é€‰æ‹©äº†é€‰é¡¹A: ä¸¤ä¸ªè§£æå™¨éƒ½åŒ…å«ç©ºçš„ annotations æ•°ç»„</li><li>æ›´æ˜ç¡®ä¸”ä¾¿äºå·¥å…·å¤„ç†</li></ul></li></ol><h3 id="ä¸­ä¼˜å…ˆçº§" tabindex="-1">ä¸­ä¼˜å…ˆçº§ <a class="header-anchor" href="#ä¸­ä¼˜å…ˆçº§" aria-label="Permalink to â€œä¸­ä¼˜å…ˆçº§â€">â€‹</a></h3><ol start="3"><li><strong>å»ºç«‹ span è®¡ç®—è§„èŒƒ</strong><ul><li>æ˜ç¡®å®šä¹‰ span.end åº”è¯¥æŒ‡å‘ä»€ä¹ˆä½ç½®</li><li>ç»Ÿä¸€ä¸¤ä¸ªè§£æå™¨çš„å®ç°</li></ul></li></ol><h3 id="ä½ä¼˜å…ˆçº§" tabindex="-1">ä½ä¼˜å…ˆçº§ <a class="header-anchor" href="#ä½ä¼˜å…ˆçº§" aria-label="Permalink to â€œä½ä¼˜å…ˆçº§â€">â€‹</a></h3><ol start="4"><li><strong>æ‰©å±•æµ‹è¯•è¦†ç›–</strong><ul><li>æ·»åŠ æ›´å¤šå¤æ‚åœºæ™¯çš„æµ‹è¯•(æ³›å‹ã€æ•ˆæœç³»ç»Ÿç­‰)</li><li>å»ºç«‹ Golden Test å¥—ä»¶</li></ul></li></ol><h2 id="ç›¸å…³æ–‡ä»¶" tabindex="-1">ç›¸å…³æ–‡ä»¶ <a class="header-anchor" href="#ç›¸å…³æ–‡ä»¶" aria-label="Permalink to â€œç›¸å…³æ–‡ä»¶â€">â€‹</a></h2><ul><li>æµ‹è¯•ä»£ç : <code>aster-lang-cli/src/test/java/aster/cli/MainIntegrationTest.java</code></li><li>æµ‹è¯•æ–‡ä»¶: <code>test/cnl/programs/parser-tests/simple_function.aster</code></li><li>TypeScript è§£æå™¨: <code>src/parser.ts</code></li><li>Java è§£æå™¨: <code>aster-core/src/main/java/aster/core/parser/</code></li></ul><h2 id="éªŒè¯å‘½ä»¤" tabindex="-1">éªŒè¯å‘½ä»¤ <a class="header-anchor" href="#éªŒè¯å‘½ä»¤" aria-label="Permalink to â€œéªŒè¯å‘½ä»¤â€">â€‹</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿è¡Œè§£æå™¨ä¸€è‡´æ€§æµ‹è¯•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-lang-cli:test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tests</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MainIntegrationTest.parserConsistencyBetweenTypeScriptAndJava</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‰‹åŠ¨æ¯”è¾ƒè¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ASTER_COMPILER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">typescript</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ./aster-lang-cli/build/install/aster-lang-cli/bin/aster-lang-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/cnl/programs/parser-tests/simple_function.aster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ASTER_COMPILER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ./aster-lang-cli/build/install/aster-lang-cli/bin/aster-lang-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/cnl/programs/parser-tests/simple_function.aster</span></span></code></pre></div><hr><p><strong>æŠ¥å‘Šæ—¥æœŸ</strong>: 2025-10-25 <strong>è°ƒæŸ¥è€…</strong>: Claude Code <strong>çŠ¶æ€</strong>: âœ… æµ‹è¯•å·²æ·»åŠ ,å·®å¼‚å·²è®°å½•</p>`,78)])])}const E=i(l,[["render",e]]);export{g as __pageData,E as default};
