import{_ as a,c as n,o as e,aj as i}from"./chunks/framework.Bz2R-749.js";const g=JSON.parse('{"title":"Aster 语言规范","description":"","frontmatter":{},"headers":[],"relativePath":"reference/language-specification.md","filePath":"reference/language-specification.md"}'),t={name:"reference/language-specification.md"};function l(p,s,r,o,c,d){return e(),n("div",null,[...s[0]||(s[0]=[i(`<h1 id="aster-语言规范" tabindex="-1">Aster 语言规范 <a class="header-anchor" href="#aster-语言规范" aria-label="Permalink to “Aster 语言规范”">​</a></h1><p><strong>版本</strong>: 0.2.0 <strong>状态</strong>: 草案 (Draft) | Last updated: 2025-10-07 12:06 NZST | Maintainer: Codex <strong>最后更新</strong>: 2025-10-06</p><hr><h2 id="_1-词法结构" tabindex="-1">1. 词法结构 <a class="header-anchor" href="#_1-词法结构" aria-label="Permalink to “1. 词法结构”">​</a></h2><h3 id="_1-1-字符集" tabindex="-1">1.1 字符集 <a class="header-anchor" href="#_1-1-字符集" aria-label="Permalink to “1.1 字符集”">​</a></h3><p>Aster 源代码使用 UTF-8 编码。词法分析器自动跳过 UTF-8 BOM（字节序标记 <code>0xFEFF</code>）如果存在。</p><h3 id="_1-2-空白与缩进" tabindex="-1">1.2 空白与缩进 <a class="header-anchor" href="#_1-2-空白与缩进" aria-label="Permalink to “1.2 空白与缩进”">​</a></h3><p><strong>空白字符</strong>：空格 (<code></code>) 和制表符 (<code>\\t</code>) 用于分隔 token，但在语法上不显著（除缩进外）。</p><p><strong>缩进规则</strong>：</p><ul><li>Aster 使用<strong>基于缩进的块结构</strong>（类似 Python）</li><li>每个缩进级别必须是<strong>2 个空格</strong>的倍数</li><li>缩进增加生成 <code>INDENT</code> token</li><li>缩进减少生成 <code>DEDENT</code> token</li><li>不一致的缩进导致编译错误</li></ul><p><strong>换行符</strong>：</p><ul><li>支持 <code>\\n</code> (LF)、<code>\\r</code> (CR)、<code>\\r\\n</code> (CRLF)</li><li>换行符生成 <code>NEWLINE</code> token</li></ul><h3 id="_1-3-注释" tabindex="-1">1.3 注释 <a class="header-anchor" href="#_1-3-注释" aria-label="Permalink to “1.3 注释”">​</a></h3><p><strong>单行注释</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span># 这是注释（井号风格）</span></span>
<span class="line"><span>// 这也是注释（双斜线风格）</span></span></code></pre></div><p>注释从 <code>#</code> 或 <code>//</code> 开始，延续到行尾。</p><h3 id="_1-4-标识符" tabindex="-1">1.4 标识符 <a class="header-anchor" href="#_1-4-标识符" aria-label="Permalink to “1.4 标识符”">​</a></h3><p><strong>标识符语法</strong>（EBNF）：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Identifier     ::= IdentStart IdentContinue*</span></span>
<span class="line"><span>IdentStart     ::= [A-Za-z]</span></span>
<span class="line"><span>IdentContinue  ::= [A-Za-z0-9]</span></span></code></pre></div><p><strong>类型标识符</strong>（首字母大写）：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>TypeIdentifier ::= [A-Z] IdentContinue*</span></span></code></pre></div><p><strong>点分标识符</strong>（用于模块名和完全限定名）：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>DottedIdent    ::= Identifier (&#39;.&#39; Identifier)*</span></span></code></pre></div><p><strong>示例</strong>：</p><ul><li>普通标识符：<code>user</code>, <code>fetchDashboard</code>, <code>id</code></li><li>类型标识符：<code>User</code>, <code>Result</code>, <code>AuthErr</code></li><li>点分标识符：<code>demo.policy_demo</code>, <code>Http.get</code></li></ul><h3 id="_1-5-关键字" tabindex="-1">1.5 关键字 <a class="header-anchor" href="#_1-5-关键字" aria-label="Permalink to “1.5 关键字”">​</a></h3><p>保留关键字（不能用作标识符）：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To          Define      This        Module      Is          Use</span></span>
<span class="line"><span>As          With        Of          And         Or          Produce</span></span>
<span class="line"><span>Return      If          Then        Else        Match       When</span></span>
<span class="line"><span>Within      Scope       Start       Async       Wait        For</span></span>
<span class="line"><span>One         Null        True        False       Ok          Err</span></span>
<span class="line"><span>Performs    Io          Cpu         It</span></span></code></pre></div><p><strong>多词关键字</strong>：</p><ul><li><code>This module is</code></li><li><code>It performs</code></li><li><code>One of</code></li><li><code>Wait for</code></li><li><code>Within a scope</code></li><li><code>Start as async</code></li></ul><h3 id="_1-6-字面量" tabindex="-1">1.6 字面量 <a class="header-anchor" href="#_1-6-字面量" aria-label="Permalink to “1.6 字面量”">​</a></h3><p><strong>整数字面量</strong>：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>IntLiteral ::= [0-9]+</span></span></code></pre></div><p>示例：<code>0</code>, <code>42</code>, <code>1000</code></p><p><strong>浮点字面量</strong>：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>DoubleLiteral ::= [0-9]+ &#39;.&#39; [0-9]+</span></span></code></pre></div><p>示例：<code>3.14</code>, <code>0.5</code>, <code>2.718</code></p><p><strong>布尔字面量</strong>：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>BoolLiteral ::= &#39;true&#39; | &#39;false&#39;</span></span></code></pre></div><p><strong>空字面量</strong>：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>NullLiteral ::= &#39;null&#39;</span></span></code></pre></div><p><strong>文本字面量（字符串）</strong>：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>TextLiteral ::= &#39;&quot;&#39; StringChar* &#39;&quot;&#39;</span></span>
<span class="line"><span>StringChar  ::= [^&quot;\\n] | &#39;\\&quot;&#39; | &#39;\\n&#39; | &#39;\\t&#39; | &#39;\\\\&#39;</span></span></code></pre></div><p><strong>字符串插值</strong>（在文本字面量中）：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>&quot;Welcome, {name}&quot;</span></span>
<span class="line"><span>&quot;User ID: {u.id}&quot;</span></span></code></pre></div><h3 id="_1-7-标点符号" tabindex="-1">1.7 标点符号 <a class="header-anchor" href="#_1-7-标点符号" aria-label="Permalink to “1.7 标点符号”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>.    点号（语句结束、成员访问）</span></span>
<span class="line"><span>:    冒号（类型注解、块开始）</span></span>
<span class="line"><span>,    逗号（参数分隔、列表元素分隔）</span></span>
<span class="line"><span>(    左圆括号</span></span>
<span class="line"><span>)    右圆括号</span></span>
<span class="line"><span>[    左方括号</span></span>
<span class="line"><span>]    右方括号</span></span></code></pre></div><hr><h2 id="_2-语法规则-ebnf" tabindex="-1">2. 语法规则（EBNF） <a class="header-anchor" href="#_2-语法规则-ebnf" aria-label="Permalink to “2. 语法规则（EBNF）”">​</a></h2><h3 id="_2-1-模块结构" tabindex="-1">2.1 模块结构 <a class="header-anchor" href="#_2-1-模块结构" aria-label="Permalink to “2.1 模块结构”">​</a></h3><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Module       ::= ModuleDecl? Declaration*</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ModuleDecl   ::= &#39;This module is&#39; DottedIdent &#39;.&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Declaration  ::= Import</span></span>
<span class="line"><span>               | DataDecl</span></span>
<span class="line"><span>               | EnumDecl</span></span>
<span class="line"><span>               | FuncDecl</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>This module is app.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Use demo.utils.</span></span>
<span class="line"><span>Define User with id: Text, name: Text.</span></span>
<span class="line"><span>To greet with user: User?, produce Text: ...</span></span></code></pre></div><h3 id="_2-2-导入声明" tabindex="-1">2.2 导入声明 <a class="header-anchor" href="#_2-2-导入声明" aria-label="Permalink to “2.2 导入声明”">​</a></h3><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Import       ::= &#39;Use&#39; DottedIdent (&#39;as&#39; Identifier)? &#39;.&#39;</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Use std.io.</span></span>
<span class="line"><span>Use demo.auth as Auth.</span></span></code></pre></div><h3 id="_2-3-数据类型声明" tabindex="-1">2.3 数据类型声明 <a class="header-anchor" href="#_2-3-数据类型声明" aria-label="Permalink to “2.3 数据类型声明”">​</a></h3><p><strong>记录类型</strong>（Product Type）：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>DataDecl     ::= &#39;Define&#39; TypeIdent &#39;with&#39; FieldList &#39;.&#39;</span></span>
<span class="line"><span>FieldList    ::= Field (&#39;,&#39; Field)*</span></span>
<span class="line"><span>Field        ::= Identifier &#39;:&#39; Type</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Define User with id: Text, name: Text.</span></span>
<span class="line"><span>Define Point with x: Int, y: Int.</span></span></code></pre></div><p><strong>枚举类型</strong>（Sum Type）：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>EnumDecl     ::= &#39;Define&#39; TypeIdent &#39;as one of&#39; VariantList &#39;.&#39;</span></span>
<span class="line"><span>VariantList  ::= TypeIdent (&#39;,&#39; TypeIdent)*</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Define AuthErr as one of InvalidCreds, Locked.</span></span>
<span class="line"><span>Define Color as one of Red, Green, Blue.</span></span></code></pre></div><h3 id="_2-4-函数声明" tabindex="-1">2.4 函数声明 <a class="header-anchor" href="#_2-4-函数声明" aria-label="Permalink to “2.4 函数声明”">​</a></h3><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>FuncDecl     ::= &#39;To&#39; Identifier TypeParams? ParamList? &#39;,&#39; &#39;produce&#39; Type Effect? Body</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TypeParams   ::= &#39;of&#39; TypeIdent (&#39;and&#39; TypeIdent)*</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ParamList    ::= &#39;with&#39; Parameter (&#39;,&#39; Parameter)*</span></span>
<span class="line"><span>Parameter    ::= Identifier &#39;:&#39; Type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Effect       ::= &#39;.&#39; &#39;It performs&#39; EffectList</span></span>
<span class="line"><span>               | &#39;It performs&#39; EffectList &#39;:&#39;</span></span>
<span class="line"><span>EffectList   ::= EffectKind (&#39;with&#39; CapabilityList)?</span></span>
<span class="line"><span>EffectKind   ::= &#39;io&#39; | &#39;cpu&#39; | (&#39;io&#39; &#39;with&#39; CapabilityList)</span></span>
<span class="line"><span>CapabilityList ::= Capability (&#39;and&#39; Capability)*</span></span>
<span class="line"><span>Capability   ::= &#39;Http&#39; | &#39;Sql&#39; | &#39;Time&#39; | &#39;Files&#39; | &#39;Secrets&#39; | &#39;AiModel&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Body         ::= &#39;:&#39; NEWLINE INDENT Statement+ DEDENT</span></span>
<span class="line"><span>               | &#39;.&#39;</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To greet with user: User?, produce Text:</span></span>
<span class="line"><span>  Match user:</span></span>
<span class="line"><span>    When null, Return &quot;Hi, guest&quot;.</span></span>
<span class="line"><span>    When User(id, name), Return &quot;Welcome, {name}&quot;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To fetchDashboard with u: User, produce Result of Dash and AuthErr. It performs io:</span></span>
<span class="line"><span>  Start profile as async ProfileSvc.load(u.id).</span></span>
<span class="line"><span>  Wait for profile.</span></span>
<span class="line"><span>  Return ok of Dash(profile, timeline).</span></span></code></pre></div><h3 id="_2-5-类型表达式" tabindex="-1">2.5 类型表达式 <a class="header-anchor" href="#_2-5-类型表达式" aria-label="Permalink to “2.5 类型表达式”">​</a></h3><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Type         ::= TypeName</span></span>
<span class="line"><span>               | TypeVar</span></span>
<span class="line"><span>               | TypeApp</span></span>
<span class="line"><span>               | NullableType</span></span>
<span class="line"><span>               | OptionType</span></span>
<span class="line"><span>               | ResultType</span></span>
<span class="line"><span>               | ListType</span></span>
<span class="line"><span>               | MapType</span></span>
<span class="line"><span>               | FuncType</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TypeName     ::= TypeIdent</span></span>
<span class="line"><span>TypeVar      ::= TypeIdent</span></span>
<span class="line"><span>TypeApp      ::= TypeIdent &#39;&lt;&#39; Type (&#39;,&#39; Type)* &#39;&gt;&#39;</span></span>
<span class="line"><span>NullableType ::= Type &#39;?&#39;</span></span>
<span class="line"><span>OptionType   ::= &#39;Option&#39; &#39;of&#39; Type</span></span>
<span class="line"><span>ResultType   ::= &#39;Result&#39; &#39;of&#39; Type &#39;and&#39; Type</span></span>
<span class="line"><span>ListType     ::= &#39;List&#39; &#39;of&#39; Type</span></span>
<span class="line"><span>MapType      ::= &#39;Map&#39; &#39;of&#39; Type &#39;and&#39; Type</span></span>
<span class="line"><span>FuncType     ::= &#39;(&#39; Type (&#39;,&#39; Type)* &#39;)&#39; &#39;-&gt;&#39; Type</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Text                          # 基础类型</span></span>
<span class="line"><span>User                          # 用户定义类型</span></span>
<span class="line"><span>T                             # 类型变量</span></span>
<span class="line"><span>List&lt;Int&gt;                     # 泛型类型应用</span></span>
<span class="line"><span>User?                         # 可空类型</span></span>
<span class="line"><span>Option of Text                # Option 类型</span></span>
<span class="line"><span>Result of User and AuthErr    # Result 类型</span></span>
<span class="line"><span>Map of Text and Int           # Map 类型</span></span></code></pre></div><h3 id="_2-6-语句" tabindex="-1">2.6 语句 <a class="header-anchor" href="#_2-6-语句" aria-label="Permalink to “2.6 语句”">​</a></h3><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Statement    ::= LetStmt</span></span>
<span class="line"><span>               | ReturnStmt</span></span>
<span class="line"><span>               | IfStmt</span></span>
<span class="line"><span>               | MatchStmt</span></span>
<span class="line"><span>               | StartStmt</span></span>
<span class="line"><span>               | WaitStmt</span></span>
<span class="line"><span>               | WithinStmt</span></span>
<span class="line"><span>               | ExprStmt</span></span>
<span class="line"><span></span></span>
<span class="line"><span>LetStmt      ::= &#39;Let&#39; Pattern &#39;=&#39; Expression &#39;.&#39;</span></span>
<span class="line"><span>ReturnStmt   ::= &#39;Return&#39; Expression &#39;.&#39;</span></span>
<span class="line"><span>IfStmt       ::= &#39;If&#39; Expression &#39;,&#39; &#39;then&#39; Block (&#39;else&#39; Block)?</span></span>
<span class="line"><span>MatchStmt    ::= &#39;Match&#39; Expression &#39;:&#39; NEWLINE INDENT Case+ DEDENT</span></span>
<span class="line"><span>Case         ::= &#39;When&#39; Pattern &#39;,&#39; Statement</span></span>
<span class="line"><span>StartStmt    ::= &#39;Start&#39; Identifier &#39;as async&#39; Expression &#39;.&#39;</span></span>
<span class="line"><span>WaitStmt     ::= &#39;Wait for&#39; Identifier (&#39;and&#39; Identifier)* &#39;.&#39;</span></span>
<span class="line"><span>WithinStmt   ::= &#39;Within a scope:&#39; NEWLINE INDENT Statement+ DEDENT</span></span>
<span class="line"><span>ExprStmt     ::= Expression &#39;.&#39;</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Let x = 42.</span></span>
<span class="line"><span>Return &quot;Hello&quot;.</span></span>
<span class="line"><span>If x &gt; 0, then Return &quot;positive&quot;.</span></span>
<span class="line"><span>Match user:</span></span>
<span class="line"><span>  When null, Return &quot;guest&quot;.</span></span>
<span class="line"><span>  When User(id, name), Return name.</span></span>
<span class="line"><span>Start profile as async ProfileSvc.load(id).</span></span>
<span class="line"><span>Wait for profile and timeline.</span></span></code></pre></div><h3 id="_2-7-表达式" tabindex="-1">2.7 表达式 <a class="header-anchor" href="#_2-7-表达式" aria-label="Permalink to “2.7 表达式”">​</a></h3><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Expression   ::= PrimaryExpr</span></span>
<span class="line"><span>               | CallExpr</span></span>
<span class="line"><span>               | FieldAccessExpr</span></span>
<span class="line"><span>               | ConstructExpr</span></span>
<span class="line"><span>               | LambdaExpr</span></span>
<span class="line"><span>               | BinaryExpr</span></span>
<span class="line"><span>               | AwaitExpr</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PrimaryExpr  ::= Identifier</span></span>
<span class="line"><span>               | IntLiteral</span></span>
<span class="line"><span>               | DoubleLiteral</span></span>
<span class="line"><span>               | BoolLiteral</span></span>
<span class="line"><span>               | NullLiteral</span></span>
<span class="line"><span>               | TextLiteral</span></span>
<span class="line"><span>               | ListLiteral</span></span>
<span class="line"><span>               | MapLiteral</span></span>
<span class="line"><span>               | &#39;(&#39; Expression &#39;)&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CallExpr     ::= Expression &#39;(&#39; ArgList? &#39;)&#39;</span></span>
<span class="line"><span>ArgList      ::= Expression (&#39;,&#39; Expression)*</span></span>
<span class="line"><span></span></span>
<span class="line"><span>FieldAccessExpr ::= Expression &#39;.&#39; Identifier</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ConstructExpr ::= &#39;ok&#39; &#39;of&#39; Expression</span></span>
<span class="line"><span>                | &#39;err&#39; &#39;of&#39; Expression</span></span>
<span class="line"><span>                | TypeIdent &#39;(&#39; ArgList? &#39;)&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>LambdaExpr   ::= &#39;{&#39; ParamList? &#39;,&#39; Expression &#39;}&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>BinaryExpr   ::= Expression BinOp Expression</span></span>
<span class="line"><span>BinOp        ::= &#39;+&#39; | &#39;-&#39; | &#39;*&#39; | &#39;/&#39; | &#39;==&#39; | &#39;!=&#39; | &#39;&lt;&#39; | &#39;&gt;&#39; | &#39;&lt;=&#39; | &#39;&gt;=&#39;</span></span>
<span class="line"><span>               | &#39;and&#39; | &#39;or&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>AwaitExpr    ::= &#39;await&#39; &#39;(&#39; Expression &#39;)&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ListLiteral  ::= &#39;[&#39; (Expression (&#39;,&#39; Expression)*)? &#39;]&#39;</span></span>
<span class="line"><span>MapLiteral   ::= &#39;Map&#39; &#39;(&#39; (MapEntry (&#39;,&#39; MapEntry)*)? &#39;)&#39;</span></span>
<span class="line"><span>MapEntry     ::= Expression &#39;:&#39; Expression</span></span></code></pre></div><h3 id="_2-8-模式匹配" tabindex="-1">2.8 模式匹配 <a class="header-anchor" href="#_2-8-模式匹配" aria-label="Permalink to “2.8 模式匹配”">​</a></h3><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Pattern      ::= NullPattern</span></span>
<span class="line"><span>               | IntPattern</span></span>
<span class="line"><span>               | NamePattern</span></span>
<span class="line"><span>               | CtorPattern</span></span>
<span class="line"><span></span></span>
<span class="line"><span>NullPattern  ::= &#39;null&#39;</span></span>
<span class="line"><span>IntPattern   ::= IntLiteral</span></span>
<span class="line"><span>NamePattern  ::= Identifier</span></span>
<span class="line"><span>CtorPattern  ::= TypeIdent &#39;(&#39; PatternList? &#39;)&#39;</span></span>
<span class="line"><span>PatternList  ::= Pattern (&#39;,&#39; Pattern)*</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>When null, ...               # 空模式</span></span>
<span class="line"><span>When 0, ...                  # 整数模式</span></span>
<span class="line"><span>When x, ...                  # 名称模式（绑定变量）</span></span>
<span class="line"><span>When User(id, name), ...     # 构造器模式</span></span></code></pre></div><hr><h2 id="_3-类型系统" tabindex="-1">3. 类型系统 <a class="header-anchor" href="#_3-类型系统" aria-label="Permalink to “3. 类型系统”">​</a></h2><h3 id="_3-1-基础类型" tabindex="-1">3.1 基础类型 <a class="header-anchor" href="#_3-1-基础类型" aria-label="Permalink to “3.1 基础类型”">​</a></h3><table tabindex="0"><thead><tr><th>类型</th><th>描述</th><th>示例值</th></tr></thead><tbody><tr><td><code>Int</code></td><td>32位整数</td><td><code>0</code>, <code>42</code>, <code>-10</code></td></tr><tr><td><code>Long</code></td><td>64位整数</td><td><code>1000000L</code></td></tr><tr><td><code>Double</code></td><td>64位浮点数</td><td><code>3.14</code>, <code>0.5</code></td></tr><tr><td><code>Float</code></td><td>32位浮点数</td><td><code>2.718f</code></td></tr><tr><td><code>Bool</code></td><td>布尔值</td><td><code>true</code>, <code>false</code></td></tr><tr><td><code>Text</code></td><td>UTF-8 文本</td><td><code>&quot;Hello&quot;</code></td></tr></tbody></table><h3 id="_3-2-复合类型" tabindex="-1">3.2 复合类型 <a class="header-anchor" href="#_3-2-复合类型" aria-label="Permalink to “3.2 复合类型”">​</a></h3><p><strong>可空类型</strong>（Nullable Types）：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>T?   ≡   T | null</span></span></code></pre></div><p>示例：<code>User?</code>, <code>Text?</code></p><p><strong>Option 类型</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Option&lt;T&gt; = Some(T) | None</span></span></code></pre></div><p>示例：<code>Option of Text</code></p><p><strong>Result 类型</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Result&lt;T, E&gt; = Ok(T) | Err(E)</span></span></code></pre></div><p>示例：<code>Result of User and AuthErr</code></p><p><strong>列表类型</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>List&lt;T&gt;</span></span></code></pre></div><p>示例：<code>List of Int</code>, <code>List of Text</code></p><p><strong>映射类型</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Map&lt;K, V&gt;</span></span></code></pre></div><p>示例：<code>Map of Text and Int</code></p><h3 id="_3-3-泛型-类型参数化" tabindex="-1">3.3 泛型（类型参数化） <a class="header-anchor" href="#_3-3-泛型-类型参数化" aria-label="Permalink to “3.3 泛型（类型参数化）”">​</a></h3><p><strong>函数泛型</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To identity of T with value: T, produce T:</span></span>
<span class="line"><span>  Return value.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To map of T and U with f: {T, U}, list: List of T, produce List of U:</span></span>
<span class="line"><span>  ...</span></span></code></pre></div><p><strong>约束</strong>：类型变量在函数签名中首次出现时自动推断。</p><h3 id="_3-4-类型推导规则" tabindex="-1">3.4 类型推导规则 <a class="header-anchor" href="#_3-4-类型推导规则" aria-label="Permalink to “3.4 类型推导规则”">​</a></h3><p>Aster 使用<strong>局部类型推断</strong>：</p><ul><li>函数签名必须显式标注类型</li><li>局部变量类型可推导（从初始化表达式）</li><li>函数调用的类型参数可推导</li></ul><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span># 显式类型</span></span>
<span class="line"><span>To greet with user: User, produce Text: ...</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 推导局部变量类型</span></span>
<span class="line"><span>Let name = user.name.  # name: Text（从 User.name 推导）</span></span></code></pre></div><h3 id="_3-5-子类型关系" tabindex="-1">3.5 子类型关系 <a class="header-anchor" href="#_3-5-子类型关系" aria-label="Permalink to “3.5 子类型关系”">​</a></h3><p><strong>可空类型子类型</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>T  &lt;:  T?</span></span></code></pre></div><p><strong>Option 类型无隐式转换</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>T  ≮:  Option&lt;T&gt;  （必须显式构造 Some(x)）</span></span></code></pre></div><p><strong>Result 类型无隐式转换</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>T  ≮:  Result&lt;T, E&gt;  （必须显式构造 Ok(x)）</span></span></code></pre></div><hr><h2 id="_4-效果系统" tabindex="-1">4. 效果系统 <a class="header-anchor" href="#_4-效果系统" aria-label="Permalink to “4. 效果系统”">​</a></h2><h3 id="_4-1-效果种类" tabindex="-1">4.1 效果种类 <a class="header-anchor" href="#_4-1-效果种类" aria-label="Permalink to “4.1 效果种类”">​</a></h3><p>Aster 区分两种基本效果：</p><ul><li><strong><code>cpu</code></strong>：纯计算（可能消耗 CPU 但无 I/O）</li><li><strong><code>io</code></strong>：I/O 操作（网络、文件、数据库等）</li></ul><p><strong>效果格</strong>（Effect Lattice）：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>∅  ⊑  cpu  ⊑  io[*]</span></span></code></pre></div><ul><li>无效果函数 (<code>∅</code>) 可被 <code>cpu</code> 函数调用</li><li><code>cpu</code> 函数可被 <code>io</code> 函数调用</li><li><code>io</code> 函数<strong>不能</strong>被 <code>cpu</code> 函数调用（编译错误）</li></ul><h3 id="_4-2-效果标注语法" tabindex="-1">4.2 效果标注语法 <a class="header-anchor" href="#_4-2-效果标注语法" aria-label="Permalink to “4.2 效果标注语法”">​</a></h3><p><strong>基本效果</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To compute, produce Int. It performs cpu:</span></span>
<span class="line"><span>  Return 42.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To fetch, produce Text. It performs io:</span></span>
<span class="line"><span>  Return Http.get(&quot;https://example.com&quot;).</span></span></code></pre></div><p><strong>能力细化</strong>（Capability-based I/O）：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To fetchUser, produce User. It performs io with Http and Sql:</span></span>
<span class="line"><span>  Let data = Http.get(&quot;/user&quot;).</span></span>
<span class="line"><span>  Let user = Db.save(data).</span></span>
<span class="line"><span>  Return user.</span></span></code></pre></div><p><strong>支持的能力</strong>：</p><ul><li><code>Http</code>：HTTP 网络请求</li><li><code>Sql</code>：SQL 数据库操作</li><li><code>Time</code>：时间/时钟访问</li><li><code>Files</code>：文件系统访问</li><li><code>Secrets</code>：密钥/凭证访问</li><li><code>AiModel</code>：AI 模型调用</li></ul><h3 id="_4-3-效果检查规则" tabindex="-1">4.3 效果检查规则 <a class="header-anchor" href="#_4-3-效果检查规则" aria-label="Permalink to “4.3 效果检查规则”">​</a></h3><ol><li><p><strong>调用约束</strong>：</p><ul><li><code>cpu</code> 函数只能调用 <code>cpu</code> 或无效果函数</li><li><code>io</code> 函数可调用任何函数</li><li><code>io[C]</code> 函数只能调用 <code>io[C&#39;]</code> 函数，其中 <code>C&#39; ⊆ C</code></li></ul></li><li><p><strong>能力子集检查</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>io[Http]        ⊑  io[Http, Sql]</span></span>
<span class="line"><span>io[Http, Sql]   ⊑  io[*]</span></span></code></pre></div></li><li><p><strong>编译时强制</strong>： 效果违规导致<strong>编译错误</strong>（非警告）。</p></li></ol><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span># ❌ 错误：cpu 函数调用 io 函数</span></span>
<span class="line"><span>To badCompute, produce Int. It performs cpu:</span></span>
<span class="line"><span>  Return Http.get(&quot;/data&quot;).  # ERROR: Effect violation</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ✅ 正确：io 函数调用 cpu 函数</span></span>
<span class="line"><span>To goodFetch, produce Int. It performs io:</span></span>
<span class="line"><span>  Let x = compute().  # OK（假设 compute 是 cpu）</span></span>
<span class="line"><span>  Return x.</span></span></code></pre></div><h3 id="_4-4-异步与并发" tabindex="-1">4.4 异步与并发 <a class="header-anchor" href="#_4-4-异步与并发" aria-label="Permalink to “4.4 异步与并发”">​</a></h3><p><strong>结构化并发</strong>（Structured Concurrency）：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Within a scope:</span></span>
<span class="line"><span>  Start profile as async ProfileSvc.load(u.id).</span></span>
<span class="line"><span>  Start timeline as async FeedSvc.timeline(u.id).</span></span>
<span class="line"><span>  Wait for profile and timeline.</span></span>
<span class="line"><span>  Return Dash(profile, timeline).</span></span></code></pre></div><p><strong>规则</strong>：</p><ul><li><code>Start</code> 创建异步任务，返回句柄</li><li><code>Wait</code> 等待所有指定任务完成</li><li>所有 <code>Start</code> 的任务必须在作用域结束前 <code>Wait</code>（编译器警告）</li></ul><hr><h2 id="_5-语义规则" tabindex="-1">5. 语义规则 <a class="header-anchor" href="#_5-语义规则" aria-label="Permalink to “5. 语义规则”">​</a></h2><h3 id="_5-1-求值顺序" tabindex="-1">5.1 求值顺序 <a class="header-anchor" href="#_5-1-求值顺序" aria-label="Permalink to “5.1 求值顺序”">​</a></h3><p><strong>语句求值</strong>：</p><ul><li>按顺序（从上到下）求值</li><li>每个语句执行后可能改变作用域状态</li></ul><p><strong>表达式求值</strong>：</p><ul><li><strong>严格求值</strong>（Strict Evaluation）：参数在函数调用前求值</li><li><strong>从左到右</strong>：多个参数按声明顺序求值</li></ul><p><strong>短路求值</strong>：</p><ul><li>逻辑运算符 <code>and</code>、<code>or</code> 短路求值<div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>If (x != null) and (x.name == &quot;admin&quot;), ...</span></span></code></pre></div></li></ul><h3 id="_5-2-作用域规则" tabindex="-1">5.2 作用域规则 <a class="header-anchor" href="#_5-2-作用域规则" aria-label="Permalink to “5.2 作用域规则”">​</a></h3><p><strong>词法作用域</strong>（Lexical Scoping）：</p><ul><li>变量绑定在声明处引入</li><li>内层作用域可访问外层变量</li><li>同名变量遮蔽（Shadowing）</li></ul><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Let x = 10.</span></span>
<span class="line"><span>Within a scope:</span></span>
<span class="line"><span>  Let x = 20.  # 遮蔽外层 x</span></span>
<span class="line"><span>  Return x.    # 返回 20</span></span></code></pre></div><h3 id="_5-3-模式匹配语义" tabindex="-1">5.3 模式匹配语义 <a class="header-anchor" href="#_5-3-模式匹配语义" aria-label="Permalink to “5.3 模式匹配语义”">​</a></h3><p><strong>穷尽性检查</strong>（Exhaustiveness Checking）：</p><ul><li><code>Match</code> 表达式必须覆盖所有可能的模式</li><li>枚举类型未覆盖所有变体 → 编译警告</li></ul><p><strong>绑定语义</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Match user:</span></span>
<span class="line"><span>  When User(id, name), Return name.  # id, name 绑定到字段值</span></span></code></pre></div><p><strong>匹配顺序</strong>：</p><ul><li>按 <code>When</code> 子句顺序匹配</li><li>第一个匹配成功的分支执行</li></ul><h3 id="_5-4-空值处理" tabindex="-1">5.4 空值处理 <a class="header-anchor" href="#_5-4-空值处理" aria-label="Permalink to “5.4 空值处理”">​</a></h3><p><strong>显式空检查</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Match user:</span></span>
<span class="line"><span>  When null, Return &quot;guest&quot;.</span></span>
<span class="line"><span>  When User(id, name), Return name.</span></span></code></pre></div><p><strong><code>?</code> 操作符</strong>（计划中）：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>user?.name  # 如果 user 为 null，返回 null；否则返回 user.name</span></span></code></pre></div><h3 id="_5-5-错误处理" tabindex="-1">5.5 错误处理 <a class="header-anchor" href="#_5-5-错误处理" aria-label="Permalink to “5.5 错误处理”">​</a></h3><p><strong>Result 类型强制检查</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Let result = fetchUser(id).</span></span>
<span class="line"><span>Match result:</span></span>
<span class="line"><span>  When Ok(user), Return user.</span></span>
<span class="line"><span>  When Err(e), Return handleError(e).</span></span></code></pre></div><p><strong><code>await</code> 表达式</strong>（自动解包）：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Let user = await(fetchUser(id)).  # 如果 Err，抛出异常</span></span></code></pre></div><hr><h2 id="_6-代码示例" tabindex="-1">6. 代码示例 <a class="header-anchor" href="#_6-代码示例" aria-label="Permalink to “6. 代码示例”">​</a></h2><h3 id="示例-1-基础问候函数" tabindex="-1">示例 1：基础问候函数 <a class="header-anchor" href="#示例-1-基础问候函数" aria-label="Permalink to “示例 1：基础问候函数”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>This module is app.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Define User with id: Text, name: Text.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To greet with user: User?, produce Text:</span></span>
<span class="line"><span>  Match user:</span></span>
<span class="line"><span>    When null, Return &quot;Hi, guest&quot;.</span></span>
<span class="line"><span>    When User(id, name), Return &quot;Welcome, {name}&quot;.</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/greet.aster</code></p><h3 id="示例-2-异步仪表板获取" tabindex="-1">示例 2：异步仪表板获取 <a class="header-anchor" href="#示例-2-异步仪表板获取" aria-label="Permalink to “示例 2：异步仪表板获取”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Define User with id: Text, name: Text.</span></span>
<span class="line"><span>Define Dash with profile: Text, timeline: Text.</span></span>
<span class="line"><span>Define AuthErr as one of InvalidCreds, Locked.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To fetchDashboard with u: User, produce Result of Dash and AuthErr. It performs io:</span></span>
<span class="line"><span>  Start profile as async ProfileSvc.load(u.id).</span></span>
<span class="line"><span>  Start timeline as async FeedSvc.timeline(u.id).</span></span>
<span class="line"><span>  Wait for profile and timeline.</span></span>
<span class="line"><span>  Return ok of Dash(profile, timeline).</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/fetch_dashboard.aster</code></p><h3 id="示例-3-策略引擎示例" tabindex="-1">示例 3：策略引擎示例 <a class="header-anchor" href="#示例-3-策略引擎示例" aria-label="Permalink to “示例 3：策略引擎示例”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>This module is demo.policy_demo.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To demonstratePolicyEngine, produce Text:</span></span>
<span class="line"><span>  Return &quot;Policy engine demonstration: Access granted&quot;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To runPolicyTest1, produce Text:</span></span>
<span class="line"><span>  Return &quot;Test 1: Admin access granted&quot;.</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/policy_demo.aster</code></p><h3 id="示例-4-列表操作" tabindex="-1">示例 4：列表操作 <a class="header-anchor" href="#示例-4-列表操作" aria-label="Permalink to “示例 4：列表操作”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>This module is demo.lists.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To sum with numbers: List of Int, produce Int:</span></span>
<span class="line"><span>  Let total = 0.</span></span>
<span class="line"><span>  # 迭代列表（语法糖计划中）</span></span>
<span class="line"><span>  Return total.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To map of T and U with f: {T, U}, list: List of T, produce List of U:</span></span>
<span class="line"><span>  # 映射列表元素</span></span>
<span class="line"><span>  Return [].</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/list_ops.aster</code></p><h3 id="示例-5-枚举穷尽性检查" tabindex="-1">示例 5：枚举穷尽性检查 <a class="header-anchor" href="#示例-5-枚举穷尽性检查" aria-label="Permalink to “示例 5：枚举穷尽性检查”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Define Color as one of Red, Green, Blue.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To colorName with c: Color, produce Text:</span></span>
<span class="line"><span>  Match c:</span></span>
<span class="line"><span>    When Red, Return &quot;红色&quot;.</span></span>
<span class="line"><span>    When Green, Return &quot;绿色&quot;.</span></span>
<span class="line"><span>    When Blue, Return &quot;蓝色&quot;.</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/enum_exhaustiveness.aster</code></p><h3 id="示例-6-效果能力细化" tabindex="-1">示例 6：效果能力细化 <a class="header-anchor" href="#示例-6-效果能力细化" aria-label="Permalink to “示例 6：效果能力细化”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To fetchAndSave, produce User. It performs io with Http and Sql:</span></span>
<span class="line"><span>  Let data = Http.get(&quot;/user&quot;).</span></span>
<span class="line"><span>  Let user = Db.save(data).</span></span>
<span class="line"><span>  Return user.</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/eff_caps_enforce.aster</code></p><h3 id="示例-7-maybe-和-result-类型" tabindex="-1">示例 7：Maybe 和 Result 类型 <a class="header-anchor" href="#示例-7-maybe-和-result-类型" aria-label="Permalink to “示例 7：Maybe 和 Result 类型”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To safeDivide with a: Int, b: Int, produce Option of Int:</span></span>
<span class="line"><span>  If b == 0, then Return None.</span></span>
<span class="line"><span>  Return Some(a / b).</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To divide with a: Int, b: Int, produce Result of Int and Text:</span></span>
<span class="line"><span>  If b == 0, then Return err of &quot;Division by zero&quot;.</span></span>
<span class="line"><span>  Return ok of (a / b).</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/stdlib_maybe_result.aster</code></p><h3 id="示例-8-文本操作" tabindex="-1">示例 8：文本操作 <a class="header-anchor" href="#示例-8-文本操作" aria-label="Permalink to “示例 8：文本操作”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To concat with a: Text, b: Text, produce Text:</span></span>
<span class="line"><span>  Return &quot;{a}{b}&quot;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To length with s: Text, produce Int:</span></span>
<span class="line"><span>  Return Text.length(s).</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/text_ops.aster</code></p><h3 id="示例-9-映射操作" tabindex="-1">示例 9：映射操作 <a class="header-anchor" href="#示例-9-映射操作" aria-label="Permalink to “示例 9：映射操作”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To createUser with id: Text, name: Text, produce Map of Text and Text:</span></span>
<span class="line"><span>  Return Map(</span></span>
<span class="line"><span>    &quot;id&quot;: id,</span></span>
<span class="line"><span>    &quot;name&quot;: name</span></span>
<span class="line"><span>  ).</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/map_ops.aster</code></p><h3 id="示例-10-lambda-表达式" tabindex="-1">示例 10：Lambda 表达式 <a class="header-anchor" href="#示例-10-lambda-表达式" aria-label="Permalink to “示例 10：Lambda 表达式”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To filterPositive with numbers: List of Int, produce List of Int:</span></span>
<span class="line"><span>  Return List.filter(numbers, {x, x &gt; 0}).</span></span></code></pre></div><p><strong>文件</strong>: <code>test/cnl/examples/lambda_cnl.aster</code></p><hr><h2 id="_7-扩展特性-计划中" tabindex="-1">7. 扩展特性（计划中） <a class="header-anchor" href="#_7-扩展特性-计划中" aria-label="Permalink to “7. 扩展特性（计划中）”">​</a></h2><h3 id="_7-1-效果推断" tabindex="-1">7.1 效果推断 <a class="header-anchor" href="#_7-1-效果推断" aria-label="Permalink to “7.1 效果推断”">​</a></h3><p>自动推断函数效果而无需显式标注：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To compute:  # 自动推断为 cpu</span></span>
<span class="line"><span>  Return 42.</span></span></code></pre></div><h3 id="_7-2-效果多态" tabindex="-1">7.2 效果多态 <a class="header-anchor" href="#_7-2-效果多态" aria-label="Permalink to “7.2 效果多态”">​</a></h3><p>泛型函数继承效果参数：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>To map of E and T and U with f: {T, U with E}, list: List of T, produce List of U with E:</span></span>
<span class="line"><span>  ...</span></span></code></pre></div><h3 id="_7-3-pii-类型标注" tabindex="-1">7.3 PII 类型标注 <a class="header-anchor" href="#_7-3-pii-类型标注" aria-label="Permalink to “7.3 PII 类型标注”">​</a></h3><p>敏感数据类型标注：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Define User with id: @pii(L2, email) Text, name: Text.</span></span></code></pre></div><h3 id="_7-4-高级模式匹配" tabindex="-1">7.4 高级模式匹配 <a class="header-anchor" href="#_7-4-高级模式匹配" aria-label="Permalink to “7.4 高级模式匹配”">​</a></h3><ul><li>OR 模式：<code>When Red or Green, ...</code></li><li>AS 模式：<code>When User(id, name) as u, ...</code></li><li>守卫：<code>When x if x &gt; 0, ...</code></li></ul><hr><h2 id="_8-语言工具链" tabindex="-1">8. 语言工具链 <a class="header-anchor" href="#_8-语言工具链" aria-label="Permalink to “8. 语言工具链”">​</a></h2><h3 id="_8-1-编译器管道" tabindex="-1">8.1 编译器管道 <a class="header-anchor" href="#_8-1-编译器管道" aria-label="Permalink to “8.1 编译器管道”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>CNL 源码</span></span>
<span class="line"><span>  ↓ canonicalize（规范化）</span></span>
<span class="line"><span>Canonical CNL</span></span>
<span class="line"><span>  ↓ lex（词法分析）</span></span>
<span class="line"><span>Tokens</span></span>
<span class="line"><span>  ↓ parse（语法分析）</span></span>
<span class="line"><span>AST（抽象语法树）</span></span>
<span class="line"><span>  ↓ lowerModule（降级）</span></span>
<span class="line"><span>Core IR（核心中间表示）</span></span>
<span class="line"><span>  ↓ typecheckModule（类型检查）</span></span>
<span class="line"><span>类型诊断</span></span>
<span class="line"><span>  ↓ emitJVM（代码生成）</span></span>
<span class="line"><span>JVM 字节码</span></span></code></pre></div><h3 id="_8-2-命令行工具" tabindex="-1">8.2 命令行工具 <a class="header-anchor" href="#_8-2-命令行工具" aria-label="Permalink to “8.2 命令行工具”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编译 CNL 文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 类型检查</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> typecheck</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行 REPL</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成 Core IR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> emit-core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成 JVM 字节码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> emit-jvm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.aster</span></span></code></pre></div><h3 id="_8-3-lsp-支持" tabindex="-1">8.3 LSP 支持 <a class="header-anchor" href="#_8-3-lsp-支持" aria-label="Permalink to “8.3 LSP 支持”">​</a></h3><p>Aster 提供 Language Server Protocol 支持：</p><ul><li>语法高亮</li><li>代码补全</li><li>类型提示</li><li>效果违规诊断</li><li>PII 数据流警告（计划中）</li></ul><hr><h2 id="_9-参考文献" tabindex="-1">9. 参考文献 <a class="header-anchor" href="#_9-参考文献" aria-label="Permalink to “9. 参考文献”">​</a></h2><ul><li><strong>效果系统</strong>: <code>docs/reference/effects.md</code></li><li><strong>能力配置</strong>: <code>src/config/effects.ts</code></li><li><strong>词法分析器</strong>: <code>src/lexer.ts</code></li><li><strong>语法分析器</strong>: <code>src/parser.ts</code></li><li><strong>类型检查器</strong>: <code>src/typecheck.ts</code></li><li><strong>示例代码</strong>: <code>test/cnl/examples/</code></li></ul><hr><h2 id="_10-变更日志" tabindex="-1">10. 变更日志 <a class="header-anchor" href="#_10-变更日志" aria-label="Permalink to “10. 变更日志”">​</a></h2><h3 id="v0-2-0-2025-10-06" tabindex="-1">v0.2.0 (2025-10-06) <a class="header-anchor" href="#v0-2-0-2025-10-06" aria-label="Permalink to “v0.2.0 (2025-10-06)”">​</a></h3><ul><li>添加完整的 EBNF 语法定义</li><li>扩展效果系统文档</li><li>添加 10+ 代码示例</li><li>规范化类型系统描述</li></ul><h3 id="v0-1-0-2024-01-15" tabindex="-1">v0.1.0 (2024-01-15) <a class="header-anchor" href="#v0-1-0-2024-01-15" aria-label="Permalink to “v0.1.0 (2024-01-15)”">​</a></h3><ul><li>初始草案</li></ul><hr><p><strong>许可证</strong>: MIT <strong>维护者</strong>: Aster Language Team <strong>贡献指南</strong>: 参见 <code>CLAUDE.md</code></p>`,240)])])}const k=a(t,[["render",l]]);export{g as __pageData,k as default};
