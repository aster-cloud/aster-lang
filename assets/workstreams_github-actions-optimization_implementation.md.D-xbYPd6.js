import{_ as o,c as t,o as i,aj as a}from"./chunks/framework.Bz2R-749.js";const p=JSON.parse('{"title":"GitHub Actions 工作流优化实施","description":"","frontmatter":{},"headers":[],"relativePath":"workstreams/github-actions-optimization/implementation.md","filePath":"workstreams/github-actions-optimization/implementation.md"}'),c={name:"workstreams/github-actions-optimization/implementation.md"};function l(d,e,r,n,s,u){return i(),t("div",null,[...e[0]||(e[0]=[a('<h1 id="github-actions-工作流优化实施" tabindex="-1">GitHub Actions 工作流优化实施 <a class="header-anchor" href="#github-actions-工作流优化实施" aria-label="Permalink to “GitHub Actions 工作流优化实施”">​</a></h1><ul><li>日期：2025-11-15 21:56 NZDT</li><li>执行：Codex</li></ul><h2 id="主要变更" tabindex="-1">主要变更 <a class="header-anchor" href="#主要变更" aria-label="Permalink to “主要变更”">​</a></h2><ol><li><strong>复用组件</strong>：新增 <code>.github/actions/setup-env</code> composite action，支持 checkout、Node/GraalVM 安装、npm ci、Gradle 权限与缓存策略参数化；新增 <code>.github/workflows/_reusable-build.yml</code>，统一 TypeScript 构建并产出 <code>build-artifacts</code>。</li><li><strong>CI 重构</strong>：<code>ci.yml</code> 改为串联 reusable build job，并在所有 job 中使用 setup-env，移除重复的 checkout、Node/GraalVM 配置与 <code>chmod +x gradlew</code>，保持原有测试/发布矩阵。</li><li><strong>辅助 workflow 调整</strong>：<code>canary.yml</code> 引入独立构建 job 并依赖产物完成测试与发布；<code>build-native.yml</code> 与 <code>e2e-tests.yml</code> 统一使用 setup-env，拆分 TypeScript 构建阶段，减少重复脚本。</li><li><strong>Lint 统一</strong>：新增 <code>.yamllint</code>，自定义 line-length、brackets、truthy、document-start 规则以适配包含 shell 脚本的 workflow；所有新增/更新 workflow 已通过 lint。</li></ol><h2 id="关键实现细节" tabindex="-1">关键实现细节 <a class="header-anchor" href="#关键实现细节" aria-label="Permalink to “关键实现细节”">​</a></h2><ul><li>setup-env 支持 <code>enable-node/java/gradle</code>、<code>java-provider</code>、<code>native-image-job-reports</code>、<code>registry-url</code>、<code>working-directory</code> 等输入，可在需要时自动切换 GraalVM / Temurin 并运行 <code>npm ci</code>。</li><li>reusable TypeScript build 仅负责生成 <code>dist/</code> 并上传 artifact，CI、Canary、Native workflow 可直接 <code>needs</code> 此 job，避免重复执行 <code>npm run build</code>。</li><li>CI 文件按 job 分组（Node 质量、Bench、安全、JVM、Cross-stack、Quarkus、Policy API、Truffle 等），所有 job 共享同一 setup step，可在未来通过调整 action 输入统一升级 Java/Node 版本。</li><li><code>canary.yml</code> 现先构建再发布，主 job 仅负责测试与 npm 发布，保留 PR 评论。</li><li><code>build-native.yml</code> 通过 <code>native-dist</code> artifact 替换 <code>npm run build</code> 步骤，Gradle 缓存交由 GraalVM/Setup-Java 内置机制处理。</li><li><code>e2e-tests.yml</code> 简化为使用 setup-env 进行 checkout，主要逻辑集中在 docker build/push 与 compose 运行。</li><li><code>.yamllint</code> 设置 <code>max: 200</code> 行长且允许不可拆分单词，关闭 document-start/truthy/brackets 规则，保证描述性命令/脚本不会触发误报。</li></ul>',6)])])}const b=o(c,[["render",l]]);export{p as __pageData,b as default};
