import{_ as i,c as a,o as l,aj as n}from"./chunks/framework.Bz2R-749.js";const g=JSON.parse('{"title":"Phase 3.8 ç›‘æ§è¿ç»´æ‰‹å†Œ","description":"","frontmatter":{},"headers":[],"relativePath":"workstreams/phase-3.8/monitoring-guide.md","filePath":"workstreams/phase-3.8/monitoring-guide.md"}'),t={name:"workstreams/phase-3.8/monitoring-guide.md"};function h(k,s,p,e,r,d){return l(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="phase-3-8-ç›‘æ§è¿ç»´æ‰‹å†Œ" tabindex="-1">Phase 3.8 ç›‘æ§è¿ç»´æ‰‹å†Œ <a class="header-anchor" href="#phase-3-8-ç›‘æ§è¿ç»´æ‰‹å†Œ" aria-label="Permalink to â€œPhase 3.8 ç›‘æ§è¿ç»´æ‰‹å†Œâ€">â€‹</a></h1><h2 id="ç›‘æ§æ¦‚è¿°" tabindex="-1">ç›‘æ§æ¦‚è¿° <a class="header-anchor" href="#ç›‘æ§æ¦‚è¿°" aria-label="Permalink to â€œç›‘æ§æ¦‚è¿°â€">â€‹</a></h2><p>Phase 3.8 å¼•å…¥äº†ä»£è¡¨æ€§æ ·æœ¬å’Œ Replay éªŒè¯è‡ªåŠ¨åŒ–ï¼Œéœ€è¦ç›‘æ§ä»¥ä¸‹å…³é”®æŒ‡æ ‡ä»¥ç¡®ä¿åŠŸèƒ½æ­£å¸¸è¿è¡Œã€‚</p><h2 id="æ ¸å¿ƒç›‘æ§æŒ‡æ ‡" tabindex="-1">æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ <a class="header-anchor" href="#æ ¸å¿ƒç›‘æ§æŒ‡æ ‡" aria-label="Permalink to â€œæ ¸å¿ƒç›‘æ§æŒ‡æ ‡â€">â€‹</a></h2><h3 id="_1-sampleworkflowid-æ•è·ç‡" tabindex="-1">1. sampleWorkflowId æ•è·ç‡ <a class="header-anchor" href="#_1-sampleworkflowid-æ•è·ç‡" aria-label="Permalink to â€œ1. sampleWorkflowId æ•è·ç‡â€">â€‹</a></h3><p><strong>å®šä¹‰</strong>: æ£€æµ‹åˆ°çš„å¼‚å¸¸ä¸­æˆåŠŸæ•è· sampleWorkflowId çš„æ¯”ä¾‹</p><p><strong>é‡è¦æ€§</strong>: ğŸ”´ å…³é”®æŒ‡æ ‡</p><ul><li>æ•è·ç‡ä½è¯´æ˜æ•°æ®é“¾è·¯æ–­è£‚</li><li>å½±å“è‡ªåŠ¨éªŒè¯åŠŸèƒ½</li></ul><p><strong>ç›‘æ§æŸ¥è¯¢</strong>:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_anomalies,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sample_workflow_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> with_sample,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sample_workflow_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> without_sample,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ROUND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sample_workflow_id)::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">numeric</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULLIF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> capture_rate_percent</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> anomaly_reports</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> detected_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INTERVAL </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;24 hours&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> anomaly_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;HIGH_FAILURE_RATE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- ä»…ç»Ÿè®¡åº”è¯¥æœ‰æ ·æœ¬çš„ç±»å‹</span></span></code></pre></div><p><strong>å‘Šè­¦é˜ˆå€¼</strong>:</p><ul><li>âš ï¸ Warning: capture_rate &lt; 80%</li><li>ğŸš¨ Critical: capture_rate &lt; 50%</li></ul><p><strong>å¯èƒ½åŸå› </strong>:</p><ul><li>workflow æ•°æ®è¢«æå‰æ¸…ç†</li><li>æ£€æµ‹æŸ¥è¯¢æ€§èƒ½é—®é¢˜å¯¼è‡´è¶…æ—¶</li><li>JOIN LATERAL å­æŸ¥è¯¢å¤±è´¥</li></ul><p><strong>ä¿®å¤å»ºè®®</strong>:</p><ol><li>æ£€æŸ¥ workflow æ•°æ®ä¿ç•™ç­–ç•¥</li><li>ä¼˜åŒ–æ£€æµ‹æŸ¥è¯¢æ€§èƒ½</li><li>æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„ SQL é”™è¯¯</li></ol><hr><h3 id="_2-replay-éªŒè¯æˆåŠŸç‡" tabindex="-1">2. Replay éªŒè¯æˆåŠŸç‡ <a class="header-anchor" href="#_2-replay-éªŒè¯æˆåŠŸç‡" aria-label="Permalink to â€œ2. Replay éªŒè¯æˆåŠŸç‡â€">â€‹</a></h3><p><strong>å®šä¹‰</strong>: æäº¤çš„ replay éªŒè¯ä¸­æˆåŠŸæ‰§è¡Œçš„æ¯”ä¾‹</p><p><strong>é‡è¦æ€§</strong>: ğŸ”´ å…³é”®æŒ‡æ ‡</p><ul><li>æˆåŠŸç‡ä½è¯´æ˜ replay æœºåˆ¶ä¸ç¨³å®š</li><li>å½±å“å¼‚å¸¸ç¡®è®¤çš„å¯é æ€§</li></ul><p><strong>ç›‘æ§æŸ¥è¯¢</strong>:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_verifications,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result::jsonb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;replaySucceeded&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;true&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> THEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ELSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> successful_replays,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result::jsonb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;replaySucceeded&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;false&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> THEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ELSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> failed_replays,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> THEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ELSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pending,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ROUND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result::jsonb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;replaySucceeded&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;true&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> THEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ELSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">numeric</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULLIF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> THEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ELSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> success_rate_percent</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> anomaly_reports</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;VERIFIED&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;VERIFYING&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verified_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INTERVAL </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;24 hours&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><strong>å‘Šè­¦é˜ˆå€¼</strong>:</p><ul><li>âš ï¸ Warning: success_rate &lt; 70%</li><li>ğŸš¨ Critical: success_rate &lt; 50%</li></ul><p><strong>å¯èƒ½åŸå› </strong>:</p><ul><li>clock_times æ•°æ®ç¼ºå¤±æˆ–æŸå</li><li>Policy ç¼–è¯‘å¤±è´¥</li><li>è¶…æ—¶é…ç½®ä¸åˆç†</li></ul><p><strong>ä¿®å¤å»ºè®®</strong>:</p><ol><li>æ£€æŸ¥ clock_times æ•°æ®è´¨é‡</li><li>å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆå½“å‰ 5 åˆ†é’Ÿï¼‰</li><li>æ£€æŸ¥ policy ç¼–è¯‘æ—¥å¿—</li></ol><hr><h3 id="_3-replay-è¶…æ—¶é¢‘ç‡" tabindex="-1">3. Replay è¶…æ—¶é¢‘ç‡ <a class="header-anchor" href="#_3-replay-è¶…æ—¶é¢‘ç‡" aria-label="Permalink to â€œ3. Replay è¶…æ—¶é¢‘ç‡â€">â€‹</a></h3><p><strong>å®šä¹‰</strong>: å› è¶…æ—¶è€Œå¤±è´¥çš„ replay éªŒè¯æ¯”ä¾‹</p><p><strong>é‡è¦æ€§</strong>: ğŸŸ¡ é‡è¦æŒ‡æ ‡</p><ul><li>è¶…æ—¶é¢‘ç‡é«˜å½±å“ç”¨æˆ·ä½“éªŒ</li><li>å¯èƒ½éœ€è¦ä¼˜åŒ–æ€§èƒ½æˆ–è°ƒæ•´é…ç½®</li></ul><p><strong>ç›‘æ§æŸ¥è¯¢</strong>:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_actions,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CASE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result::jsonb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;replaySucceeded&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;false&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result::jsonb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;errorMessage&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;%timeout%&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        THEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ELSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timeout_count,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ROUND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CASE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result::jsonb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;replaySucceeded&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;false&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_result::jsonb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;errorMessage&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;%timeout%&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            THEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ELSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">numeric</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULLIF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timeout_rate_percent</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> anomaly_reports</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;VERIFIED&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verified_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INTERVAL </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;24 hours&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><strong>å‘Šè­¦é˜ˆå€¼</strong>:</p><ul><li>âš ï¸ Warning: timeout_rate &gt; 10%</li><li>ğŸš¨ Critical: timeout_rate &gt; 20%</li></ul><p><strong>å¯èƒ½åŸå› </strong>:</p><ul><li>Policy æ‰§è¡Œå¤æ‚åº¦é«˜</li><li>æ•°æ®åº“æŸ¥è¯¢æ…¢</li><li>ç³»ç»Ÿè´Ÿè½½è¿‡é«˜</li></ul><p><strong>ä¿®å¤å»ºè®®</strong>:</p><ol><li>åˆ†æè¶…æ—¶çš„ policy ç‰¹å¾</li><li>è€ƒè™‘å¢åŠ è¶…æ—¶é…ç½®ï¼ˆä¿®æ”¹ <code>Duration.ofMinutes(5)</code>ï¼‰</li><li>ä¼˜åŒ– policy æ‰§è¡Œæ€§èƒ½</li></ol><hr><h3 id="_4-å¼‚å¸¸æ£€æµ‹æ€§èƒ½" tabindex="-1">4. å¼‚å¸¸æ£€æµ‹æ€§èƒ½ <a class="header-anchor" href="#_4-å¼‚å¸¸æ£€æµ‹æ€§èƒ½" aria-label="Permalink to â€œ4. å¼‚å¸¸æ£€æµ‹æ€§èƒ½â€">â€‹</a></h3><p><strong>å®šä¹‰</strong>: detectAnomalies() æŸ¥è¯¢çš„å¹³å‡æ‰§è¡Œæ—¶é—´</p><p><strong>é‡è¦æ€§</strong>: ğŸŸ¡ é‡è¦æŒ‡æ ‡</p><ul><li>æ€§èƒ½ä¸‹é™å½±å“æ£€æµ‹é¢‘ç‡</li><li>JOIN LATERAL å¯èƒ½æˆä¸ºç“¶é¢ˆ</li></ul><p><strong>ç›‘æ§æŸ¥è¯¢</strong> (éœ€è¦å¯ç”¨ <code>pg_stat_statements</code>):</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    substring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query_snippet,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    calls,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mean_exec_time,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_exec_time,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stddev_exec_time</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pg_stat_statements</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;%JOIN LATERAL%sample_workflow%&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;%detectAnomalies%&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mean_exec_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DESC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIMIT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><strong>å‘Šè­¦é˜ˆå€¼</strong>:</p><ul><li>âš ï¸ Warning: mean_exec_time &gt; 500ms</li><li>ğŸš¨ Critical: mean_exec_time &gt; 1000ms</li></ul><p><strong>å¯èƒ½åŸå› </strong>:</p><ul><li>workflow_state è¡¨æ•°æ®é‡è¿‡å¤§</li><li>ç´¢å¼•ç¼ºå¤±æˆ–å¤±æ•ˆ</li><li>ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶</li></ul><p><strong>ä¿®å¤å»ºè®®</strong>:</p><ol><li>æ¸…ç†å†å² workflow æ•°æ®</li><li>é‡å»ºç´¢å¼•ï¼š<code>REINDEX TABLE workflow_state;</code></li><li>æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼š<code>ANALYZE workflow_state;</code></li></ol><hr><h3 id="_5-payload-æ„å»ºæˆåŠŸç‡" tabindex="-1">5. Payload æ„å»ºæˆåŠŸç‡ <a class="header-anchor" href="#_5-payload-æ„å»ºæˆåŠŸç‡" aria-label="Permalink to â€œ5. Payload æ„å»ºæˆåŠŸç‡â€">â€‹</a></h3><p><strong>å®šä¹‰</strong>: æäº¤éªŒè¯åŠ¨ä½œæ—¶æˆåŠŸæ„å»º payload çš„æ¯”ä¾‹</p><p><strong>é‡è¦æ€§</strong>: ğŸŸ¢ è¾…åŠ©æŒ‡æ ‡</p><ul><li>è¾…åŠ©è¯Šæ–­æ•°æ®é“¾è·¯é—®é¢˜</li></ul><p><strong>ç›‘æ§æŸ¥è¯¢</strong>:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_actions,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> with_payload,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> without_payload,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ROUND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload)::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">numeric</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULLIF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> payload_rate_percent</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> anomaly_actions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;VERIFY_REPLAY&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INTERVAL </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;24 hours&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><strong>å‘Šè­¦é˜ˆå€¼</strong>:</p><ul><li>âš ï¸ Warning: payload_rate &lt; 80%</li></ul><p><strong>å¯èƒ½åŸå› </strong>:</p><ul><li>sampleWorkflowId æ•è·å¤±è´¥</li><li>æ•°æ®ä¼ é€’é“¾è·¯æ–­è£‚</li></ul><p><strong>ä¿®å¤å»ºè®®</strong>:</p><ol><li>æ£€æŸ¥ sampleWorkflowId æ•è·ç‡</li><li>éªŒè¯å¼‚å¸¸æŠ¥å‘ŠæŒä¹…åŒ–é€»è¾‘</li></ol><hr><h2 id="ç›‘æ§ä»ªè¡¨æ¿é…ç½®" tabindex="-1">ç›‘æ§ä»ªè¡¨æ¿é…ç½® <a class="header-anchor" href="#ç›‘æ§ä»ªè¡¨æ¿é…ç½®" aria-label="Permalink to â€œç›‘æ§ä»ªè¡¨æ¿é…ç½®â€">â€‹</a></h2><h3 id="grafana-é…ç½®ç¤ºä¾‹" tabindex="-1">Grafana é…ç½®ç¤ºä¾‹ <a class="header-anchor" href="#grafana-é…ç½®ç¤ºä¾‹" aria-label="Permalink to â€œGrafana é…ç½®ç¤ºä¾‹â€">â€‹</a></h3><p><strong>Panel 1: sampleWorkflowId æ•è·ç‡</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Phase 3.8 - Sample Workflow æ•è·ç‡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;targets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;time_series&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;rawSql&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  $__timeGroup(detected_at, &#39;1h&#39;) as time,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ROUND(COUNT(sample_workflow_id)::numeric / COUNT(*) * 100, 2) as capture_rate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FROM anomaly_reports</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WHERE $__timeFilter(detected_at) AND anomaly_type = &#39;HIGH_FAILURE_RATE&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GROUP BY 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ORDER BY 1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;alert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;conditions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;evaluator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lt&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Panel 2: Replay éªŒè¯æˆåŠŸç‡</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Phase 3.8 - Replay éªŒè¯æˆåŠŸç‡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;targets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;time_series&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;rawSql&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  $__timeGroup(verified_at, &#39;1h&#39;) as time,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ROUND(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    SUM(CASE WHEN verification_result::jsonb-&gt;&gt;&#39;replaySucceeded&#39; = &#39;true&#39; THEN 1 ELSE 0 END)::numeric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    / NULLIF(COUNT(*), 0) * 100,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ) as success_rate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FROM anomaly_reports</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WHERE $__timeFilter(verified_at) AND status = &#39;VERIFIED&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GROUP BY 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ORDER BY 1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;alert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;conditions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;evaluator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">70</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lt&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="æ—¥å¿—ç›‘æ§" tabindex="-1">æ—¥å¿—ç›‘æ§ <a class="header-anchor" href="#æ—¥å¿—ç›‘æ§" aria-label="Permalink to â€œæ—¥å¿—ç›‘æ§â€">â€‹</a></h2><h3 id="å…³é”®æ—¥å¿—å…³é”®è¯" tabindex="-1">å…³é”®æ—¥å¿—å…³é”®è¯ <a class="header-anchor" href="#å…³é”®æ—¥å¿—å…³é”®è¯" aria-label="Permalink to â€œå…³é”®æ—¥å¿—å…³é”®è¯â€">â€‹</a></h3><p><strong>æ£€æµ‹æˆåŠŸæ—¥å¿—</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>INFO  [io.aster.audit.service.PolicyAnalyticsService] Detected 5 anomalies, 4 with sampleWorkflowId</span></span></code></pre></div><p><strong>Payload æ„å»ºæ—¥å¿—</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>INFO  [io.aster.audit.service.AnomalyWorkflowService] Built payload for anomaly 123, workflowId: 550e8400-e29b-41d4-a716-446655440000</span></span></code></pre></div><p><strong>Replay æ‰§è¡Œæ—¥å¿—</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>INFO  [io.aster.workflow.WorkflowSchedulerService] Starting replay for workflow 550e8400-e29b-41d4-a716-446655440000</span></span>
<span class="line"><span>INFO  [io.aster.workflow.WorkflowSchedulerService] Replay completed in 1234ms, status: COMPLETED</span></span></code></pre></div><p><strong>é”™è¯¯æ—¥å¿—</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>ERROR [io.aster.audit.service.PolicyAnalyticsService] Failed to detect anomalies: SQL timeout</span></span>
<span class="line"><span>ERROR [io.aster.workflow.WorkflowSchedulerService] Workflow 550e8400-... missing clock_times, cannot replay</span></span>
<span class="line"><span>ERROR [io.aster.audit.service.AnomalyActionExecutor] Replay verification failed: timeout after 5 minutes</span></span></code></pre></div><h3 id="æ—¥å¿—ç›‘æ§è§„åˆ™-elk-splunk" tabindex="-1">æ—¥å¿—ç›‘æ§è§„åˆ™ (ELK/Splunk) <a class="header-anchor" href="#æ—¥å¿—ç›‘æ§è§„åˆ™-elk-splunk" aria-label="Permalink to â€œæ—¥å¿—ç›‘æ§è§„åˆ™ (ELK/Splunk)â€">â€‹</a></h3><p><strong>æ•è·å¤±è´¥å‘Šè­¦</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>source=&quot;/var/log/quarkus-policy-api.log&quot;</span></span>
<span class="line"><span>| search &quot;Detected&quot; AND &quot;anomalies&quot; AND &quot;with sampleWorkflowId&quot;</span></span>
<span class="line"><span>| rex field=_raw &quot;Detected (?&lt;total&gt;\\d+) anomalies, (?&lt;with_sample&gt;\\d+) with sampleWorkflowId&quot;</span></span>
<span class="line"><span>| eval capture_rate = (with_sample / total) * 100</span></span>
<span class="line"><span>| where capture_rate &lt; 80</span></span>
<span class="line"><span>| alert</span></span></code></pre></div><p><strong>Replay è¶…æ—¶å‘Šè­¦</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>source=&quot;/var/log/quarkus-policy-api.log&quot;</span></span>
<span class="line"><span>| search &quot;Replay verification failed&quot; AND &quot;timeout&quot;</span></span>
<span class="line"><span>| stats count by _time span=1h</span></span>
<span class="line"><span>| where count &gt; 10</span></span>
<span class="line"><span>| alert</span></span></code></pre></div><hr><h2 id="è¿ç»´æ‰‹å†Œ" tabindex="-1">è¿ç»´æ‰‹å†Œ <a class="header-anchor" href="#è¿ç»´æ‰‹å†Œ" aria-label="Permalink to â€œè¿ç»´æ‰‹å†Œâ€">â€‹</a></h2><h3 id="æ¯æ—¥æ£€æŸ¥æ¸…å•" tabindex="-1">æ¯æ—¥æ£€æŸ¥æ¸…å• <a class="header-anchor" href="#æ¯æ—¥æ£€æŸ¥æ¸…å•" aria-label="Permalink to â€œæ¯æ—¥æ£€æŸ¥æ¸…å•â€">â€‹</a></h3><ul><li>[ ] æŸ¥çœ‹ sampleWorkflowId æ•è·ç‡ï¼ˆåº” &gt; 80%ï¼‰</li><li>[ ] æŸ¥çœ‹ Replay éªŒè¯æˆåŠŸç‡ï¼ˆåº” &gt; 70%ï¼‰</li><li>[ ] æ£€æŸ¥æ˜¯å¦æœ‰è¶…æ—¶å‘Šè­¦</li><li>[ ] æ£€æŸ¥å¼‚å¸¸æ£€æµ‹æ€§èƒ½ï¼ˆåº” &lt; 500msï¼‰</li></ul><h3 id="æ¯å‘¨æ£€æŸ¥æ¸…å•" tabindex="-1">æ¯å‘¨æ£€æŸ¥æ¸…å• <a class="header-anchor" href="#æ¯å‘¨æ£€æŸ¥æ¸…å•" aria-label="Permalink to â€œæ¯å‘¨æ£€æŸ¥æ¸…å•â€">â€‹</a></h3><ul><li>[ ] åˆ†æ Replay å¤±è´¥åŸå› åˆ†å¸ƒ</li><li>[ ] æ£€æŸ¥ workflow æ•°æ®ä¿ç•™ç­–ç•¥</li><li>[ ] å®¡æŸ¥å‘Šè­¦è§„åˆ™æœ‰æ•ˆæ€§</li><li>[ ] ç»Ÿè®¡ Phase 3.8 åŠŸèƒ½ä½¿ç”¨æƒ…å†µ</li></ul><h3 id="æ•…éšœæ’æŸ¥æ‰‹å†Œ" tabindex="-1">æ•…éšœæ’æŸ¥æ‰‹å†Œ <a class="header-anchor" href="#æ•…éšœæ’æŸ¥æ‰‹å†Œ" aria-label="Permalink to â€œæ•…éšœæ’æŸ¥æ‰‹å†Œâ€">â€‹</a></h3><h4 id="é—®é¢˜-1-sampleworkflowid-æ•è·ç‡çªç„¶ä¸‹é™" tabindex="-1">é—®é¢˜ 1: sampleWorkflowId æ•è·ç‡çªç„¶ä¸‹é™ <a class="header-anchor" href="#é—®é¢˜-1-sampleworkflowid-æ•è·ç‡çªç„¶ä¸‹é™" aria-label="Permalink to â€œé—®é¢˜ 1: sampleWorkflowId æ•è·ç‡çªç„¶ä¸‹é™â€">â€‹</a></h4><p><strong>è¯Šæ–­æ­¥éª¤</strong>:</p><ol><li>æ£€æŸ¥ workflow_state è¡¨æ˜¯å¦æœ‰æ•°æ®<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> workflow_state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> started_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INTERVAL </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1 day&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div></li><li>æ£€æŸ¥å¼‚å¸¸æ£€æµ‹æŸ¥è¯¢æ˜¯å¦æŠ¥é”™ï¼ˆæŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼‰</li><li>æ£€æŸ¥æ•°æ®åº“è¿æ¥æ± æ˜¯å¦è€—å°½</li></ol><p><strong>ä¿®å¤æ­¥éª¤</strong>:</p><ol><li>å¦‚æœ workflow æ•°æ®ä¸ºç©ºï¼Œæ£€æŸ¥æ•°æ®é‡‡é›†æµç¨‹</li><li>å¦‚æœæŸ¥è¯¢è¶…æ—¶ï¼Œä¸´æ—¶å¢åŠ æŸ¥è¯¢è¶…æ—¶é…ç½®</li><li>é‡å¯åº”ç”¨ï¼ˆå¦‚æœè¿æ¥æ± è€—å°½ï¼‰</li></ol><h4 id="é—®é¢˜-2-replay-éªŒè¯å…¨éƒ¨å¤±è´¥" tabindex="-1">é—®é¢˜ 2: Replay éªŒè¯å…¨éƒ¨å¤±è´¥ <a class="header-anchor" href="#é—®é¢˜-2-replay-éªŒè¯å…¨éƒ¨å¤±è´¥" aria-label="Permalink to â€œé—®é¢˜ 2: Replay éªŒè¯å…¨éƒ¨å¤±è´¥â€">â€‹</a></h4><p><strong>è¯Šæ–­æ­¥éª¤</strong>:</p><ol><li>æ£€æŸ¥ clock_times æ˜¯å¦å­˜åœ¨<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> workflow_state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clock_times </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IS NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> started_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INTERVAL </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1 day&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div></li><li>æ£€æŸ¥ WorkflowSchedulerService æ—¥å¿—</li><li>æ£€æŸ¥ policy ç¼–è¯‘æ˜¯å¦æ­£å¸¸</li></ol><p><strong>ä¿®å¤æ­¥éª¤</strong>:</p><ol><li>å¦‚æœ clock_times ç¼ºå¤±ï¼Œæ£€æŸ¥ workflow è¿è¡Œæ—¶é…ç½®</li><li>å¦‚æœç¼–è¯‘å¤±è´¥ï¼Œæ£€æŸ¥ policy ä»£ç å’Œä¾èµ–</li><li>ä¸´æ—¶ç¦ç”¨è‡ªåŠ¨éªŒè¯ï¼Œæ”¹ä¸ºæ‰‹åŠ¨éªŒè¯</li></ol><h4 id="é—®é¢˜-3-å¼‚å¸¸æ£€æµ‹æ€§èƒ½ä¸‹é™" tabindex="-1">é—®é¢˜ 3: å¼‚å¸¸æ£€æµ‹æ€§èƒ½ä¸‹é™ <a class="header-anchor" href="#é—®é¢˜-3-å¼‚å¸¸æ£€æµ‹æ€§èƒ½ä¸‹é™" aria-label="Permalink to â€œé—®é¢˜ 3: å¼‚å¸¸æ£€æµ‹æ€§èƒ½ä¸‹é™â€">â€‹</a></h4><p><strong>è¯Šæ–­æ­¥éª¤</strong>:</p><ol><li>æŸ¥çœ‹ <code>pg_stat_statements</code> æ…¢æŸ¥è¯¢</li><li>æ£€æŸ¥ workflow_state è¡¨å¤§å°<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pg_size_pretty(pg_total_relation_size(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;workflow_state&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre></div></li><li>æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pg_indexes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tablename </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;workflow_state&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div></li></ol><p><strong>ä¿®å¤æ­¥éª¤</strong>:</p><ol><li>æ¸…ç†å†å²æ•°æ®ï¼ˆä¿ç•™æœ€è¿‘ 30 å¤©ï¼‰</li><li>é‡å»ºç´¢å¼•ï¼š<code>REINDEX TABLE workflow_state;</code></li><li>æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼š<code>ANALYZE workflow_state;</code></li></ol><hr><h2 id="æ€§èƒ½åŸºå‡†" tabindex="-1">æ€§èƒ½åŸºå‡† <a class="header-anchor" href="#æ€§èƒ½åŸºå‡†" aria-label="Permalink to â€œæ€§èƒ½åŸºå‡†â€">â€‹</a></h2><h3 id="æ­£å¸¸æƒ…å†µä¸‹çš„æ€§èƒ½æŒ‡æ ‡" tabindex="-1">æ­£å¸¸æƒ…å†µä¸‹çš„æ€§èƒ½æŒ‡æ ‡ <a class="header-anchor" href="#æ­£å¸¸æƒ…å†µä¸‹çš„æ€§èƒ½æŒ‡æ ‡" aria-label="Permalink to â€œæ­£å¸¸æƒ…å†µä¸‹çš„æ€§èƒ½æŒ‡æ ‡â€">â€‹</a></h3><table tabindex="0"><thead><tr><th>æŒ‡æ ‡</th><th>ç›®æ ‡å€¼</th><th>å¯æ¥å—èŒƒå›´</th><th>å‘Šè­¦é˜ˆå€¼</th></tr></thead><tbody><tr><td>sampleWorkflowId æ•è·ç‡</td><td>&gt; 95%</td><td>80-95%</td><td>&lt; 80%</td></tr><tr><td>Replay éªŒè¯æˆåŠŸç‡</td><td>&gt; 85%</td><td>70-85%</td><td>&lt; 70%</td></tr><tr><td>Replay è¶…æ—¶ç‡</td><td>&lt; 5%</td><td>5-10%</td><td>&gt; 10%</td></tr><tr><td>å¼‚å¸¸æ£€æµ‹æŸ¥è¯¢æ—¶é—´</td><td>&lt; 300ms</td><td>300-500ms</td><td>&gt; 500ms</td></tr><tr><td>Payload æ„å»ºæˆåŠŸç‡</td><td>&gt; 95%</td><td>80-95%</td><td>&lt; 80%</td></tr></tbody></table><h3 id="è´Ÿè½½æµ‹è¯•åŸºå‡†" tabindex="-1">è´Ÿè½½æµ‹è¯•åŸºå‡† <a class="header-anchor" href="#è´Ÿè½½æµ‹è¯•åŸºå‡†" aria-label="Permalink to â€œè´Ÿè½½æµ‹è¯•åŸºå‡†â€">â€‹</a></h3><p><strong>æµ‹è¯•åœºæ™¯</strong>: 1000 ä¸ª workflowï¼Œ50% å¤±è´¥ç‡ï¼Œæ¯ 5 åˆ†é’Ÿæ£€æµ‹ä¸€æ¬¡</p><p><strong>é¢„æœŸç»“æœ</strong>:</p><ul><li>æ£€æµ‹æ—¶é—´: &lt; 500ms</li><li>sampleWorkflowId æ•è·: 100%</li><li>å†…å­˜å¢é•¿: &lt; 50MB</li><li>CPU ä½¿ç”¨: &lt; 20%</li></ul><hr><h2 id="å®¹é‡è§„åˆ’" tabindex="-1">å®¹é‡è§„åˆ’ <a class="header-anchor" href="#å®¹é‡è§„åˆ’" aria-label="Permalink to â€œå®¹é‡è§„åˆ’â€">â€‹</a></h2><h3 id="å­˜å‚¨å¢é•¿ä¼°ç®—" tabindex="-1">å­˜å‚¨å¢é•¿ä¼°ç®— <a class="header-anchor" href="#å­˜å‚¨å¢é•¿ä¼°ç®—" aria-label="Permalink to â€œå­˜å‚¨å¢é•¿ä¼°ç®—â€">â€‹</a></h3><p><strong>æ¯ä¸ªå¼‚å¸¸çš„é¢å¤–å­˜å‚¨</strong>:</p><ul><li><code>sample_workflow_id</code>: 16 bytes (UUID)</li><li>ç´¢å¼•å¼€é”€: ~24 bytes (ç¨€ç–ç´¢å¼•)</li></ul><p><strong>æœˆåº¦å¢é•¿ä¼°ç®—</strong>ï¼ˆå‡è®¾æ¯å¤© 100 ä¸ªå¼‚å¸¸ï¼‰:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>æ¯å¤©: 100 * 40 bytes = 4 KB</span></span>
<span class="line"><span>æ¯æœˆ: 4 KB * 30 = 120 KB</span></span>
<span class="line"><span>æ¯å¹´: 120 KB * 12 = 1.44 MB</span></span></code></pre></div><p><strong>ç»“è®º</strong>: å­˜å‚¨å¼€é”€æå°ï¼Œæ— éœ€ç‰¹æ®Šå®¹é‡è§„åˆ’</p><h3 id="æ€§èƒ½å½±å“" tabindex="-1">æ€§èƒ½å½±å“ <a class="header-anchor" href="#æ€§èƒ½å½±å“" aria-label="Permalink to â€œæ€§èƒ½å½±å“â€">â€‹</a></h3><p><strong>JOIN LATERAL æŸ¥è¯¢å¼€é”€</strong>:</p><ul><li>å¹³å‡å¢åŠ : 50-100ms</li><li>æœ€åæƒ…å†µ: 200msï¼ˆå¤§é‡ workflowï¼‰</li></ul><p><strong>å»ºè®®</strong>:</p><ul><li>workflow_state è¡¨ä¿ç•™æœ€è¿‘ 30 å¤©æ•°æ®</li><li>å®šæœŸæ¸…ç†å†å²æ•°æ®ä»¥ä¿æŒæŸ¥è¯¢æ€§èƒ½</li></ul><hr><h2 id="è”ç³»æ”¯æŒ" tabindex="-1">è”ç³»æ”¯æŒ <a class="header-anchor" href="#è”ç³»æ”¯æŒ" aria-label="Permalink to â€œè”ç³»æ”¯æŒâ€">â€‹</a></h2><p><strong>ç´§æ€¥é—®é¢˜</strong>:</p><ul><li>On-call: [on-call@example.com]</li><li>Slack: #platform-oncall</li></ul><p><strong>éç´§æ€¥å’¨è¯¢</strong>:</p><ul><li>Email: [support@example.com]</li><li>Jira: [é¡¹ç›®çœ‹æ¿é“¾æ¥]</li></ul>`,140)])])}const o=i(t,[["render",h]]);export{g as __pageData,o as default};
