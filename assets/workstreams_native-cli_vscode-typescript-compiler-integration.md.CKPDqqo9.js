import{_ as i,c as a,o as l,aj as t}from"./chunks/framework.Bz2R-749.js";const c=JSON.parse('{"title":"VSCode 扩展 TypeScript 编译器集成","description":"","frontmatter":{},"headers":[],"relativePath":"workstreams/native-cli/vscode-typescript-compiler-integration.md","filePath":"workstreams/native-cli/vscode-typescript-compiler-integration.md"}'),e={name:"workstreams/native-cli/vscode-typescript-compiler-integration.md"};function n(h,s,p,r,k,d){return l(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="vscode-扩展-typescript-编译器集成" tabindex="-1">VSCode 扩展 TypeScript 编译器集成 <a class="header-anchor" href="#vscode-扩展-typescript-编译器集成" aria-label="Permalink to “VSCode 扩展 TypeScript 编译器集成”">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p>为 <code>aster-vscode</code> 扩展添加了 TypeScript 解析器支持，实现了 compile、debug、build native、package 四个核心功能。</p><p><strong>实施日期</strong>: 2025-10-25</p><h2 id="功能特性" tabindex="-1">功能特性 <a class="header-anchor" href="#功能特性" aria-label="Permalink to “功能特性”">​</a></h2><h3 id="_1-compile-命令-aster-compile" tabindex="-1">1. Compile 命令 (aster.compile) <a class="header-anchor" href="#_1-compile-命令-aster-compile" aria-label="Permalink to “1. Compile 命令 (aster.compile)”">​</a></h3><p><strong>功能</strong>: 编译当前打开的 Aster 文件为 JVM 字节码</p><p><strong>实现</strong>:</p><ul><li>获取当前活动的 <code>.aster</code> 文件</li><li>调用 Aster CLI 的 <code>compile</code> 命令</li><li>支持通过配置选择 TypeScript 或 Java 编译器</li><li>显示进度通知和输出结果</li></ul><p><strong>使用方式</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Cmd/Ctrl+Shift+P → &quot;Aster: Compile File&quot;</span></span></code></pre></div><p><strong>配置项</strong>:</p><ul><li><code>aster.compiler</code>: 编译器选择 (typescript/java)</li><li><code>aster.output.directory</code>: 输出目录</li><li><code>aster.debug.enabled</code>: 调试模式</li></ul><h3 id="_2-package-命令-aster-package" tabindex="-1">2. Package 命令 (aster.package) <a class="header-anchor" href="#_2-package-命令-aster-package" aria-label="Permalink to “2. Package 命令 (aster.package)”">​</a></h3><p><strong>功能</strong>: 编译并打包为可执行 JAR 文件</p><p><strong>实现</strong>:</p><ul><li>先调用 <code>compile</code> 命令编译代码</li><li>再调用 <code>jar</code> 命令生成 JAR</li><li>自动命名 JAR 文件 (<code>&lt;filename&gt;.jar</code>)</li></ul><p><strong>使用方式</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Cmd/Ctrl+Shift+P → &quot;Aster: Package to JAR&quot;</span></span></code></pre></div><h3 id="_3-debug-命令-aster-debug" tabindex="-1">3. Debug 命令 (aster.debug) <a class="header-anchor" href="#_3-debug-命令-aster-debug" aria-label="Permalink to “3. Debug 命令 (aster.debug)”">​</a></h3><p><strong>功能</strong>: 编译并启动 Java 调试会话</p><p><strong>实现</strong>:</p><ul><li>先编译文件</li><li>创建 Java 调试配置</li><li>启动 VSCode 调试会话</li></ul><p><strong>前置条件</strong>:</p><ul><li>需要安装 Java 调试扩展（如 Debugger for Java）</li></ul><p><strong>使用方式</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Cmd/Ctrl+Shift+P → &quot;Aster: Debug File&quot;</span></span></code></pre></div><h3 id="_4-build-native-命令-aster-buildnative" tabindex="-1">4. Build Native 命令 (aster.buildNative) <a class="header-anchor" href="#_4-build-native-命令-aster-buildnative" aria-label="Permalink to “4. Build Native 命令 (aster.buildNative)”">​</a></h3><p><strong>功能</strong>: 构建原生可执行文件（占位实现）</p><p><strong>当前行为</strong>:</p><ul><li>编译为 JVM 字节码</li><li>显示提示信息：&quot;原生构建功能即将推出&quot;</li></ul><p><strong>未来计划</strong>:</p><ul><li>集成 GraalVM Native Image</li><li>生成独立的原生可执行文件</li></ul><h2 id="技术架构" tabindex="-1">技术架构 <a class="header-anchor" href="#技术架构" aria-label="Permalink to “技术架构”">​</a></h2><h3 id="文件结构" tabindex="-1">文件结构 <a class="header-anchor" href="#文件结构" aria-label="Permalink to “文件结构”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>aster-vscode/</span></span>
<span class="line"><span>├── package.json           # 扩展配置和命令定义</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   └── extension.ts       # 扩展主逻辑和命令实现</span></span>
<span class="line"><span>├── out/                   # 编译输出</span></span>
<span class="line"><span>├── README.md              # 用户文档</span></span>
<span class="line"><span>├── TESTING.md             # 测试指南</span></span>
<span class="line"><span>└── QUICKSTART.md          # 快速开始</span></span></code></pre></div><h3 id="核心实现" tabindex="-1">核心实现 <a class="header-anchor" href="#核心实现" aria-label="Permalink to “核心实现”">​</a></h3><h4 id="_1-cli-调用封装-runastercommand" tabindex="-1">1. CLI 调用封装 (<code>runAsterCommand</code>) <a class="header-anchor" href="#_1-cli-调用封装-runastercommand" aria-label="Permalink to “1. CLI 调用封装 (runAsterCommand)”">​</a></h4><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> runAsterCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  command</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">showOutput</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cwd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;{ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">stdout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">stderr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }&gt;</span></span></code></pre></div><p><strong>功能</strong>:</p><ul><li>解析 CLI 路径</li><li>设置环境变量 (<code>ASTER_COMPILER</code>, <code>ASTER_DEBUG</code>)</li><li>执行命令并处理输出</li><li>统一错误处理和用户反馈</li></ul><h4 id="_2-配置管理" tabindex="-1">2. 配置管理 <a class="header-anchor" href="#_2-配置管理" aria-label="Permalink to “2. 配置管理”">​</a></h4><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">defaultValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.workspace.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;aster&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cfg.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(key, defaultValue);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>配置项</strong>:</p><table tabindex="0"><thead><tr><th>配置键</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>compiler</code></td><td>enum</td><td><code>typescript</code></td><td>编译器后端</td></tr><tr><td><code>cli.path</code></td><td>string</td><td><code>aster-lang-cli/build/...</code></td><td>CLI 路径</td></tr><tr><td><code>output.directory</code></td><td>string</td><td><code>build/aster-out</code></td><td>输出目录</td></tr><tr><td><code>debug.enabled</code></td><td>boolean</td><td><code>false</code></td><td>调试模式</td></tr></tbody></table><h4 id="_3-进度反馈" tabindex="-1">3. 进度反馈 <a class="header-anchor" href="#_3-进度反馈" aria-label="Permalink to “3. 进度反馈”">​</a></h4><p>使用 <code>vscode.window.withProgress</code> 显示进度：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withProgress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    location: vscode.ProgressLocation.Notification,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`编译 \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">basename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filePath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}...\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cancellable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> runAsterCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;compile&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [filePath, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;--output&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, outputPath]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h4 id="_4-输出面板" tabindex="-1">4. 输出面板 <a class="header-anchor" href="#_4-输出面板" aria-label="Permalink to “4. 输出面板”">​</a></h4><p>使用专用输出面板显示详细输出：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> outputChannel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createOutputChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Aster&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">outputChannel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendLine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(output);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">outputChannel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">show</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to “配置示例”">​</a></h2><h3 id="基础配置-vscode-settings-json" tabindex="-1">基础配置 (<code>.vscode/settings.json</code>) <a class="header-anchor" href="#基础配置-vscode-settings-json" aria-label="Permalink to “基础配置 (.vscode/settings.json)”">​</a></h3><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aster.compiler&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;typescript&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aster.cli.path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;aster-lang-cli/build/install/aster-lang-cli/bin/aster-lang-cli&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aster.output.directory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;build/aster-out&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aster.debug.enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="高级配置-java-编译器-调试" tabindex="-1">高级配置（Java 编译器 + 调试） <a class="header-anchor" href="#高级配置-java-编译器-调试" aria-label="Permalink to “高级配置（Java 编译器 + 调试）”">​</a></h3><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aster.compiler&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;java&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aster.output.directory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;custom-output&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aster.debug.enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aster.cli.path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;custom/path/to/aster-lang-cli&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="环境变量" tabindex="-1">环境变量 <a class="header-anchor" href="#环境变量" aria-label="Permalink to “环境变量”">​</a></h2><p>扩展自动设置以下环境变量：</p><table tabindex="0"><thead><tr><th>变量</th><th>来源</th><th>说明</th></tr></thead><tbody><tr><td><code>ASTER_COMPILER</code></td><td><code>aster.compiler</code> 配置</td><td>typescript 或 java</td></tr><tr><td><code>ASTER_DEBUG</code></td><td><code>aster.debug.enabled</code> 配置</td><td>true 或未设置</td></tr></tbody></table><h2 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to “错误处理”">​</a></h2><h3 id="_1-cli-未找到" tabindex="-1">1. CLI 未找到 <a class="header-anchor" href="#_1-cli-未找到" aria-label="Permalink to “1. CLI 未找到”">​</a></h3><p><strong>错误</strong>: CLI 可执行文件不存在</p><p><strong>处理</strong>:</p><ul><li>检查文件存在性</li><li>显示错误信息：&quot;Aster CLI 未找到: [path]。请先构建项目（./gradlew :aster-lang-cli:installDist）。&quot;</li></ul><h3 id="_2-非-aster-文件" tabindex="-1">2. 非 Aster 文件 <a class="header-anchor" href="#_2-非-aster-文件" aria-label="Permalink to “2. 非 Aster 文件”">​</a></h3><p><strong>错误</strong>: 当前文件不是 <code>.aster</code> 文件</p><p><strong>处理</strong>:</p><ul><li>检查文件语言 ID</li><li>显示警告：&quot;请打开一个 .aster 文件&quot;</li></ul><h3 id="_3-编译错误" tabindex="-1">3. 编译错误 <a class="header-anchor" href="#_3-编译错误" aria-label="Permalink to “3. 编译错误”">​</a></h3><p><strong>错误</strong>: CLI 执行失败</p><p><strong>处理</strong>:</p><ul><li>捕获 stderr 和 stdout</li><li>显示错误消息：&quot;Aster [command] 失败: [error]&quot;</li><li>在输出面板显示详细错误</li></ul><h2 id="测试策略" tabindex="-1">测试策略 <a class="header-anchor" href="#测试策略" aria-label="Permalink to “测试策略”">​</a></h2><h3 id="单元测试场景" tabindex="-1">单元测试场景 <a class="header-anchor" href="#单元测试场景" aria-label="Permalink to “单元测试场景”">​</a></h3><ol><li><p><strong>Compile 命令</strong></p><ul><li>TypeScript 编译器</li><li>Java 编译器</li><li>输出目录配置</li></ul></li><li><p><strong>Package 命令</strong></p><ul><li>JAR 文件生成</li><li>文件命名正确性</li></ul></li><li><p><strong>配置管理</strong></p><ul><li>编译器切换</li><li>自定义路径</li><li>调试模式</li></ul></li><li><p><strong>错误处理</strong></p><ul><li>CLI 不存在</li><li>非法文件类型</li><li>编译失败</li></ul></li></ol><h3 id="集成测试" tabindex="-1">集成测试 <a class="header-anchor" href="#集成测试" aria-label="Permalink to “集成测试”">​</a></h3><p>参见 <a href="./../../../aster-vscode/TESTING.html">TESTING.md</a> 获取详细测试用例和执行步骤。</p><h2 id="性能考量" tabindex="-1">性能考量 <a class="header-anchor" href="#性能考量" aria-label="Permalink to “性能考量”">​</a></h2><h3 id="_1-命令执行" tabindex="-1">1. 命令执行 <a class="header-anchor" href="#_1-命令执行" aria-label="Permalink to “1. 命令执行”">​</a></h3><ul><li>使用 <code>execFileAsync</code> 异步执行，避免阻塞 UI</li><li>设置 10MB 输出缓冲区（<code>maxBuffer: 10 * 1024 * 1024</code>）</li><li>显示进度通知提供用户反馈</li></ul><h3 id="_2-输出处理" tabindex="-1">2. 输出处理 <a class="header-anchor" href="#_2-输出处理" aria-label="Permalink to “2. 输出处理”">​</a></h3><ul><li>按需显示输出（<code>showOutput</code> 选项）</li><li>使用输出面板而非弹窗避免干扰</li></ul><h3 id="_3-路径解析" tabindex="-1">3. 路径解析 <a class="header-anchor" href="#_3-路径解析" aria-label="Permalink to “3. 路径解析”">​</a></h3><ul><li>缓存工作区根目录</li><li>使用 <code>path.resolve</code> 确保路径正确性</li></ul><h2 id="已知限制" tabindex="-1">已知限制 <a class="header-anchor" href="#已知限制" aria-label="Permalink to “已知限制”">​</a></h2><ol><li><strong>Debug 配置</strong>: 需要根据实际编译输出手动调整 <code>mainClass</code></li><li><strong>Native 构建</strong>: 当前仅占位实现，待集成 GraalVM</li><li><strong>并发执行</strong>: 未实现任务队列，并发编译可能导致冲突</li><li><strong>增量编译</strong>: 每次都是完整编译，未实现增量编译</li></ol><h2 id="未来改进" tabindex="-1">未来改进 <a class="header-anchor" href="#未来改进" aria-label="Permalink to “未来改进”">​</a></h2><h3 id="短期-v0-4-0" tabindex="-1">短期（v0.4.0） <a class="header-anchor" href="#短期-v0-4-0" aria-label="Permalink to “短期（v0.4.0）”">​</a></h3><ul><li>[ ] 实现任务队列，支持并发编译</li><li>[ ] 优化 Debug 配置，自动推断 mainClass</li><li>[ ] 添加编译缓存，支持增量编译</li><li>[ ] 提供更多用户反馈（如编译时间统计）</li></ul><h3 id="中期-v0-5-0" tabindex="-1">中期（v0.5.0） <a class="header-anchor" href="#中期-v0-5-0" aria-label="Permalink to “中期（v0.5.0）”">​</a></h3><ul><li>[ ] 集成 GraalVM Native Image</li><li>[ ] 实现真正的原生构建</li><li>[ ] 支持多文件批量编译</li><li>[ ] 添加构建配置文件支持</li></ul><h3 id="长期-v1-0-0" tabindex="-1">长期（v1.0.0） <a class="header-anchor" href="#长期-v1-0-0" aria-label="Permalink to “长期（v1.0.0）”">​</a></h3><ul><li>[ ] 实现 Watch 模式（文件变化自动编译）</li><li>[ ] 集成测试运行器</li><li>[ ] 支持分布式编译</li><li>[ ] 添加性能分析工具</li></ul><h2 id="相关文件" tabindex="-1">相关文件 <a class="header-anchor" href="#相关文件" aria-label="Permalink to “相关文件”">​</a></h2><h3 id="核心代码" tabindex="-1">核心代码 <a class="header-anchor" href="#核心代码" aria-label="Permalink to “核心代码”">​</a></h3><ul><li><code>aster-vscode/src/extension.ts</code> - 扩展主逻辑（第85-313行）</li><li><code>aster-vscode/package.json</code> - 扩展配置（第66-119行）</li></ul><h3 id="文档" tabindex="-1">文档 <a class="header-anchor" href="#文档" aria-label="Permalink to “文档”">​</a></h3><ul><li><code>aster-vscode/README.md</code> - 用户文档</li><li><code>aster-vscode/TESTING.md</code> - 测试指南</li><li><code>aster-vscode/QUICKSTART.md</code> - 快速开始</li><li><code>docs/workstreams/native-cli/vscode-typescript-compiler-integration.md</code> - 本文档</li></ul><h3 id="cli-参考" tabindex="-1">CLI 参考 <a class="header-anchor" href="#cli-参考" aria-label="Permalink to “CLI 参考”">​</a></h3><ul><li><code>aster-lang-cli/src/main/java/aster/cli/CommandHandler.java</code> - CLI 命令处理</li><li><code>aster-lang-cli/src/main/java/aster/cli/Main.java</code> - CLI 入口</li></ul><h2 id="验证" tabindex="-1">验证 <a class="header-anchor" href="#验证" aria-label="Permalink to “验证”">​</a></h2><h3 id="功能验证" tabindex="-1">功能验证 <a class="header-anchor" href="#功能验证" aria-label="Permalink to “功能验证”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 构建 CLI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-lang-cli:installDist</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 编译扩展</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aster-vscode</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 在 VSCode 中按 F5 启动扩展</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 打开测试文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># test/cnl/programs/parser-tests/simple_function.aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. 执行命令</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Cmd+Shift+P → &quot;Aster: Compile File&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Cmd+Shift+P → &quot;Aster: Package to JAR&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6. 验证输出</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build/aster-out/</span></span></code></pre></div><h3 id="编译器切换验证" tabindex="-1">编译器切换验证 <a class="header-anchor" href="#编译器切换验证" aria-label="Permalink to “编译器切换验证”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置 TypeScript 编译器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;aster.compiler&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;typescript&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;aster.debug.enabled&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编译并检查输出</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 应显示 &quot;ASTER_COMPILER=typescript&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 切换到 Java 编译器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;aster.compiler&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 再次编译并检查输出</span></span></code></pre></div><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to “总结”">​</a></h2><p>成功为 aster-vscode 扩展集成了 TypeScript 编译器支持，实现了完整的编译、调试、构建、打包工作流。主要成就：</p><p>✅ <strong>4 个新命令</strong>: compile, debug, buildNative, package ✅ <strong>5 个新配置项</strong>: compiler, cli.path, output.directory, debug.enabled ✅ <strong>完整错误处理</strong>: CLI 未找到、文件类型检查、编译错误 ✅ <strong>用户体验</strong>: 进度通知、输出面板、友好错误信息 ✅ <strong>文档齐全</strong>: README, TESTING, QUICKSTART</p><p><strong>版本</strong>: 0.3.0 <strong>发布日期</strong>: 2025-10-25 <strong>状态</strong>: ✅ 已完成并测试</p>`,109)])])}const g=i(e,[["render",n]]);export{c as __pageData,g as default};
