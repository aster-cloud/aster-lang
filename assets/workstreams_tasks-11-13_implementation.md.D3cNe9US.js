import{_ as e,c as i,o,aj as l}from"./chunks/framework.Bz2R-749.js";const m=JSON.parse('{"title":"Tasks 11-13 实施记录","description":"","frontmatter":{},"headers":[],"relativePath":"workstreams/tasks-11-13/implementation.md","filePath":"workstreams/tasks-11-13/implementation.md"}'),c={name:"workstreams/tasks-11-13/implementation.md"};function s(t,a,r,d,n,u){return o(),i("div",null,[...a[0]||(a[0]=[l('<h1 id="tasks-11-13-实施记录" tabindex="-1">Tasks 11-13 实施记录 <a class="header-anchor" href="#tasks-11-13-实施记录" aria-label="Permalink to “Tasks 11-13 实施记录”">​</a></h1><ul><li><strong>日期</strong>：2025-11-13 08:43 NZST</li><li><strong>执行者</strong>：Codex</li></ul><h2 id="jmh-性能基准" tabindex="-1">JMH 性能基准 <a class="header-anchor" href="#jmh-性能基准" aria-label="Permalink to “JMH 性能基准”">​</a></h2><ul><li>新建 <code>quarkus-policy-api-benchmarks</code> 模块（Gradle + JMH），托管 <code>PolicyEvaluationBenchmark</code> 与自定义缓存引导器。</li><li>结果输出到 <code>build/reports/jmh/policy-evaluation.log</code>（含 p50/p95/p99 以及批量吞吐量数据）。</li><li>运行命令：<code>SKIP_GENERATE_ASTER_JAR=1 ./gradlew --no-configuration-cache :quarkus-policy-api-benchmarks:jmh</code>。</li></ul><h2 id="gatling-负载测试" tabindex="-1">Gatling 负载测试 <a class="header-anchor" href="#gatling-负载测试" aria-label="Permalink to “Gatling 负载测试”">​</a></h2><ul><li>在 <code>quarkus-policy-api</code> 中启用 Gatling 插件，新增 <code>PolicyEvaluationSimulation</code> 覆盖 3 种负载曲线 + GraphQL 场景。</li><li>运行方式：<code>./gradlew :quarkus-policy-api:gatlingRun -Dgatling.simulationClass=io.aster.policy.simulation.PolicyEvaluationSimulation</code>，可通过 <code>POLICY_API_BASE_URL</code>、<code>POLICY_TENANT</code> 调整目标。</li></ul><h2 id="redis-分布式缓存" tabindex="-1">Redis 分布式缓存 <a class="header-anchor" href="#redis-分布式缓存" aria-label="Permalink to “Redis 分布式缓存”">​</a></h2><ul><li>引入 <code>io.quarkus:quarkus-redis-cache</code>，新增 <code>quarkus.redis.hosts</code> 配置，docker-compose 中为 API 服务配置 redis host。</li><li><code>PolicyCacheManager</code> 增加 Redis Pub/Sub 通知机制，使用 <code>policy-cache:invalidate</code> 渠道同步跨节点失效事件，并在 <code>docker-compose.yml</code> 中确保实例依赖 <code>redis</code>。</li><li>通过 <code>RedisDataSource</code> 自动订阅，消息格式：<code>{tenantId, policyModule, policyFunction, hash}</code>，可对单键或整租户进行失效广播。</li></ul><h2 id="输出产物" tabindex="-1">输出产物 <a class="header-anchor" href="#输出产物" aria-label="Permalink to “输出产物”">​</a></h2><ul><li><code>quarkus-policy-api-benchmarks/</code> 模块及中央 JMH 报告。</li><li>Gatling 脚本 <code>src/gatling/scala/io/aster/policy/simulation/PolicyEvaluationSimulation.scala</code>。</li><li><code>.claude/tasks-11-13-performance-report.md</code> 综合性能报告。</li></ul>',10)])])}const p=e(c,[["render",s]]);export{m as __pageData,p as default};
