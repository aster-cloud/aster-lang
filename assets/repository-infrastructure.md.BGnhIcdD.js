import{_ as o,c,o as a,aj as r}from"./chunks/framework.Bz2R-749.js";const m=JSON.parse('{"title":"仓库基础设施指南","description":"","frontmatter":{},"headers":[],"relativePath":"repository-infrastructure.md","filePath":"repository-infrastructure.md"}'),d={name:"repository-infrastructure.md"};function i(t,e,l,n,s,g){return a(),c("div",null,[...e[0]||(e[0]=[r('<h1 id="仓库基础设施指南" tabindex="-1">仓库基础设施指南 <a class="header-anchor" href="#仓库基础设施指南" aria-label="Permalink to “仓库基础设施指南”">​</a></h1><blockquote><p>更新时间：2025-11-25 09:15 NZST · 执行者：Codex</p></blockquote><p>本指南描述 Aster 语言代码库在 GitHub 组织、命名与版本策略、发布流水线、CI/CD 以及质量标准方面的约束，供所有贡献者与维护者统一遵循。</p><h2 id="github-组织结构" tabindex="-1">GitHub 组织结构 <a class="header-anchor" href="#github-组织结构" aria-label="Permalink to “GitHub 组织结构”">​</a></h2><ul><li><strong>组织与团队</strong>：源码托管在 <code>wontlost-ltd</code> 组织；按职责划分 <code>lang-core</code>、<code>cli-experience</code>、<code>infra-release</code> 与 <code>docs</code> 四个团队，分别负责语言核心、CLI/包管理、发布与平台工程，以及文档与站点维护。</li><li><strong>仓库分层</strong>：核心语言仓库 <code>aster-lang</code> 是单一真实来源，辅助仓库（如示例项目、官网）通过 GitHub Actions 的 <code>repository_dispatch</code> 与主仓库保持同步。</li><li><strong>权限模型</strong>：默认通过 <code>CODEOWNERS</code> 控制评审权限；主分支只允许 <code>lang-core</code> 与 <code>infra-release</code> 拥有写权限，其余团队以 PR 方式合并。</li><li><strong>议题标签</strong>：统一使用 <code>area/*</code>（模块）、<code>severity/*</code>（影响）、<code>status/*</code>（进度）三组标签，CI 会校验缺失标签的 PR，避免未分类议题进入主干。</li><li><strong>自动化配置</strong>：Dependabot、Release Drafter 与 branch protection 配置存放在 <code>.github/</code>，修改后需同步更新 <code>docs/repository-infrastructure.md</code> 并通知 <code>infra-release</code> 团队。</li></ul><h2 id="包命名策略" tabindex="-1">包命名策略 <a class="header-anchor" href="#包命名策略" aria-label="Permalink to “包命名策略”">​</a></h2><ul><li>所有可发布包遵循 <code>aster.&lt;domain&gt;.&lt;name&gt;</code> 形式（仅允许小写字母、数字和连字符），确保在 registry 与 CLI 中具备唯一性。</li><li>领域 <code>domain</code> 建议使用两级命名（如 <code>core.math</code>、<code>workflow.crm</code>），帮助读者快速识别功能范畴。</li><li>CLI 会在安装阶段验证命名规则与 <code>manifest.schema.json</code> 中的正则表达式，失败时以 <code>[M003] Invalid package name</code> 报错。</li><li>示例包与教程使用 <code>examples.&lt;topic&gt;</code> 命名，避免与正式包冲突；所有示例均应发布在 <code>.aster/local-registry</code> 中，便于离线验证。</li></ul><h2 id="版本管理" tabindex="-1">版本管理 <a class="header-anchor" href="#版本管理" aria-label="Permalink to “版本管理”">​</a></h2><ul><li><strong>SemVer 约定</strong>：使用 <code>MAJOR.MINOR.PATCH</code>，禁止附加 build metadata；breaking change 才能提升 MAJOR，新增功能但兼容时提升 MINOR，补丁或文档/构建更新使用 PATCH。</li><li><strong>高频分支</strong>：<code>main</code> 作为可发布分支，<code>release/x.y</code> 分支用于准备稳定版本；hotfix 基于最新稳定分支创建 <code>hotfix/x.y.z-*</code>，完成后先合并回 <code>release/x.y</code> 再回 <code>main</code>。</li><li><strong>标签策略</strong>：每次发布在 <code>main</code> 和相应 release 分支打 annotated tag（如 <code>v1.4.0</code>），并在 Release Drafter 中引用，方便 CLI 与 docs 对齐版本号。</li><li><strong>版本来源</strong>：包管理器、CLI 与示例 manifest 均从 <code>package.json</code> 的 <code>version</code> 字段读取版本。修改版本后须同步更新 <code>docs/guide/package-management/manifest-reference.md</code> 中的对照表。</li></ul><h2 id="发布流程" tabindex="-1">发布流程 <a class="header-anchor" href="#发布流程" aria-label="Permalink to “发布流程”">​</a></h2><ol><li>完成 P0/P1 缺陷修复并确认 CI 全绿。</li><li><code>infra-release</code> 团队创建/更新 <code>release/x.y</code>，同步 cherry-pick 计划进入版本的 PR，执行 <code>npm run build &amp;&amp; npm run test</code> 验证。</li><li>在 <code>release/x.y</code> 上更新版本号、变更日志与 docs 发布说明，确保 <code>docs/publishing-guide.md</code> 清单全部完成。</li><li>使用 Release Drafter 生成候选说明，人工校对后触发 <code>Release</code> workflow，生成 npm 包、GitHub Release 资产与 docs 静态站点。</li><li>将 release tag 合并回 <code>main</code>，保证两条分支的版本与文档一致。</li></ol><h2 id="ci-cd-管线" tabindex="-1">CI/CD 管线 <a class="header-anchor" href="#ci-cd-管线" aria-label="Permalink to “CI/CD 管线”">​</a></h2><ul><li><strong>Checks</strong>：主仓库在 PR 上运行 <code>npm run lint</code>, <code>npm run typecheck</code>, <code>npm test</code>, <code>npm run test:cli</code>, <code>npm run docs:build</code> 以及 JVM 子模块的 Gradle 测试。所有管线均要求在 20 分钟内完成，以便频繁提交。</li><li><strong>分布式缓存</strong>：Node 与 Gradle 构建使用 GitHub Actions cache + S3 artifact 组合，加速 PEG 生成、示例包 tarball 与 JVM class 输出。</li><li><strong>分支保护</strong>：<code>main</code> 与 <code>release/*</code> 分支启用「必须所有检查通过」及「至少一位代码所有者评审」策略，并禁止强推。</li><li><strong>部署目标</strong>：<code>docs:build</code> 产物自动部署到 Cloudflare Pages；<code>npm publish</code>、GitHub Release 与示例 registry 更新由 <code>infra-release</code> workflow 串联完成。</li></ul><h2 id="质量标准" tabindex="-1">质量标准 <a class="header-anchor" href="#质量标准" aria-label="Permalink to “质量标准”">​</a></h2><ul><li><strong>代码评审</strong>：所有代码均需两名 reviewer 批准，其中至少一位来自对应模块的代码所有者。</li><li><strong>测试覆盖</strong>：CLI 模块语句覆盖率需 ≥85%，核心编译链 golden 测试必须保持 100% 通过。任何下降必须在 PR 描述中注明原因。</li><li><strong>文档同步</strong>：功能合并前必须更新用户文档、教程与 release note；未同步的 PR 将在 <code>docs-sync</code> 检查中失败。</li><li><strong>运行基线</strong>：性能与内存基线由 <code>npm run bench</code> 与 JVM benchmark 提供，若回归超过 3% 必须先修复后才能发布。</li><li><strong>可观测性</strong>：新增包或 CLI 行为必须搭配日志/诊断输出，确保后续问题可复现；相关说明写入 <code>docs/guide/package-management/overview.md</code>。</li></ul>',15)])])}const u=o(d,[["render",i]]);export{m as __pageData,u as default};
