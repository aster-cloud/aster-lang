import{_ as i,c as a,o as e,aj as t}from"./chunks/framework.Bz2R-749.js";const o=JSON.parse('{"title":"包管理系统概述","description":"","frontmatter":{},"headers":[],"relativePath":"guide/package-management/overview.md","filePath":"guide/package-management/overview.md"}'),l={name:"guide/package-management/overview.md"};function n(h,s,k,p,r,d){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="包管理系统概述" tabindex="-1">包管理系统概述 <a class="header-anchor" href="#包管理系统概述" aria-label="Permalink to “包管理系统概述”">​</a></h1><blockquote><p>更新：2025-11-25 09:46 NZST · Codex</p></blockquote><p>本节概览 Aster 包管理系统的核心组件、依赖解析算法、缓存策略以及与 GitHub Releases 的集成方式，帮助你评估在团队与 CI 中的部署可行性。</p><h2 id="架构" tabindex="-1">架构 <a class="header-anchor" href="#架构" aria-label="Permalink to “架构”">​</a></h2><p>包管理系统由四个层次组成：</p><ol><li><strong>CLI 命令层</strong>：<code>aster pkg &lt;command&gt;</code> 负责解析 CLI 参数并调度具体动作。</li><li><strong>解析器 (Resolver)</strong>：根据 <code>manifest.json</code> 与 <code>aster.lock</code> 计算依赖图，执行 SemVer 匹配与冲突回溯。</li><li><strong>存储层</strong>：包含全局缓存 (<code>~/.aster/cache</code>) 与项目本地链接目录 (<code>.aster/modules</code>)。</li><li><strong>分发适配器</strong>：目前内置 GitHub Releases 适配器，未来可扩展 OCI/自建源。</li></ol><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> aster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pkg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolver</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Resolution</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  package</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  checksum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolutions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Resolution</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  for</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> res</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resolutions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>在 CI 中运行包命令时，可通过 <code>ASTER_CACHE_DIR=$CI_PROJECT/.cache/aster</code> 将缓存放在可复用的工作目录，配合 <code>npm ci</code> 达到完全可复现构建。</p></div><h2 id="依赖解析-semver-与回溯" tabindex="-1">依赖解析：SemVer 与回溯 <a class="header-anchor" href="#依赖解析-semver-与回溯" aria-label="Permalink to “依赖解析：SemVer 与回溯”">​</a></h2><p>解析器会按以下顺序探索解：</p><ol><li>针对 <code>dependencies</code> 中的每个条目，优先尝试 <code>aster.lock</code> 中已存在的版本，保持稳定性。</li><li>若锁文件缺少条目，则在满足 SemVer 的范围内，从最高可用版本开始向下搜索。</li><li>出现冲突时，解析器会回溯到最近决策点，尝试次优版本；若全部失败则提示无法满足的约束链。</li></ol><p>使用 <code>--explain</code> 可以查看详细的解析过程：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --explain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wontlost/http@^1.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wontlost/serde@~2.0</span></span></code></pre></div><p>示例输出：</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Resolving wontlost/http@^1.5 -&gt; 1.6.2</span></span>
<span class="line"><span>Resolving wontlost/serde@~2.0 -&gt; 2.0.5</span></span>
<span class="line"><span>Conflict detected: serde 2.0.5 requires http &gt;=1.7</span></span>
<span class="line"><span>↺ backtracking http -&gt; 1.7.0</span></span>
<span class="line"><span>✓ solution found (2 packages, depth=3)</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>当 <code>manifest.json</code> 同时声明 Git 引用与 SemVer 范围时，解析器会优先取 Git commit，这可能绕过锁文件。生产环境请保持单一来源并在审查中确认。</p></div><h2 id="缓存与链接策略" tabindex="-1">缓存与链接策略 <a class="header-anchor" href="#缓存与链接策略" aria-label="Permalink to “缓存与链接策略”">​</a></h2><ul><li><strong>全局缓存</strong>：按照 <code>&lt;registry&gt;/&lt;package&gt;/&lt;version&gt;/package.tgz</code> 结构存放，下载完成后立即写入 SHA-256 校验。</li><li><strong>项目链接</strong>：解析完成后将包展开到 <code>.aster/modules/&lt;package&gt;</code>，并在 <code>node_modules/.aster</code> 写入 shim 以供工具链发现。</li><li><strong>清理命令</strong>：<code>aster pkg cache prune --days 30</code> 会删除 30 天未访问的缓存条目。</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prune</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --days</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --summary</span></span></code></pre></div><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Pruned 12 entries (3.2 GB) from /Users/dev/.aster/cache</span></span>
<span class="line"><span>Active packages: 8</span></span></code></pre></div><h2 id="github-releases-集成" tabindex="-1">GitHub Releases 集成 <a class="header-anchor" href="#github-releases-集成" aria-label="Permalink to “GitHub Releases 集成”">​</a></h2><p>默认 registry 会使用 GitHub Releases API：</p><ol><li>解析器读取包元数据，定位 <code>owner/repo</code> 与期望标签。</li><li>下载命名为 <code>aster-package.tgz</code> 的 Release 资产。</li><li>校验 <code>manifest.json</code> 中 <code>checksum</code> 字段（如存在）。</li></ol><p>可以通过 CLI 强制刷新 release：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wontlost/http</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> github</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.6.2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --force-refresh</span></span></code></pre></div><p>在企业私有仓库中，只需设置 <code>GITHUB_TOKEN</code>，包管理器会使用该 token 访问受保护的 Release 资产。这种设计让包的分发管道与现有发布流程复用 GitHub 安全模型，无需额外的私有 registry 维护成本。</p>`,26)])])}const c=i(l,[["render",n]]);export{o as __pageData,c as default};
