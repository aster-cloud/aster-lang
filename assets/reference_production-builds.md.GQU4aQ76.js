import{_ as i,c as a,o as e,aj as n}from"./chunks/framework.Bz2R-749.js";const g=JSON.parse('{"title":"Production Build Pipeline","description":"","frontmatter":{},"headers":[],"relativePath":"reference/production-builds.md","filePath":"reference/production-builds.md"}'),l={name:"reference/production-builds.md"};function t(h,s,p,r,k,d){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="production-build-pipeline" tabindex="-1">Production Build Pipeline <a class="header-anchor" href="#production-build-pipeline" aria-label="Permalink to â€œProduction Build Pipelineâ€">â€‹</a></h1><p><strong>çŠ¶æ€</strong>: âœ… å·²å®ç° (Phase 0, Priority 2) <strong>ç‰ˆæœ¬</strong>: 0.2.0 <strong>æœ€åæ›´æ–°</strong>: 2025-10-10</p><hr><h2 id="æ¦‚è¿°" tabindex="-1">æ¦‚è¿° <a class="header-anchor" href="#æ¦‚è¿°" aria-label="Permalink to â€œæ¦‚è¿°â€">â€‹</a></h2><p>Aster Lang æä¾›å®Œæ•´çš„ç”Ÿäº§çº§æ„å»ºæµæ°´çº¿ï¼ŒåŒ…æ‹¬ï¼š</p><ol><li><strong>GraalVM Native-Image</strong> - ç¼–è¯‘ä¸ºåŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶</li><li><strong>Docker è¿è¡Œæ—¶</strong> - å®¹å™¨åŒ–éƒ¨ç½²</li><li><strong>ç¡®å®šæ€§æ„å»º</strong> - å¯é‡ç°çš„æ„å»ºäº§ç‰©</li><li><strong>CI/CD è‡ªåŠ¨åŒ–</strong> - GitHub Actions é›†æˆ</li></ol><hr><h2 id="ğŸš€-å¿«é€Ÿå¼€å§‹" tabindex="-1">ğŸš€ å¿«é€Ÿå¼€å§‹ <a class="header-anchor" href="#ğŸš€-å¿«é€Ÿå¼€å§‹" aria-label="Permalink to â€œğŸš€ å¿«é€Ÿå¼€å§‹â€">â€‹</a></h2><h3 id="æ„å»º-native-image" tabindex="-1">æ„å»º Native Image <a class="header-anchor" href="#æ„å»º-native-image" aria-label="Permalink to â€œæ„å»º Native Imageâ€">â€‹</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®Œæ•´æ„å»ºï¼ˆåŒ…å«æµ‹è¯•ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native:build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¿«é€Ÿæ„å»ºï¼ˆè·³è¿‡æµ‹è¯•ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native:build:quick</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éªŒæ”¶æµ‹è¯•ï¼ˆå¤§å°ã€å¯åŠ¨æ—¶é—´ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native:acceptance</span></span></code></pre></div><h3 id="docker-éƒ¨ç½²" tabindex="-1">Docker éƒ¨ç½² <a class="header-anchor" href="#docker-éƒ¨ç½²" aria-label="Permalink to â€œDocker éƒ¨ç½²â€">â€‹</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»º Docker é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker:build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿è¡Œå®¹å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker:run</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨å®Œæ•´å¼€å‘ç¯å¢ƒï¼ˆåŒ…æ‹¬ PostgreSQLã€Redisï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker:compose:up</span></span></code></pre></div><hr><h2 id="ğŸ“¦-native-image-æ„å»º" tabindex="-1">ğŸ“¦ Native Image æ„å»º <a class="header-anchor" href="#ğŸ“¦-native-image-æ„å»º" aria-label="Permalink to â€œğŸ“¦ Native Image æ„å»ºâ€">â€‹</a></h2><h3 id="ç³»ç»Ÿè¦æ±‚" tabindex="-1">ç³»ç»Ÿè¦æ±‚ <a class="header-anchor" href="#ç³»ç»Ÿè¦æ±‚" aria-label="Permalink to â€œç³»ç»Ÿè¦æ±‚â€">â€‹</a></h3><ul><li><strong>GraalVM JDK 21</strong> with native-image installed</li><li><strong>Node.js 20+</strong> (ç”¨äº TypeScript ç¼–è¯‘)</li><li><strong>macOS</strong>: Xcode toolchain (è¿è¡Œ <code>sudo xcodebuild -license</code>)</li><li><strong>Linux</strong>: GCC å·¥å…·é“¾</li><li><strong>Windows</strong>: Visual Studio 2022 (å¯é€‰)</li></ul><h3 id="æ„å»ºé…ç½®" tabindex="-1">æ„å»ºé…ç½® <a class="header-anchor" href="#æ„å»ºé…ç½®" aria-label="Permalink to â€œæ„å»ºé…ç½®â€">â€‹</a></h3><p>Native Image é…ç½®ä½äº <code>aster-lang-cli/build.gradle.kts</code>:</p><div class="language-kotlin"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">graalvmNative</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  binaries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    named</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      imageName.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;aster&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      buildArgs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;--no-fallback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç¦ç”¨ JVM fallback</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;-O3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æœ€é«˜ä¼˜åŒ–çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;--gc=G1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// G1 åƒåœ¾å›æ”¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;-march=native&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// CPU æ¶æ„ä¼˜åŒ–</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;-H:+RemoveUnusedSymbols&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç§»é™¤æœªä½¿ç”¨ç¬¦å·</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;-H:+UseCompressedReferences&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å‹ç¼©æŒ‡é’ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="éªŒæ”¶æ ‡å‡†" tabindex="-1">éªŒæ”¶æ ‡å‡† <a class="header-anchor" href="#éªŒæ”¶æ ‡å‡†" aria-label="Permalink to â€œéªŒæ”¶æ ‡å‡†â€">â€‹</a></h3><p>âœ… <strong>äºŒè¿›åˆ¶å¤§å°</strong> &lt; 50MB âœ… <strong>å¯åŠ¨æ—¶é—´</strong> &lt; 100ms âœ… <strong>åŠŸèƒ½å®Œæ•´æ€§</strong> æ”¯æŒ compileã€typecheck å‘½ä»¤</p><p>éªŒè¯è„šæœ¬:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ£€æŸ¥äºŒè¿›åˆ¶å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native:check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆ10æ¬¡è¿­ä»£ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native:benchmark</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»¼åˆéªŒæ”¶æµ‹è¯•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native:acceptance</span></span></code></pre></div><hr><h2 id="ğŸ³-docker-éƒ¨ç½²" tabindex="-1">ğŸ³ Docker éƒ¨ç½² <a class="header-anchor" href="#ğŸ³-docker-éƒ¨ç½²" aria-label="Permalink to â€œğŸ³ Docker éƒ¨ç½²â€">â€‹</a></h2><h3 id="é•œåƒæ¶æ„" tabindex="-1">é•œåƒæ¶æ„ <a class="header-anchor" href="#é•œåƒæ¶æ„" aria-label="Permalink to â€œé•œåƒæ¶æ„â€">â€‹</a></h3><p>é‡‡ç”¨<strong>å¤šé˜¶æ®µæ„å»º</strong>ä¼˜åŒ–é•œåƒå¤§å°ï¼š</p><ol><li><strong>Builder Stage</strong> - ç¼–è¯‘ TypeScript + æ„å»º Native Image</li><li><strong>Runtime Stage</strong> - æœ€å°åŒ–è¿è¡Œæ—¶ç¯å¢ƒ</li></ol><p>æœ€ç»ˆé•œåƒåŸºäº <code>quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21</code>ã€‚</p><h3 id="docker-compose-ç¯å¢ƒ" tabindex="-1">Docker Compose ç¯å¢ƒ <a class="header-anchor" href="#docker-compose-ç¯å¢ƒ" aria-label="Permalink to â€œDocker Compose ç¯å¢ƒâ€">â€‹</a></h3><p>å®Œæ•´å¼€å‘ç¯å¢ƒåŒ…å«:</p><ul><li><strong>aster-runtime</strong> - Aster è¯­è¨€è¿è¡Œæ—¶</li><li><strong>postgres</strong> - PostgreSQL 16 (workflow çŠ¶æ€æŒä¹…åŒ–)</li><li><strong>redis</strong> - Redis 7 (ç¼“å­˜ + ä»»åŠ¡é˜Ÿåˆ—)</li><li><strong>prometheus</strong> (å¯é€‰) - ç›‘æ§æŒ‡æ ‡æ”¶é›†</li><li><strong>grafana</strong> (å¯é€‰) - å¯è§†åŒ–ä»ªè¡¨ç›˜</li></ul><p>å¯åŠ¨ç¯å¢ƒ:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨æ ¸å¿ƒæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨åŒ…å«ç›‘æ§çš„å®Œæ•´ç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --profile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker:compose:logs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœæ­¢ç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker:compose:down</span></span></code></pre></div><h3 id="ç¯å¢ƒå˜é‡" tabindex="-1">ç¯å¢ƒå˜é‡ <a class="header-anchor" href="#ç¯å¢ƒå˜é‡" aria-label="Permalink to â€œç¯å¢ƒå˜é‡â€">â€‹</a></h3><table tabindex="0"><thead><tr><th>å˜é‡</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ASTER_ENV</code></td><td><code>development</code></td><td>ç¯å¢ƒæ¨¡å¼ (development/production)</td></tr><tr><td><code>ASTER_LOG_LEVEL</code></td><td><code>info</code></td><td>æ—¥å¿—çº§åˆ« (debug/info/warn/error)</td></tr><tr><td><code>POSTGRES_DB</code></td><td><code>aster</code></td><td>æ•°æ®åº“åç§°</td></tr><tr><td><code>POSTGRES_USER</code></td><td><code>aster</code></td><td>æ•°æ®åº“ç”¨æˆ·</td></tr><tr><td><code>POSTGRES_PASSWORD</code></td><td><code>aster_dev_password</code></td><td>æ•°æ®åº“å¯†ç </td></tr></tbody></table><hr><h2 id="ğŸ”’-ç¡®å®šæ€§æ„å»º" tabindex="-1">ğŸ”’ ç¡®å®šæ€§æ„å»º <a class="header-anchor" href="#ğŸ”’-ç¡®å®šæ€§æ„å»º" aria-label="Permalink to â€œğŸ”’ ç¡®å®šæ€§æ„å»ºâ€">â€‹</a></h2><h3 id="åŸç†" tabindex="-1">åŸç† <a class="header-anchor" href="#åŸç†" aria-label="Permalink to â€œåŸç†â€">â€‹</a></h3><p>ç¡®å®šæ€§æ„å»ºç¡®ä¿<strong>ç›¸åŒè¾“å…¥ â†’ ç›¸åŒè¾“å‡º</strong>ï¼š</p><ul><li>å›ºå®šæ—¶é—´æˆ³ (<code>isPreserveFileTimestamps = false</code>)</li><li>å›ºå®šæ–‡ä»¶é¡ºåº (<code>isReproducibleFileOrder = true</code>)</li><li>å›ºå®šæ–‡ä»¶æƒé™ (<code>fileMode = 0644, dirMode = 0755</code>)</li><li>ç¦ç”¨å¢é‡ç¼–è¯‘ (<code>options.isIncremental = false</code>)</li></ul><h3 id="å¯ç”¨æ„å»ºç¼“å­˜" tabindex="-1">å¯ç”¨æ„å»ºç¼“å­˜ <a class="header-anchor" href="#å¯ç”¨æ„å»ºç¼“å­˜" aria-label="Permalink to â€œå¯ç”¨æ„å»ºç¼“å­˜â€">â€‹</a></h3><p>æœ¬åœ°ç¼“å­˜ï¼ˆé»˜è®¤å¯ç”¨ï¼‰:</p><div class="language-kotlin"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    directory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${rootProject.projectDir}/.gradle/build-cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    removeUnusedEntriesAfterDays </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿œç¨‹ç¼“å­˜ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰:</p><div class="language-kotlin"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpBuildCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uri</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://build-cache.example.com/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  isEnabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getenv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CI&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  isPush </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getenv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CI_BRANCH&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;main&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="éªŒè¯å¯é‡ç°æ€§" tabindex="-1">éªŒè¯å¯é‡ç°æ€§ <a class="header-anchor" href="#éªŒè¯å¯é‡ç°æ€§" aria-label="Permalink to â€œéªŒè¯å¯é‡ç°æ€§â€">â€‹</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¬¬ä¸€æ¬¡æ„å»º</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native:build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shasum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 256</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aster-lang-cli/build/native/nativeCompile/aster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checksum1.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¸…ç† + ç¬¬äºŒæ¬¡æ„å»º</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> native:build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shasum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 256</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aster-lang-cli/build/native/nativeCompile/aster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checksum2.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¯”è¾ƒæ ¡éªŒå’Œï¼ˆåº”è¯¥ç›¸åŒï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">diff</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checksum1.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checksum2.txt</span></span></code></pre></div><hr><h2 id="ğŸ¤–-ci-cd-è‡ªåŠ¨åŒ–" tabindex="-1">ğŸ¤– CI/CD è‡ªåŠ¨åŒ– <a class="header-anchor" href="#ğŸ¤–-ci-cd-è‡ªåŠ¨åŒ–" aria-label="Permalink to â€œğŸ¤– CI/CD è‡ªåŠ¨åŒ–â€">â€‹</a></h2><h3 id="github-actions-workflow" tabindex="-1">GitHub Actions Workflow <a class="header-anchor" href="#github-actions-workflow" aria-label="Permalink to â€œGitHub Actions Workflowâ€">â€‹</a></h3><p><code>.github/workflows/build-native.yml</code> è‡ªåŠ¨æ‰§è¡Œï¼š</p><ol><li><strong>æ„å»º Native Image</strong> (Ubuntu + macOS)</li><li><strong>å¤§å°å’Œæ€§èƒ½æ£€æŸ¥</strong></li><li><strong>æ„å»º Docker é•œåƒ</strong></li><li><strong>éªŒæ”¶æµ‹è¯•</strong></li><li><strong>å‘å¸ƒ artifacts</strong> (on tag push)</li></ol><h3 id="è§¦å‘æ¡ä»¶" tabindex="-1">è§¦å‘æ¡ä»¶ <a class="header-anchor" href="#è§¦å‘æ¡ä»¶" aria-label="Permalink to â€œè§¦å‘æ¡ä»¶â€">â€‹</a></h3><ul><li><code>push</code> to <code>main</code>, <code>develop</code>, <code>release/**</code></li><li><code>pull_request</code> to <code>main</code></li><li>æ‰‹åŠ¨è§¦å‘ (<code>workflow_dispatch</code>)</li></ul><h3 id="artifacts" tabindex="-1">Artifacts <a class="header-anchor" href="#artifacts" aria-label="Permalink to â€œArtifactsâ€">â€‹</a></h3><p>æ¯æ¬¡æ„å»ºäº§ç”Ÿ:</p><ul><li><code>aster-native-ubuntu-latest</code> - Linux åŸç”ŸäºŒè¿›åˆ¶</li><li><code>aster-native-macos-latest</code> - macOS åŸç”ŸäºŒè¿›åˆ¶</li><li>Docker é•œåƒ - <code>ghcr.io/wontlost-ltd/aster-lang:{tag}</code></li></ul><p>ä¿ç•™æœŸï¼š30å¤©</p><h3 id="release-æµç¨‹" tabindex="-1">Release æµç¨‹ <a class="header-anchor" href="#release-æµç¨‹" aria-label="Permalink to â€œRelease æµç¨‹â€">â€‹</a></h3><p>åˆ›å»º tag è‡ªåŠ¨å‘å¸ƒ:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v0.2.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Release v0.2.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v0.2.0</span></span></code></pre></div><p>GitHub Release è‡ªåŠ¨åˆ›å»ºï¼Œé™„å¸¦:</p><ul><li>åŸç”ŸäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆLinux + macOSï¼‰</li><li>Docker é•œåƒ</li><li>Release notes</li></ul><hr><h2 id="ğŸ“Š-æ€§èƒ½ä¼˜åŒ–" tabindex="-1">ğŸ“Š æ€§èƒ½ä¼˜åŒ– <a class="header-anchor" href="#ğŸ“Š-æ€§èƒ½ä¼˜åŒ–" aria-label="Permalink to â€œğŸ“Š æ€§èƒ½ä¼˜åŒ–â€">â€‹</a></h2><h3 id="native-image-ä¼˜åŒ–é€‰é¡¹" tabindex="-1">Native Image ä¼˜åŒ–é€‰é¡¹ <a class="header-anchor" href="#native-image-ä¼˜åŒ–é€‰é¡¹" aria-label="Permalink to â€œNative Image ä¼˜åŒ–é€‰é¡¹â€">â€‹</a></h3><table tabindex="0"><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><code>-O3</code></td><td>æœ€é«˜ä¼˜åŒ–çº§åˆ«</td><td>æ›´å¿«æ‰§è¡Œé€Ÿåº¦ï¼Œç¨æ…¢ç¼–è¯‘</td></tr><tr><td><code>-march=native</code></td><td>CPU æ¶æ„ä¼˜åŒ–</td><td>åˆ©ç”¨ SIMD ç­‰æŒ‡ä»¤</td></tr><tr><td><code>-H:+RemoveUnusedSymbols</code></td><td>ç§»é™¤æœªä½¿ç”¨ç¬¦å·</td><td>å‡å°äºŒè¿›åˆ¶å¤§å°</td></tr><tr><td><code>-H:+UseCompressedReferences</code></td><td>å‹ç¼©æŒ‡é’ˆ</td><td>å‡å°‘å†…å­˜å ç”¨</td></tr><tr><td><code>--initialize-at-build-time</code></td><td>æ„å»ºæ—¶åˆå§‹åŒ–</td><td>æ›´å¿«å¯åŠ¨æ—¶é—´</td></tr><tr><td><code>--gc=G1</code></td><td>G1 åƒåœ¾å›æ”¶å™¨</td><td>å¹³è¡¡ååé‡å’Œå»¶è¿Ÿ</td></tr></tbody></table><h3 id="pgo-profile-guided-optimization" tabindex="-1">PGO (Profile-Guided Optimization) <a class="header-anchor" href="#pgo-profile-guided-optimization" aria-label="Permalink to â€œPGO (Profile-Guided Optimization)â€">â€‹</a></h3><p>æœªæ¥ä¼˜åŒ–ï¼ˆPhase 1ï¼‰:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. æ„å»ºå¸¦ instrumentation çš„äºŒè¿›åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-lang-cli:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -Pgraalvm.native.extra-args=--pgo-instrument</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. è¿è¡Œä»£è¡¨æ€§å·¥ä½œè´Ÿè½½ï¼Œç”Ÿæˆ profile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-lang-cli/build/native/nativeCompile/aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> workload.aster</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. ä½¿ç”¨ profile é‡æ–°æ„å»º</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-lang-cli:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -Pgraalvm.native.extra-args=--pgo=default.iprof</span></span></code></pre></div><hr><h2 id="ğŸ›-æ•…éšœæ’æŸ¥" tabindex="-1">ğŸ› æ•…éšœæ’æŸ¥ <a class="header-anchor" href="#ğŸ›-æ•…éšœæ’æŸ¥" aria-label="Permalink to â€œğŸ› æ•…éšœæ’æŸ¥â€">â€‹</a></h2><h3 id="å¸¸è§é—®é¢˜" tabindex="-1">å¸¸è§é—®é¢˜ <a class="header-anchor" href="#å¸¸è§é—®é¢˜" aria-label="Permalink to â€œå¸¸è§é—®é¢˜â€">â€‹</a></h3><p><strong>1. Native Image æ„å»ºå¤±è´¥</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Error: Image building request failed with exit status 1</span></span></code></pre></div><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ul><li>ç¡®è®¤ GraalVM ç‰ˆæœ¬ (éœ€è¦ 21+)</li><li>æ£€æŸ¥ <code>native-image</code> æ˜¯å¦å·²å®‰è£…: <code>gu install native-image</code></li><li>macOS: ç¡®è®¤ Xcode license: <code>sudo xcodebuild -license accept</code></li></ul><p><strong>2. Docker æ„å»ºå¤±è´¥ (æ— æ³•æ‹‰å–åŸºç¡€é•œåƒ)</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Error: failed to resolve source metadata for ghcr.io/graalvm/native-image:21</span></span></code></pre></div><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ul><li>ç¡®è®¤ç½‘ç»œè¿æ¥</li><li>ä½¿ç”¨é•œåƒåŠ é€Ÿå™¨</li><li>æ‰‹åŠ¨æ‹‰å–åŸºç¡€é•œåƒ: <code>docker pull ghcr.io/graalvm/native-image:21</code></li></ul><p><strong>3. äºŒè¿›åˆ¶å¤§å°è¶…é™</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Binary size 65.23 MB exceeds limit of 50.00 MB</span></span></code></pre></div><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ul><li>å¯ç”¨æ›´å¤šä¼˜åŒ–é€‰é¡¹</li><li>ç§»é™¤æœªä½¿ç”¨çš„ä¾èµ–</li><li>ä½¿ç”¨ <code>--no-fallback</code> å’Œ <code>-H:+RemoveUnusedSymbols</code></li><li>è€ƒè™‘åŠ¨æ€é“¾æ¥: <code>-H:-StaticExecutableWithDynamicLibC</code></li></ul><p><strong>4. å¯åŠ¨æ—¶é—´è¶…é™</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Average startup time: 156ms exceeds 100ms limit</span></span></code></pre></div><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ul><li>å¢åŠ  <code>--initialize-at-build-time</code> èŒƒå›´</li><li>ä½¿ç”¨ PGO ä¼˜åŒ–</li><li>æ£€æŸ¥è¿è¡Œç¯å¢ƒï¼ˆç£ç›˜ I/Oã€CPU æ€§èƒ½ï¼‰</li></ul><hr><h2 id="ğŸ“š-å‚è€ƒèµ„æ–™" tabindex="-1">ğŸ“š å‚è€ƒèµ„æ–™ <a class="header-anchor" href="#ğŸ“š-å‚è€ƒèµ„æ–™" aria-label="Permalink to â€œğŸ“š å‚è€ƒèµ„æ–™â€">â€‹</a></h2><ul><li><a href="https://www.graalvm.org/latest/reference-manual/native-image/" target="_blank" rel="noreferrer">GraalVM Native Image æ–‡æ¡£</a></li><li><a href="https://docs.gradle.org/current/userguide/build_cache.html" target="_blank" rel="noreferrer">Gradle Build Cache</a></li><li><a href="https://reproducible-builds.org/" target="_blank" rel="noreferrer">Reproducible Builds</a></li><li><a href="https://docs.docker.com/build/building/multi-stage/" target="_blank" rel="noreferrer">Docker Multi-Stage Builds</a></li><li><a href="https://docs.github.com/en/actions" target="_blank" rel="noreferrer">GitHub Actions</a></li></ul><hr><h2 id="ğŸ—ºï¸-roadmap" tabindex="-1">ğŸ—ºï¸ Roadmap <a class="header-anchor" href="#ğŸ—ºï¸-roadmap" aria-label="Permalink to â€œğŸ—ºï¸ Roadmapâ€">â€‹</a></h2><ul><li>[x] Phase 0: Native Image åŸºç¡€æ”¯æŒ (v0.2.0)</li><li>[x] Phase 0: Docker è¿è¡Œæ—¶ (v0.2.0)</li><li>[x] Phase 0: ç¡®å®šæ€§æ„å»º (v0.2.0)</li><li>[x] Phase 0: GitHub Actions CI (v0.2.0)</li><li>[ ] Phase 1: PGO ä¼˜åŒ– (v0.3.0)</li><li>[ ] Phase 1: å¤šå¹³å°æ”¯æŒ (Windows, ARM64) (v0.3.0)</li><li>[ ] Phase 1: äº‘åŸç”Ÿéƒ¨ç½² (Kubernetes) (v0.4.0)</li><li>[ ] Phase 2: åˆ†å¸ƒå¼æ„å»ºç¼“å­˜ (v0.5.0)</li></ul><hr><p><strong>æœ€åæ›´æ–°</strong>: 2025-10-10 <strong>ç»´æŠ¤è€…</strong>: Aster Language Team</p>`,98)])])}const c=i(l,[["render",t]]);export{g as __pageData,c as default};
