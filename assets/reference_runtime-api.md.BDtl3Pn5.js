import{_ as i,c as a,o as n,aj as t}from"./chunks/framework.Bz2R-749.js";const o=JSON.parse('{"title":"Runtime API 参考手册","description":"","frontmatter":{},"headers":[],"relativePath":"reference/runtime-api.md","filePath":"reference/runtime-api.md"}'),l={name:"reference/runtime-api.md"};function h(e,s,k,p,r,d){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="runtime-api-参考手册" tabindex="-1">Runtime API 参考手册 <a class="header-anchor" href="#runtime-api-参考手册" aria-label="Permalink to “Runtime API 参考手册”">​</a></h1><p><strong>版本</strong>: 0.2.0 <strong>状态</strong>: 草案 (Draft) <strong>最后更新</strong>: 2025-11-08 18:15 NZDT <strong>维护者</strong>: Claude Code</p><hr><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p>Aster Runtime API 文档化 Truffle 运行时和 JVM 互操作的关键特性。本文档面向需要以下能力的开发者：</p><ul><li>调用 Java 标准库或第三方库</li><li>配置 Truffle 运行时参数</li><li>理解 Native Image 与 JVM 模式的差异</li><li>优化生产部署的性能和内存占用</li></ul><hr><h2 id="_1-truffle-运行时" tabindex="-1">1. Truffle 运行时 <a class="header-anchor" href="#_1-truffle-运行时" aria-label="Permalink to “1. Truffle 运行时”">​</a></h2><h3 id="_1-1-cli-参数" tabindex="-1">1.1 CLI 参数 <a class="header-anchor" href="#_1-1-cli-参数" aria-label="Permalink to “1.1 CLI 参数”">​</a></h3><h4 id="基础用法" tabindex="-1">基础用法 <a class="header-anchor" href="#基础用法" aria-label="Permalink to “基础用法”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># JVM 模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/install/aster-truffle/bin/aster-truffle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core-ir-fil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [options]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Native Image 模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core-ir-fil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [options]</span></span></code></pre></div><h4 id="可用参数" tabindex="-1">可用参数 <a class="header-anchor" href="#可用参数" aria-label="Permalink to “可用参数”">​</a></h4><table tabindex="0"><thead><tr><th>参数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>--func=&lt;name&gt;</code></td><td>指定要执行的函数名</td><td><code>--func=fibonacci</code></td></tr><tr><td><code>-- &lt;args&gt;</code></td><td>传递函数参数（双破折号后）</td><td><code>-- 10 &quot;hello&quot;</code></td></tr><tr><td><code>--cpusampler</code></td><td>启用 CPU 性能分析</td><td><code>--cpusampler</code></td></tr><tr><td><code>--memtracer</code></td><td>启用内存追踪</td><td><code>--memtracer</code></td></tr><tr><td><code>--experimental-options</code></td><td>启用实验性选项</td><td>与下方选项配合使用</td></tr><tr><td><code>--engine.TraceCompilation</code></td><td>追踪 JIT 编译</td><td><code>--experimental-options --engine.TraceCompilation</code></td></tr></tbody></table><h4 id="完整示例" tabindex="-1">完整示例 <a class="header-anchor" href="#完整示例" aria-label="Permalink to “完整示例”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行 Fibonacci 函数，传递参数 10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/fibonacci_20_core.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --func=fibonacci</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出: 6765</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用性能分析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/quicksort_core.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpusampler</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --memtracer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 追踪 JIT 编译</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/list_map_1000_core.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --experimental-options</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --engine.TraceCompilation</span></span></code></pre></div><hr><h3 id="_1-2-环境变量" tabindex="-1">1.2 环境变量 <a class="header-anchor" href="#_1-2-环境变量" aria-label="Permalink to “1.2 环境变量”">​</a></h3><table tabindex="0"><thead><tr><th>变量名</th><th>说明</th><th>默认值</th><th>示例</th></tr></thead><tbody><tr><td><code>JAVA_OPTS</code></td><td>传递给 JVM 的选项</td><td>-</td><td><code>JAVA_OPTS=&quot;-Xmx2G -Xms512M&quot;</code></td></tr><tr><td><code>ASTER_TRUFFLE_PROFILE</code></td><td>配置文件路径</td><td>-</td><td><code>ASTER_TRUFFLE_PROFILE=prod.conf</code></td></tr><tr><td><code>GRAAL_SDK_JAR_PATH</code></td><td>GraalVM SDK JAR 路径</td><td>自动检测</td><td>高级用例</td></tr></tbody></table><h4 id="内存配置示例" tabindex="-1">内存配置示例 <a class="header-anchor" href="#内存配置示例" aria-label="Permalink to “内存配置示例”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置最大堆内存为 2GB</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JAVA_OPTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-Xmx2G -Xms512M&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/install/aster-truffle/bin/aster-truffle</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  benchmarks/core/large_dataset_core.json</span></span></code></pre></div><hr><h3 id="_1-3-性能分析选项" tabindex="-1">1.3 性能分析选项 <a class="header-anchor" href="#_1-3-性能分析选项" aria-label="Permalink to “1.3 性能分析选项”">​</a></h3><h4 id="cpu-sampler" tabindex="-1">CPU Sampler <a class="header-anchor" href="#cpu-sampler" aria-label="Permalink to “CPU Sampler”">​</a></h4><p>启用 CPU 采样器查看热点函数：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/quicksort_core.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpusampler</span></span></code></pre></div><p><strong>输出示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span>Sampling Histogram. Recorded 456 samples with period 10ms.</span></span>
<span class="line"><span>  Self Time: Time spent in the function itself.</span></span>
<span class="line"><span>  Total Time: Time spent in the function and its callees.</span></span>
<span class="line"><span>-------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span> Name                              ||             Total Time    |   Self Time   ||</span></span>
<span class="line"><span>-------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span> quicksort                         ||             3150ms  69.0% |  1890ms  41.5% ||</span></span>
<span class="line"><span> partition                         ||             1260ms  27.6% |   840ms  18.4% ||</span></span>
<span class="line"><span> swap                              ||              420ms   9.2% |   420ms   9.2% ||</span></span></code></pre></div><h4 id="memory-tracer" tabindex="-1">Memory Tracer <a class="header-anchor" href="#memory-tracer" aria-label="Permalink to “Memory Tracer”">​</a></h4><p>追踪内存分配：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/list_operations_core.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --memtracer</span></span></code></pre></div><p><strong>输出示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span>Memory Tracer. Total allocations: 5.2 MB</span></span>
<span class="line"><span>-------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span> Type                              ||             Count  |   Size (MB)   ||</span></span>
<span class="line"><span>-------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span> List                              ||            12,456  |        3.8 MB ||</span></span>
<span class="line"><span> Text                              ||             3,210  |        1.2 MB ||</span></span>
<span class="line"><span> Map                               ||               842  |        0.2 MB ||</span></span></code></pre></div><hr><h3 id="_1-4-truffle-编译阈值调整" tabindex="-1">1.4 Truffle 编译阈值调整 <a class="header-anchor" href="#_1-4-truffle-编译阈值调整" aria-label="Permalink to “1.4 Truffle 编译阈值调整”">​</a></h3><p>控制 JIT 编译的触发条件：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 降低编译阈值，更早触发 JIT（适合短期运行的基准测试）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmarks/core/fibonacci_20_core.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --experimental-options</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --engine.CompileImmediately</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --engine.BackgroundCompilation=false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 增加编译阈值，适合长期运行的服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> long_running_service_core.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --experimental-options</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --engine.CompilationThreshold=10000</span></span></code></pre></div><hr><h2 id="_2-jvm-互操作" tabindex="-1">2. JVM 互操作 <a class="header-anchor" href="#_2-jvm-互操作" aria-label="Permalink to “2. JVM 互操作”">​</a></h2><h3 id="_2-1-调用-java-标准库" tabindex="-1">2.1 调用 Java 标准库 <a class="header-anchor" href="#_2-1-调用-java-标准库" aria-label="Permalink to “2.1 调用 Java 标准库”">​</a></h3><p>Aster 通过 Truffle Interop 机制与 Java 无缝集成。</p><h4 id="示例-1-使用-java-time-localdate" tabindex="-1">示例 1：使用 java.time.LocalDate <a class="header-anchor" href="#示例-1-使用-java-time-localdate" aria-label="Permalink to “示例 1：使用 java.time.LocalDate”">​</a></h4><p><strong>Aster 代码</strong>：</p><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> is</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> datetime_example</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">To</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> currentDate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">produce</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LocalDate</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java.time.LocalDate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> today</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LocalDate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> today</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span></span></code></pre></div><p><strong>等效 Core IR</strong>（简化）：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Define&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;currentDate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;body&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;JavaInterop&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;className&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;java.time.LocalDate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;now&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;args&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>运行</strong>：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> truffle</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> examples/java-interop/datetime.aster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --func=currentDate</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出: 2025-11-08</span></span></code></pre></div><hr><h4 id="示例-2-使用-java-util-arraylist" tabindex="-1">示例 2：使用 java.util.ArrayList <a class="header-anchor" href="#示例-2-使用-java-util-arraylist" aria-label="Permalink to “示例 2：使用 java.util.ArrayList”">​</a></h4><p><strong>Aster 代码</strong>：</p><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> is</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> arraylist_example</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">To</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">produce</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ArrayList</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java.util.ArrayList&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> list</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ArrayList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Call</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;apple&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Call</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;banana&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Call</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cherry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span></span></code></pre></div><p><strong>运行</strong>：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist/scripts/aster.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> truffle</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> examples/java-interop/arraylist.aster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --func=createList</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出: 3</span></span></code></pre></div><hr><h4 id="示例-3-使用-java-util-concurrent-completablefuture" tabindex="-1">示例 3：使用 java.util.concurrent.CompletableFuture <a class="header-anchor" href="#示例-3-使用-java-util-concurrent-completablefuture" aria-label="Permalink to “示例 3：使用 java.util.concurrent.CompletableFuture”">​</a></h4><p><strong>Aster 代码</strong>：</p><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> is</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> async_example</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">To</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> asyncComputation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">produce</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> with</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CompletableFuture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java.util.concurrent.CompletableFuture&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> future</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CompletableFuture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 42</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> future</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span></span></code></pre></div><p><strong>说明</strong>：</p><ul><li>并发操作标注 <code>with IO</code> 效果</li><li>使用 Java 的异步机制实现并发计算</li></ul><hr><h3 id="_2-2-类型映射表" tabindex="-1">2.2 类型映射表 <a class="header-anchor" href="#_2-2-类型映射表" aria-label="Permalink to “2.2 类型映射表”">​</a></h3><p>Aster 类型与 Java 类型的自动转换：</p><table tabindex="0"><thead><tr><th>Aster 类型</th><th>Java 类型</th><th>说明</th></tr></thead><tbody><tr><td><code>Int</code></td><td><code>java.lang.Integer</code></td><td>32位有符号整数</td></tr><tr><td><code>Long</code></td><td><code>java.lang.Long</code></td><td>64位有符号整数</td></tr><tr><td><code>Double</code></td><td><code>java.lang.Double</code></td><td>IEEE 754 双精度浮点数</td></tr><tr><td><code>Bool</code></td><td><code>java.lang.Boolean</code></td><td>布尔值</td></tr><tr><td><code>Text</code></td><td><code>java.lang.String</code></td><td>不可变字符串</td></tr><tr><td><code>List\\&lt;T\\&gt;</code></td><td><code>java.util.List\\&lt;T\\&gt;</code></td><td>列表接口</td></tr><tr><td><code>Map\\&lt;K,V\\&gt;</code></td><td><code>java.util.Map\\&lt;K,V\\&gt;</code></td><td>映射接口</td></tr><tr><td><code>Maybe\\&lt;T\\&gt;</code></td><td><code>java.util.Optional\\&lt;T\\&gt;</code></td><td>可选值</td></tr><tr><td><code>Result\\&lt;T,E\\&gt;</code></td><td>自定义类型</td><td>无直接对应，需封装</td></tr></tbody></table><h4 id="null-处理" tabindex="-1">Null 处理 <a class="header-anchor" href="#null-处理" aria-label="Permalink to “Null 处理”">​</a></h4><ul><li><strong>Java null → Aster</strong>：自动转换为 <code>Maybe.None</code></li><li><strong>Aster Maybe.None → Java</strong>：转换为 <code>null</code></li><li><strong>配置严格模式</strong>：在 LSP 中启用 null 检查警告</li></ul><p><strong>示例</strong>：</p><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">To </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">safeGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(map: Map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text, Text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key: Text), produce Maybe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Define value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).  # </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 返回</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 时自动转为</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Return value.</span></span></code></pre></div><hr><h3 id="_2-3-异常处理" tabindex="-1">2.3 异常处理 <a class="header-anchor" href="#_2-3-异常处理" aria-label="Permalink to “2.3 异常处理”">​</a></h3><p>Java 异常自动转换为 Aster 的 <code>Result</code> 类型：</p><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">To </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInteger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text: Text), produce Result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Int, Text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Define Integer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java.lang.Integer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Define result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result).</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Catch </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Invalid integer format: {text}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span></code></pre></div><p><strong>运行</strong>：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 成功解析</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{ &quot;text&quot;: &quot;42&quot; }&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parse_integer_core.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出: Ok(42)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 解析失败</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{ &quot;text&quot;: &quot;abc&quot; }&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parse_integer_core.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出: Err(&quot;Invalid integer format: abc&quot;)</span></span></code></pre></div><hr><h3 id="_2-4-调用自定义-java-类" tabindex="-1">2.4 调用自定义 Java 类 <a class="header-anchor" href="#_2-4-调用自定义-java-类" aria-label="Permalink to “2.4 调用自定义 Java 类”">​</a></h3><h4 id="步骤-1-编写-java-类" tabindex="-1">步骤 1：编写 Java 类 <a class="header-anchor" href="#步骤-1-编写-java-类" aria-label="Permalink to “步骤 1：编写 Java 类”">​</a></h4><p><strong>文件</strong>: <code>src/main/java/com/example/Calculator.java</code></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.example;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Calculator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> multiply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="步骤-2-在-aster-中调用" tabindex="-1">步骤 2：在 Aster 中调用 <a class="header-anchor" href="#步骤-2-在-aster-中调用" aria-label="Permalink to “步骤 2：在 Aster 中调用”">​</a></h4><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> is</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> calculator_example</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">To</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">produce</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Calculator</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;com.example.Calculator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">调用静态方法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Calculator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(5, 3).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">调用实例方法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> calc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Calculator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> product</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> calc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multiply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(4, 7).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> + </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">product</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span></code></pre></div><h4 id="步骤-3-配置-classpath" tabindex="-1">步骤 3：配置 Classpath <a class="header-anchor" href="#步骤-3-配置-classpath" aria-label="Permalink to “步骤 3：配置 Classpath”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编译 Java 类</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">javac</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build/classes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/main/java/com/example/Calculator.java</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行时添加到 classpath</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JAVA_OPTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-cp build/classes&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> calculator_core.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --func=compute</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出: 36  (5+3 + 4*7 = 8 + 28 = 36)</span></span></code></pre></div><hr><h3 id="_2-5-泛型类型擦除" tabindex="-1">2.5 泛型类型擦除 <a class="header-anchor" href="#_2-5-泛型类型擦除" aria-label="Permalink to “2.5 泛型类型擦除”">​</a></h3><p>Java 泛型在运行时被擦除，Aster 通过类型推断处理：</p><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">To createTypedList, produce List</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Define ArrayList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java.util.ArrayList&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Define list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ArrayList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Call list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Call list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Call list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # Aster 推断返回类型为 List</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Return list.</span></span></code></pre></div><p><strong>注意</strong>：</p><ul><li>运行时无法检查泛型类型</li><li>编译时 Aster 类型检查器会验证类型一致性</li></ul><hr><h2 id="_3-native-image-vs-jvm-模式" tabindex="-1">3. Native Image vs JVM 模式 <a class="header-anchor" href="#_3-native-image-vs-jvm-模式" aria-label="Permalink to “3. Native Image vs JVM 模式”">​</a></h2><h3 id="_3-1-性能对比" tabindex="-1">3.1 性能对比 <a class="header-anchor" href="#_3-1-性能对比" aria-label="Permalink to “3.1 性能对比”">​</a></h3><p>基于实际基准测试结果（GraalVM 25, macOS arm64）：</p><table tabindex="0"><thead><tr><th>指标</th><th>Native Image</th><th>JVM (HotSpot)</th><th>优势</th></tr></thead><tbody><tr><td><strong>启动时间</strong></td><td>~50ms</td><td>~500ms</td><td><strong>Native Image 快 10x</strong></td></tr><tr><td><strong>首次执行</strong></td><td>~80ms</td><td>~1200ms</td><td><strong>Native Image 快 15x</strong></td></tr><tr><td><strong>峰值性能</strong></td><td>85% of JVM</td><td>100% (基准)</td><td>JVM 略快 15%</td></tr><tr><td><strong>内存占用</strong></td><td>~50MB</td><td>~300MB</td><td><strong>Native Image 省 6x</strong></td></tr><tr><td><strong>二进制大小</strong></td><td>23MB (PGO) / 37MB (baseline)</td><td>N/A</td><td>独立部署</td></tr></tbody></table><p><strong>结论</strong>：</p><ul><li><strong>微服务/无服务器</strong>：优先 Native Image（冷启动关键）</li><li><strong>长期运行服务</strong>：优先 JVM（峰值性能优势）</li><li><strong>嵌入式/边缘计算</strong>：必须 Native Image（内存受限）</li></ul><hr><h3 id="_3-2-功能差异" tabindex="-1">3.2 功能差异 <a class="header-anchor" href="#_3-2-功能差异" aria-label="Permalink to “3.2 功能差异”">​</a></h3><table tabindex="0"><thead><tr><th>特性</th><th>Native Image</th><th>JVM</th><th>说明</th></tr></thead><tbody><tr><td>动态类加载</td><td>❌ 不支持</td><td>✅ 支持</td><td>Native Image 需编译时确定所有类</td></tr><tr><td>反射</td><td>⚠️ 需配置</td><td>✅ 完全支持</td><td>需在 <code>reflect-config.json</code> 声明</td></tr><tr><td>JNI</td><td>⚠️ 需配置</td><td>✅ 完全支持</td><td>需在 <code>jni-config.json</code> 声明</td></tr><tr><td>序列化</td><td>⚠️ 需配置</td><td>✅ 完全支持</td><td>需在 <code>serialization-config.json</code> 声明</td></tr><tr><td>资源文件</td><td>⚠️ 需配置</td><td>✅ 自动包含</td><td>需在 <code>resource-config.json</code> 声明</td></tr><tr><td>JVMTI/JMX</td><td>❌ 不支持</td><td>✅ 支持</td><td>Native Image 无 JVM 诊断接口</td></tr><tr><td>线程/并发</td><td>✅ 完全支持</td><td>✅ 完全支持</td><td>行为一致</td></tr><tr><td>Truffle 语言</td><td>✅ 完全支持</td><td>✅ 完全支持</td><td>Aster 核心功能无差异</td></tr></tbody></table><hr><h3 id="_3-3-配置文件" tabindex="-1">3.3 配置文件 <a class="header-anchor" href="#_3-3-配置文件" aria-label="Permalink to “3.3 配置文件”">​</a></h3><p>Native Image 需要配置文件声明动态特性。Aster 项目已预配置：</p><h4 id="reflect-config-json" tabindex="-1">reflect-config.json <a class="header-anchor" href="#reflect-config-json" aria-label="Permalink to “reflect-config.json”">​</a></h4><p><strong>位置</strong>: <code>aster-truffle/src/main/resources/META-INF/native-image/reflect-config.json</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;java.time.LocalDate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;methods&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;now&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;parameterTypes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [] },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;toString&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;parameterTypes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;java.util.ArrayList&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;methods&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;init&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;parameterTypes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [] },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;add&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;parameterTypes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;java.lang.Object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;parameterTypes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p><strong>说明</strong>：</p><ul><li>声明需要反射访问的类和方法</li><li>未声明的反射调用会导致运行时错误</li></ul><hr><h4 id="resource-config-json" tabindex="-1">resource-config.json <a class="header-anchor" href="#resource-config-json" aria-label="Permalink to “resource-config.json”">​</a></h4><p><strong>位置</strong>: <code>aster-truffle/src/main/resources/META-INF/native-image/resource-config.json</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;resources&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;includes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;pattern&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;pattern&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;META-INF/.*&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>说明</strong>：</p><ul><li>声明需要打包到镜像中的资源文件</li><li>使用正则表达式匹配文件路径</li></ul><hr><h4 id="serialization-config-json" tabindex="-1">serialization-config.json <a class="header-anchor" href="#serialization-config-json" aria-label="Permalink to “serialization-config.json”">​</a></h4><p><strong>位置</strong>: <code>aster-truffle/src/main/resources/META-INF/native-image/serialization-config.json</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;aster.truffle.runtime.AsterValue&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;aster.truffle.runtime.ListValue&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p><strong>说明</strong>：</p><ul><li>声明需要序列化支持的类</li><li>用于跨进程通信或持久化</li></ul><hr><h3 id="_3-4-编译选项" tabindex="-1">3.4 编译选项 <a class="header-anchor" href="#_3-4-编译选项" aria-label="Permalink to “3.4 编译选项”">​</a></h3><h4 id="baseline-编译" tabindex="-1">Baseline 编译 <a class="header-anchor" href="#baseline-编译" aria-label="Permalink to “Baseline 编译”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-configuration-cache</span></span></code></pre></div><p><strong>结果</strong>：</p><ul><li>二进制大小：~37 MB</li><li>编译时间：2-5 分钟</li><li>启动时间：~20ms</li></ul><hr><h4 id="pgo-profile-guided-optimization-编译" tabindex="-1">PGO（Profile-Guided Optimization）编译 <a class="header-anchor" href="#pgo-profile-guided-optimization-编译" aria-label="Permalink to “PGO（Profile-Guided Optimization）编译”">​</a></h4><p><strong>Step 1</strong>: 编译带性能剖析的版本</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -PpgoMode=instrument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --no-configuration-cache</span></span></code></pre></div><p><strong>Step 2</strong>: 收集性能 Profile</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  benchmarks/core/fibonacci_20_core.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster-truffle/build/native/nativeCompile/aster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  benchmarks/core/list_map_1000_core.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Profile 数据保存到 default.iprof</span></span></code></pre></div><p><strong>Step 3</strong>: 使用 Profile 重新编译</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -PpgoMode=$(pwd)/default.iprof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --no-configuration-cache</span></span></code></pre></div><p><strong>结果</strong>：</p><ul><li>二进制大小：<strong>23 MB</strong>（减少 37.6%）</li><li>编译时间：~1.5 分钟</li><li>启动时间：~32ms</li><li>峰值性能：提升 10-15%</li></ul><hr><h3 id="_3-5-故障排查" tabindex="-1">3.5 故障排查 <a class="header-anchor" href="#_3-5-故障排查" aria-label="Permalink to “3.5 故障排查”">​</a></h3><h4 id="问题-1-反射调用失败" tabindex="-1">问题 1：反射调用失败 <a class="header-anchor" href="#问题-1-反射调用失败" aria-label="Permalink to “问题 1：反射调用失败”">​</a></h4><p><strong>错误</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>java.lang.ClassNotFoundException: java.time.LocalDate</span></span></code></pre></div><p><strong>解决</strong>： 在 <code>reflect-config.json</code> 中添加类声明：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;java.time.LocalDate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;allDeclaredMethods&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h4 id="问题-2-资源文件未找到" tabindex="-1">问题 2：资源文件未找到 <a class="header-anchor" href="#问题-2-资源文件未找到" aria-label="Permalink to “问题 2：资源文件未找到”">​</a></h4><p><strong>错误</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Resource not found: config.json</span></span></code></pre></div><p><strong>解决</strong>： 在 <code>resource-config.json</code> 中添加资源模式：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;pattern&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h4 id="问题-3-序列化失败" tabindex="-1">问题 3：序列化失败 <a class="header-anchor" href="#问题-3-序列化失败" aria-label="Permalink to “问题 3：序列化失败”">​</a></h4><p><strong>错误</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>SerializationException: Class not registered for serialization</span></span></code></pre></div><p><strong>解决</strong>： 在 <code>serialization-config.json</code> 中添加类：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.example.MySerializableClass&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="_4-最佳实践" tabindex="-1">4. 最佳实践 <a class="header-anchor" href="#_4-最佳实践" aria-label="Permalink to “4. 最佳实践”">​</a></h2><h3 id="_4-1-选择运行模式" tabindex="-1">4.1 选择运行模式 <a class="header-anchor" href="#_4-1-选择运行模式" aria-label="Permalink to “4.1 选择运行模式”">​</a></h3><p><strong>使用 Native Image 的场景</strong>：</p><ul><li>✅ 微服务、无服务器函数（AWS Lambda, Google Cloud Functions）</li><li>✅ CLI 工具、批处理脚本</li><li>✅ 容器化部署（减少镜像大小和启动时间）</li><li>✅ 嵌入式系统、边缘计算（内存受限环境）</li></ul><p><strong>使用 JVM 的场景</strong>：</p><ul><li>✅ 长期运行的服务（如 Web 后端、消息队列消费者）</li><li>✅ 需要动态类加载或反射的复杂场景</li><li>✅ 开发和调试阶段（更快的编译-运行循环）</li><li>✅ 需要 JVM 诊断工具（JProfiler, VisualVM）</li></ul><hr><h3 id="_4-2-性能优化建议" tabindex="-1">4.2 性能优化建议 <a class="header-anchor" href="#_4-2-性能优化建议" aria-label="Permalink to “4.2 性能优化建议”">​</a></h3><h4 id="内存配置" tabindex="-1">内存配置 <a class="header-anchor" href="#内存配置" aria-label="Permalink to “内存配置”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># JVM 模式：设置合理的堆内存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JAVA_OPTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-Xmx2G -Xms512M -XX:+UseG1GC&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Native Image 模式：通过 PGO 优化</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -PpgoMode=$(pwd)/default.iprof</span></span></code></pre></div><hr><h4 id="jit-编译优化" tabindex="-1">JIT 编译优化 <a class="header-anchor" href="#jit-编译优化" aria-label="Permalink to “JIT 编译优化”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 适合短期运行：立即编译</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> benchmark.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --experimental-options</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --engine.CompileImmediately</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 适合长期运行：提高编译阈值，减少编译开销</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service.json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --experimental-options</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --engine.CompilationThreshold=10000</span></span></code></pre></div><hr><h3 id="_4-3-java-互操作最佳实践" tabindex="-1">4.3 Java 互操作最佳实践 <a class="header-anchor" href="#_4-3-java-互操作最佳实践" aria-label="Permalink to “4.3 Java 互操作最佳实践”">​</a></h3><h4 id="优先使用-aster-标准库" tabindex="-1">优先使用 Aster 标准库 <a class="header-anchor" href="#优先使用-aster-标准库" aria-label="Permalink to “优先使用 Aster 标准库”">​</a></h4><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># ❌ 避免：不必要的 Java 互操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">To </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addNumbers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: Int, b: Int), produce </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Define Integer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java.lang.Integer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Return Integer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a, b).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># ✅ 推荐：使用 Aster 原生操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">To </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addNumbers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: Int, b: Int), produce </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Return a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.</span></span></code></pre></div><hr><h4 id="使用-result-包装可能失败的操作" tabindex="-1">使用 Result 包装可能失败的操作 <a class="header-anchor" href="#使用-result-包装可能失败的操作" aria-label="Permalink to “使用 Result 包装可能失败的操作”">​</a></h4><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># ✅ 推荐：显式错误处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">To </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">safeParse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text: Text), produce Result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Int, Text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Define Integer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java.lang.Integer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text)).</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Catch </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Parse failed: {error}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span></code></pre></div><hr><h4 id="最小化跨语言调用" tabindex="-1">最小化跨语言调用 <a class="header-anchor" href="#最小化跨语言调用" aria-label="Permalink to “最小化跨语言调用”">​</a></h4><div class="language-aster"><button title="Copy Code" class="copy"></button><span class="lang">aster</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># ❌ 避免：循环中频繁调用 Java</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">To </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">processList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(items: List</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), produce </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Define total </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  For item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> items</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Define Integer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Java</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;java.lang.Integer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    total </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item).  # 每次循环都跨语言调用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Return total.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># ✅ 推荐：批量转换后使用 Aster 操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">To </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">processList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(items: List</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), produce Result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Int, Text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Define numbers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> items</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parseInteger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item)).</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  If numbers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(isErr):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Parse failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(numbers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(unwrap).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, add)).</span></span></code></pre></div><hr><h2 id="_5-参考资料" tabindex="-1">5. 参考资料 <a class="header-anchor" href="#_5-参考资料" aria-label="Permalink to “5. 参考资料”">​</a></h2><h3 id="_5-1-aster-文档" tabindex="-1">5.1 Aster 文档 <a class="header-anchor" href="#_5-1-aster-文档" aria-label="Permalink to “5.1 Aster 文档”">​</a></h3><ul><li><a href="./../guide/getting-started.html">Getting Started</a> - 完整入门指南</li><li><a href="./../guide/truffle-quickstart.html">Truffle Quickstart</a> - Truffle 快速入门</li><li><a href="./../native-image/build-guide.html">Native Image 构建指南</a> - Native Image 详细说明</li><li><a href="./../native-image/performance-comparison.html">性能对比报告</a> - 基准测试结果</li></ul><h3 id="_5-2-graalvm-官方文档" tabindex="-1">5.2 GraalVM 官方文档 <a class="header-anchor" href="#_5-2-graalvm-官方文档" aria-label="Permalink to “5.2 GraalVM 官方文档”">​</a></h3><ul><li><a href="https://www.graalvm.org/latest/graalvm-as-a-platform/language-implementation-framework/" target="_blank" rel="noreferrer">Truffle Language Implementation Framework</a></li><li><a href="https://www.graalvm.org/latest/reference-manual/native-image/" target="_blank" rel="noreferrer">Native Image</a></li><li><a href="https://www.graalvm.org/latest/reference-manual/native-image/optimizations-and-performance/PGO/" target="_blank" rel="noreferrer">Profile-Guided Optimizations</a></li></ul><h3 id="_5-3-java-互操作参考" tabindex="-1">5.3 Java 互操作参考 <a class="header-anchor" href="#_5-3-java-互操作参考" aria-label="Permalink to “5.3 Java 互操作参考”">​</a></h3><ul><li><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/time/package-summary.html" target="_blank" rel="noreferrer">java.time API</a></li><li><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/package-summary.html" target="_blank" rel="noreferrer">java.util.concurrent</a></li><li><a href="https://www.graalvm.org/latest/graalvm-as-a-platform/language-implementation-framework/InteropMigration/" target="_blank" rel="noreferrer">Truffle Interop</a></li></ul><hr><h2 id="附录-快速参考" tabindex="-1">附录：快速参考 <a class="header-anchor" href="#附录-快速参考" aria-label="Permalink to “附录：快速参考”">​</a></h2><h3 id="cli-命令速查" tabindex="-1">CLI 命令速查 <a class="header-anchor" href="#cli-命令速查" aria-label="Permalink to “CLI 命令速查”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基础运行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core-ir-fil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定函数和参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core-ir-fil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --func=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">1&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">2&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 性能分析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core-ir-fil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpusampler</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --memtracer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 追踪编译</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./aster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core-ir-fil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --experimental-options</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --engine.TraceCompilation</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编译 Native Image (baseline)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编译 Native Image (PGO)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -PpgoMode=instrument</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ... 运行代表性工作负载 ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :aster-truffle:nativeCompile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -PpgoMode=$(pwd)/default.iprof</span></span></code></pre></div><h3 id="类型映射速查" tabindex="-1">类型映射速查 <a class="header-anchor" href="#类型映射速查" aria-label="Permalink to “类型映射速查”">​</a></h3><table tabindex="0"><thead><tr><th>Aster</th><th>Java</th></tr></thead><tbody><tr><td>Int</td><td>Integer</td></tr><tr><td>Long</td><td>Long</td></tr><tr><td>Double</td><td>Double</td></tr><tr><td>Bool</td><td>Boolean</td></tr><tr><td>Text</td><td>String</td></tr><tr><td>List&lt;T&gt;</td><td>List&lt;T&gt;</td></tr><tr><td>Map&lt;K,V&gt;</td><td>Map&lt;K,V&gt;</td></tr><tr><td>Maybe&lt;T&gt;</td><td>Optional&lt;T&gt;</td></tr><tr><td>null (Java)</td><td>None (Aster)</td></tr></tbody></table><h3 id="配置文件路径" tabindex="-1">配置文件路径 <a class="header-anchor" href="#配置文件路径" aria-label="Permalink to “配置文件路径”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>aster-truffle/src/main/resources/META-INF/native-image/</span></span>
<span class="line"><span>├── reflect-config.json          # 反射配置</span></span>
<span class="line"><span>├── resource-config.json         # 资源文件配置</span></span>
<span class="line"><span>└── serialization-config.json    # 序列化配置</span></span></code></pre></div>`,193)])])}const E=i(l,[["render",h]]);export{o as __pageData,E as default};
